<!DOCTYPE html>
<html  lang="zh">
<head>
    <meta charset="utf-8" />

<meta name="generator" content="Hexo 4.2.0" />

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

<title>Mybatis 入门教程 - 何年の再遇见</title>


    <meta property="og:type" content="article">
<meta property="og:title" content="Mybatis 入门教程">
<meta property="og:url" content="https://guoshizhan.github.io/Mybatis.html">
<meta property="og:site_name" content="何年の再遇见">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://guoshizhan.github.io/gallery/Java-Study/Mybatis/mybatis-001.jpg">
<meta property="article:published_time" content="2020-06-22T12:51:51.000Z">
<meta property="article:modified_time" content="2020-08-27T10:16:07.862Z">
<meta property="article:author" content="Java Developer">
<meta property="article:tag" content="mybatis">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://guoshizhan.github.io/gallery/Java-Study/Mybatis/mybatis-001.jpg">







<link rel="icon" href="/images/favicon.ico">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-dark.css">


    
    
<style>body>.footer,body>.navbar,body>.section{opacity:0}</style>

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">

    
    
    
    
<link rel="stylesheet" href="/css/back-to-top.css">

    
    
    
    
    
    
    
    <link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
    
    
    


<link rel="stylesheet" href="/css/style.css">
</head>
<body class="is-2-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/GSZ's-Blog.png" alt="Mybatis 入门教程" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item"
                href="/">首页</a>
                
                <a class="navbar-item"
                href="/archives">归档</a>
                
                <a class="navbar-item"
                href="/categories">分类</a>
                
                <a class="navbar-item"
                href="/tags">标签</a>
                
                <a class="navbar-item"
                href="/friends">友链</a>
                
                <a class="navbar-item"
                href="/albums">相册</a>
                
                <a class="navbar-item"
                href="/media">影音</a>
                
                <a class="navbar-item"
                href="/inspiration">随笔</a>
                
                <a class="navbar-item"
                href="/secret">私密</a>
                
                <a class="navbar-item"
                href="/about">关于</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    <a class="navbar-item" target="_blank" rel="noopener" title="MyGitHub" href="https://github.com/guoshizhan">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                
                
                <a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;">
                    <i class="fas fa-list-ul"></i>
                </a>
                
                
                <a class="navbar-item search" title="搜索" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-9-desktop is-9-widescreen has-order-2 column-main">
<div class="card">
    
    <div class="card-image">
        <span  class="image is-7by1">
            <img class="thumbnail" src="/../gallery/Java-Study/Mybatis/mybatis-001.jpg" alt="Mybatis 入门教程">
        </span>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                
                <time class="level-item has-text-grey" datetime="2020-06-22T12:51:51.000Z">2020-06-22</time>
                
                    <span class="display-none-class"></span>
                    <img class="not-gallery-item" src="/images/chat.svg">&nbsp;<a href="/Mybatis.html#comment-container"><span></span></a>&nbsp;&nbsp;&nbsp;&nbsp;</img>
                
                
                <div class="level-item">
                <i class="fas fa-folder-open has-text-grey"></i>&nbsp;
                <a class="has-link-grey -link" href="/categories/Java%E5%AD%A6%E4%B9%A0/">Java学习</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    4 小时 读完 (大约 38398 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                Mybatis 入门教程
            
        </h1>
        <div class="content">
            <hr>
<a id="more"></a>

<h1 id="mybatis-的入门"><a href="#mybatis-的入门" class="headerlink" title="mybatis 的入门"></a>mybatis 的入门</h1><blockquote>
<p><code>特别提示：</code> mybatis 官方教程：<a href="https://mybatis.org/mybatis-3/zh/index.html">https://mybatis.org/mybatis-3/zh/index.html</a>)</p>
</blockquote>
<p>既然要学习框架，那就要知道 <strong><em>什么是框架</em></strong> 。<code>框架</code> 是我们软件开发中的 <strong><em>一套解决方案</em></strong> ，相当于一个半成品软件，不同的框架解决的是不同的问题。<strong><em>使用框架的好处</em></strong> ：框架封装了很多的细节，使开发者可以使用极简的方式实现功能，<strong><em>大大提高开发效率</em></strong> 。</p>
<h2 id="mybatis-的概述"><a href="#mybatis-的概述" class="headerlink" title="mybatis 的概述"></a>mybatis 的概述</h2><p><code>mybatis</code> 是一个优秀的基于 java 的持久层框架，它内部封装了 jdbc，使开发者 <strong><em>只需要关注 sql 语句本身</em></strong> ，而不需要花费精力去处理加载驱动、创建连接、创建 statement 等繁杂的过程。</p>
<hr/>

<p>它通过 <code>xml 或 注解</code> 的方式将要执行的各种 statement 配置起来，并通过 java 对象和 statement 中 sql 的动态参数进行映射生成最终执行的 sql 语句，<strong><em>最后由 mybatis 框架执行 sql 并将结果映射为 java 对象并返回</em></strong> 。</p>
<hr/>

<p>该框架采用 <code>ORM 思想</code> 解决了 <strong><em>实体和数据库映射的问题</em></strong> ，对 jdbc 进行了封装，屏蔽了 jdbc api 底层访问细节，使我们不用与 jdbc api 打交道，就可以完成对数据库的持久化操作。这里解释一下 <code>ORM</code> 。 <code>ORM</code> 是 <strong><em>Object Relational Mappging 对象关系映射</em></strong> 的缩写，它的功能就是 <strong><em>把数据库表和实体类及实体类的属性对应起来</em></strong> ，让我们可以操作实体类就实现操作数据库表。 </p>
<hr/>

<p><strong><em>mybatis 属于持久层框架</em></strong> ，在三层架构中的位置如下：</p>
<p><img src="../gallery/Java-Study/Mybatis/mybatis-002.png" alt=""></p>
<h2 id="mybatis-的环境搭建"><a href="#mybatis-的环境搭建" class="headerlink" title="mybatis 的环境搭建"></a>mybatis 的环境搭建</h2><p><code>第一步：</code> <strong><em>先创建一个数据库</em></strong> ，然后把以下 <strong><em>数据表</em></strong> 创建好，<strong><em>复制代码执行即可</em></strong> ，代码如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`user`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`user`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> auto_increment,</span><br><span class="line">  <span class="string">`username`</span> <span class="built_in">varchar</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'用户名称'</span>,</span><br><span class="line">  <span class="string">`birthday`</span> datetime <span class="keyword">default</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'生日'</span>,</span><br><span class="line">  <span class="string">`sex`</span> <span class="built_in">char</span>(<span class="number">1</span>) <span class="keyword">default</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'性别'</span>,</span><br><span class="line">  <span class="string">`address`</span> <span class="built_in">varchar</span>(<span class="number">256</span>) <span class="keyword">default</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'地址'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span>  (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span>  <span class="keyword">into</span> <span class="string">`user`</span>(<span class="string">`id`</span>,<span class="string">`username`</span>,<span class="string">`birthday`</span>,<span class="string">`sex`</span>,<span class="string">`address`</span>) <span class="keyword">values</span> (<span class="number">41</span>,<span class="string">'老王'</span>,<span class="string">'2018-02-27 17:47:08'</span>,<span class="string">'男'</span>,<span class="string">'北京'</span>),(<span class="number">42</span>,<span class="string">'小二王'</span>,<span class="string">'2018-03-02 15:09:37'</span>,<span class="string">'女'</span>,<span class="string">'北京金燕龙'</span>),(<span class="number">43</span>,<span class="string">'小二王'</span>,<span class="string">'2018-03-04 11:34:34'</span>,<span class="string">'女'</span>,<span class="string">'北京金燕龙'</span>),(<span class="number">45</span>,<span class="string">'传智播客'</span>,<span class="string">'2018-03-04 12:04:06'</span>,<span class="string">'男'</span>,<span class="string">'北京金燕龙'</span>),(<span class="number">46</span>,<span class="string">'老王'</span>,<span class="string">'2018-03-07 17:37:26'</span>,<span class="string">'男'</span>,<span class="string">'北京'</span>),(<span class="number">48</span>,<span class="string">'小马宝莉'</span>,<span class="string">'2018-03-08 11:44:00'</span>,<span class="string">'女'</span>,<span class="string">'北京修正'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`account`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`account`</span> (</span><br><span class="line">  <span class="string">`ID`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'编号'</span>,</span><br><span class="line">  <span class="string">`UID`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">default</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'用户编号'</span>,</span><br><span class="line">  <span class="string">`MONEY`</span> <span class="keyword">double</span> <span class="keyword">default</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'金额'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span>  (<span class="string">`ID`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`FK_Reference_8`</span> (<span class="string">`UID`</span>),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> <span class="string">`FK_Reference_8`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`UID`</span>) <span class="keyword">REFERENCES</span> <span class="string">`user`</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span>  <span class="keyword">into</span> <span class="string">`account`</span>(<span class="string">`ID`</span>,<span class="string">`UID`</span>,<span class="string">`MONEY`</span>) <span class="keyword">values</span> (<span class="number">1</span>,<span class="number">41</span>,<span class="number">1000</span>),(<span class="number">2</span>,<span class="number">45</span>,<span class="number">1000</span>),(<span class="number">3</span>,<span class="number">41</span>,<span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`role`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`role`</span> (</span><br><span class="line">  <span class="string">`ID`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'编号'</span>,</span><br><span class="line">  <span class="string">`ROLE_NAME`</span> <span class="built_in">varchar</span>(<span class="number">30</span>) <span class="keyword">default</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'角色名称'</span>,</span><br><span class="line">  <span class="string">`ROLE_DESC`</span> <span class="built_in">varchar</span>(<span class="number">60</span>) <span class="keyword">default</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'角色描述'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span>  (<span class="string">`ID`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span>  <span class="keyword">into</span> <span class="string">`role`</span>(<span class="string">`ID`</span>,<span class="string">`ROLE_NAME`</span>,<span class="string">`ROLE_DESC`</span>) <span class="keyword">values</span> (<span class="number">1</span>,<span class="string">'院长'</span>,<span class="string">'管理整个学院'</span>),(<span class="number">2</span>,<span class="string">'总裁'</span>,<span class="string">'管理整个公司'</span>),(<span class="number">3</span>,<span class="string">'校长'</span>,<span class="string">'管理整个学校'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`user_role`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`user_role`</span> (</span><br><span class="line">  <span class="string">`UID`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'用户编号'</span>,</span><br><span class="line">  <span class="string">`RID`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'角色编号'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span>  (<span class="string">`UID`</span>,<span class="string">`RID`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`FK_Reference_10`</span> (<span class="string">`RID`</span>),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> <span class="string">`FK_Reference_10`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`RID`</span>) <span class="keyword">REFERENCES</span> <span class="string">`role`</span> (<span class="string">`ID`</span>),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> <span class="string">`FK_Reference_9`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`UID`</span>) <span class="keyword">REFERENCES</span> <span class="string">`user`</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span>  <span class="keyword">into</span> <span class="string">`user_role`</span>(<span class="string">`UID`</span>,<span class="string">`RID`</span>) <span class="keyword">values</span> (<span class="number">41</span>,<span class="number">1</span>),(<span class="number">45</span>,<span class="number">1</span>),(<span class="number">41</span>,<span class="number">2</span>);</span><br></pre></td></tr></table></figure>

<p><code>第二步：</code> <strong><em>创建一个 maven 工程</em></strong> ，以图的方式展示创建过程，如下：</p>
<p><img src="../gallery/Java-Study/Mybatis/mybatis-003.png" alt=""><br><img src="../gallery/Java-Study/Mybatis/mybatis-004.png" alt=""><br><img src="../gallery/Java-Study/Mybatis/mybatis-005.png" alt=""><br><img src="../gallery/Java-Study/Mybatis/mybatis-006.png" alt=""></p>
<p><code>第三步：</code> <strong><em>导入相关依赖</em></strong> 。打开 <code>pom.xml</code> 文件，把以下 <strong><em>代码中的 &lt;dependencies&gt; 依赖部分</em></strong> 复制进去即可【<strong><em>打包方式顺便加上</em></strong>】。代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>club.guoshizhan<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-01<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- mybatis 依赖，必须要 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- mysql 数据库驱动依赖，必须要 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 日志依赖，不是一定要 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 测试依赖，不是一定要 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>第四步：</code> <strong><em>建立包结构</em></strong> 。如下图：</p>
<p><img src="../gallery/Java-Study/Mybatis/mybatis-007.png" alt=""></p>
<p><code>第五步：</code> 在 <code>club/guoshizhan/domain</code> 包下新建 <code>User 类</code> ，和数据库中的 <code>user 表</code> 相映射。代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/6/22 23:52</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: User 实体类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"User&#123;"</span> +</span><br><span class="line">                <span class="string">"id="</span> + id +</span><br><span class="line">                <span class="string">", username='"</span> + username + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", birthday="</span> + birthday +</span><br><span class="line">                <span class="string">", sex='"</span> + sex + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", address='"</span> + address + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getBirthday</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> birthday;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBirthday</span><span class="params">(Date birthday)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.birthday = birthday;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSex</span><span class="params">(String sex)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sex = sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAddress</span><span class="params">(String address)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p><code>第六步：</code> 在 <code>club/guoshizhan/dao</code> 包下新建 <code>IUserDao 接口</code> ，然后定义方法，用于对 <code>user 表</code> 的增删改查。代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/6/22 23:53</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 用户持久层接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUserDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有用户</span></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第七步：</code> 在 <code>resources 目录</code> 下新建 <code>SqlMapConfig.xml</code> 文件【文件名随意取，不一定是 SqlMapConfig】。<strong><em>这是 mybatis 的主配置文件，各种配置都写好了对应的注释</em></strong> 。代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Config 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 01-mybatis 的主配置文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 02-配置 mybatis 的环境，default 属性的值随便写，写完之后，下面 id 的值必须和 default 的值一样 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"mysql"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 03-配置 mysql 的环境 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"mysql"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!-- 04-配置事务的类型，type 先写 JDBC ，其他的以后说 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>&gt;</span><span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!-- 05-配置连接数据库的信息：用的是数据源(连接池) --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/eesy_mybatis"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 06-指定 mybatis 映射配置的位置，即从 resources/club/guoshizhan/dao/ 包下找 IUserDao.xml 文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"club/guoshizhan/dao/IUserDao.xml"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>第八步：</code> <strong><em>编写 <code>IUserDao.xml</code> 文件</em></strong> 。在 <strong><em>resources 目录</em></strong> 下新建 <strong><em>club 目录</em></strong> ，然后在 <strong><em>club 目录</em></strong> 下新建 <strong><em>guoshizhan 目录</em></strong> ，最后在 <strong><em>guoshizhan 目录</em></strong> 下新建 <strong><em>dao 目录</em></strong> 。<strong><em>然后在 dao 目录</em></strong> 下新建 <code>IUserDao.xml</code> 文件。*** 代码如下：</p>
<figure class="highlight xml"><figcaption><span>IUserDao.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 01-持久层映射配置中，mapper 标签的 namespace 属性取值必须是持久层接口的全限定类名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"club.guoshizhan.dao.IUserDao"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 02-查询所有用户：resultType 很重要，是查询结果的封装位置，不写会报错，表示 mybatis 框架不知道把结果往哪里封装 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 03-属性 id 不能随便写，必须是接口中方法的名称 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultType</span>=<span class="string">"club.guoshizhan.domain.User"</span>&gt;</span></span><br><span class="line">      select * from user;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>mybatis 环境搭建到此结束，<strong><em>搭建好之后的目录结构</em></strong> 如下：</p>
<p><img src="../gallery/Java-Study/Mybatis/mybatis-008.png" alt=""></p>
<div class="hacker">
    <div class="block-title ">
        <i class="fa fa-bullseye"></i>
        <span>mybatis 环境搭建的注意事项：</span>
    </div>
    <div class="block">
        1、在 Mybatis 中，持久层的操作接口名称和映射文件也叫做 Mapper 。所以 IUserDao 和 IUserMapper 是一样的。建议使用 IUserMapper 。
        2、在 IDEA 中创建目录的时候，它和包的创建是不一样的。包在创建时： club.guoshizhan.dao 是三级结构，目录在创建时： club.guoshizhan.dao 是一级目录。
        3、mybatis 的映射配置文件 IUserDao.xml 的位置必须和 dao 接口的包结构相同。
        4、映射配置文件的 mapper 标签 namespace 属性的取值必须是 dao 接口的全限定类名。
        5、映射配置文件的操作配置（select），id 属性的取值必须是 dao 接口的方法名。
        6、当遵从了第三，四，五点之后，我们在开发中就无须再写 dao 的实现类，即简化了开发。
    </div>
</div>

<h2 id="mybatis-的入门案例"><a href="#mybatis-的入门案例" class="headerlink" title="mybatis 的入门案例"></a>mybatis 的入门案例</h2><p><code>第一步：</code> 在 <code>resources</code> 目录下 <strong><em>新建 log4j.properties 日志文件</em></strong> ，用于打印日志【也可以不写，不写就看不到出错的地方，建议加上】。代码如下：</p>
<figure class="highlight properties"><figcaption><span>log4j.properties</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Set root category priority to INFO and its only appender to CONSOLE.</span></span><br><span class="line"><span class="comment">#log4j.rootCategory=INFO, CONSOLE            debug   info   warn error fatal</span></span><br><span class="line"><span class="meta">log4j.rootCategory</span>=<span class="string">debug, CONSOLE, LOGFILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the enterprise logger category to FATAL and its only appender to CONSOLE.</span></span><br><span class="line"><span class="meta">log4j.logger.org.apache.axis.enterprise</span>=<span class="string">FATAL, CONSOLE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># CONSOLE is set to be a ConsoleAppender using a PatternLayout.</span></span><br><span class="line"><span class="meta">log4j.appender.CONSOLE</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="meta">log4j.appender.CONSOLE.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="meta">log4j.appender.CONSOLE.layout.ConversionPattern</span>=<span class="string">%d&#123;ISO8601&#125; %-6r [%15.15t] %-5p %30.30c %x - %m\n</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># LOGFILE is set to be a File appender using a PatternLayout.</span></span><br><span class="line"><span class="meta">log4j.appender.LOGFILE</span>=<span class="string">org.apache.log4j.FileAppender</span></span><br><span class="line"><span class="meta">log4j.appender.LOGFILE.File</span>=<span class="string">d:\axis.log</span></span><br><span class="line"><span class="meta">log4j.appender.LOGFILE.Append</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">log4j.appender.LOGFILE.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="meta">log4j.appender.LOGFILE.layout.ConversionPattern</span>=<span class="string">%d&#123;ISO8601&#125; %-6r [%15.15t] %-5p %30.30c %x - %m\n</span></span><br></pre></td></tr></table></figure>

<p><code>第二步：</code> 在 <code>test/java</code> 目录下 新建 <code>club.guoshizhan.Test.MybatisTest</code> 类，这样写的目的就是让 IDEA 自动生成三级包结构。然后编写 <code>MybatisTest 类</code> ，代码如下：</p>
<figure class="highlight java"><figcaption><span>MybatisTest.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.dao.IUserDao;</span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/6/23 11:03</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Mybatis 测试类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 01-读取 mybatis 主配置文件</span></span><br><span class="line">        InputStream in = Resources.getResourceAsStream(<span class="string">"SqlMapConfig.xml"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 02-创建 SqlSessionFactory 工厂 ，SqlSessionFactory 是一个接口，不能 new 对象，所以使用它的实现类 SqlSessionFactoryBuilder 来创建对象</span></span><br><span class="line">        SqlSessionFactoryBuilder factory = <span class="keyword">new</span> SqlSessionFactoryBuilder();</span><br><span class="line">        SqlSessionFactory build = factory.build(in);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 03-使用上面创建的工厂来生产 SqlSession 对象，SqlSession 的作用是创建 Dao 接口的代理对象</span></span><br><span class="line">        SqlSession session = build.openSession();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 04-使用 SqlSession 创建 Dao 接口的代理对象</span></span><br><span class="line">        IUserDao userDao = session.getMapper(IUserDao<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 05-使用代理对象执行方法</span></span><br><span class="line">        List&lt;User&gt; users = userDao.findAll();</span><br><span class="line">        <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 06-关闭资源</span></span><br><span class="line">        session.close();</span><br><span class="line">        in.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第三步：</code> 运行 <code>main</code> 方法，结果如下：</p>
<p><img src="../gallery/Java-Study/Mybatis/mybatis-009.png" alt="没有日志信息"><br><img src="../gallery/Java-Study/Mybatis/mybatis-010.png" alt="有日志信息"></p>
<p>mybatis 入门案例到此结束，<strong><em>最终的目录结构和入门案例分析</em></strong> 如下：</p>
<p><img src="../gallery/Java-Study/Mybatis/mybatis-011.png" alt="最终目录结构"><br><img src="../gallery/Java-Study/Mybatis/mybatis-012.png" alt="入门案例分析"></p>
<h2 id="mybatis-注解案例"><a href="#mybatis-注解案例" class="headerlink" title="mybatis 注解案例"></a>mybatis 注解案例</h2><p><code>第一步：</code> <strong><em>创建一个 maven 工程</em></strong> ，以图的方式展示创建过程，如下：</p>
<p><img src="../gallery/Java-Study/Mybatis/mybatis-003.png" alt=""><br><img src="../gallery/Java-Study/Mybatis/mybatis-013.png" alt=""><br><img src="../gallery/Java-Study/Mybatis/mybatis-014.png" alt=""><br><img src="../gallery/Java-Study/Mybatis/mybatis-015.png" alt=""></p>
<p><code>第二步：</code> <strong><em>导入相关依赖</em></strong> 。打开 <code>pom.xml</code> 文件，把以下 <strong><em>代码中的 &lt;dependencies&gt; 依赖部分</em></strong> 复制进去即可【<strong><em>打包方式顺便加上</em></strong>】。代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>club.guoshizhan<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-02<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 打包方式使用 jar --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- mybatis 依赖，必须要 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- mysql 数据库驱动依赖，必须要 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 日志依赖，不是一定要 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 测试依赖，不是一定要 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>第三步：</code> <strong><em>建立包结构</em></strong> 。如下图：</p>
<p><img src="../gallery/Java-Study/Mybatis/mybatis-016.png" alt=""></p>
<p><code>第四步：</code> 在 <code>club/guoshizhan/domain</code> 包下新建 <code>User 类</code> ，和数据库中的 <code>user 表</code> 相映射。代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/6/22 23:52</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: User 实体类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"User&#123;"</span> +</span><br><span class="line">                <span class="string">"id="</span> + id +</span><br><span class="line">                <span class="string">", username='"</span> + username + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", birthday="</span> + birthday +</span><br><span class="line">                <span class="string">", sex='"</span> + sex + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", address='"</span> + address + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getBirthday</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> birthday;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBirthday</span><span class="params">(Date birthday)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.birthday = birthday;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSex</span><span class="params">(String sex)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sex = sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAddress</span><span class="params">(String address)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第五步：</code> 在 <code>club/guoshizhan/dao</code> 包下新建 <code>IUserDao 接口</code> ，然后定义方法，用于对 <code>user 表</code> 的增删改查 <strong><em>【此处代码可是用到了注解哦】</em></strong> 。代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/6/22 23:53</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 用户持久层接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUserDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有用户，此处使用的是注解的方式</span></span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">"select * from user"</span>)</span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第六步：</code> 在 <code>resources 目录</code> 下新建 <code>SqlMapConfig.xml</code> 主配置文件，<strong><em>各种配置都写好了对应的注释【注意对比注释 06 和原先 xml 配置的区别】</em></strong> 。代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Config 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 01-mybatis 的主配置文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 02-配置 mybatis 的环境，default 属性的值随便写，写完之后，下面 id 的值必须和 default 的值一样 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"mysql"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 03-配置 mysql 的环境 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"mysql"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!-- 04-配置事务的类型，type 先写 JDBC ，其他的以后说 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>&gt;</span><span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!-- 05-配置连接数据库的信息：用的是数据源(连接池) --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/eesy_mybatis"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 06-指定 mybatis 映射配置的位置，即从 resources/club/guoshizhan/dao/ 包下找 IUserDao.xml 文件</span></span><br><span class="line"><span class="comment">    &lt;mappers&gt;</span></span><br><span class="line"><span class="comment">        &lt;mapper resource="club/guoshizhan/dao/IUserDao.xml"/&gt;</span></span><br><span class="line"><span class="comment">    &lt;/mappers&gt;</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 06-如果使用注解的方式，那么此处应该使用 class 属性指定被注解的 Dao 的全限定类名 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">"club.guoshizhan.dao.IUserDao"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>第七步：</code> 在 <code>resources</code> 目录下 <strong><em>新建 <code>log4j.properties</code> 日志文件</em></strong> ，用于打印日志。代码如下：</p>
<figure class="highlight properties"><figcaption><span>log4j.properties</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Set root category priority to INFO and its only appender to CONSOLE.</span></span><br><span class="line"><span class="comment">#log4j.rootCategory=INFO, CONSOLE            debug   info   warn error fatal</span></span><br><span class="line"><span class="meta">log4j.rootCategory</span>=<span class="string">debug, CONSOLE, LOGFILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the enterprise logger category to FATAL and its only appender to CONSOLE.</span></span><br><span class="line"><span class="meta">log4j.logger.org.apache.axis.enterprise</span>=<span class="string">FATAL, CONSOLE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># CONSOLE is set to be a ConsoleAppender using a PatternLayout.</span></span><br><span class="line"><span class="meta">log4j.appender.CONSOLE</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="meta">log4j.appender.CONSOLE.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="meta">log4j.appender.CONSOLE.layout.ConversionPattern</span>=<span class="string">%d&#123;ISO8601&#125; %-6r [%15.15t] %-5p %30.30c %x - %m\n</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># LOGFILE is set to be a File appender using a PatternLayout.</span></span><br><span class="line"><span class="meta">log4j.appender.LOGFILE</span>=<span class="string">org.apache.log4j.FileAppender</span></span><br><span class="line"><span class="meta">log4j.appender.LOGFILE.File</span>=<span class="string">d:\axis.log</span></span><br><span class="line"><span class="meta">log4j.appender.LOGFILE.Append</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">log4j.appender.LOGFILE.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="meta">log4j.appender.LOGFILE.layout.ConversionPattern</span>=<span class="string">%d&#123;ISO8601&#125; %-6r [%15.15t] %-5p %30.30c %x - %m\n</span></span><br></pre></td></tr></table></figure>

<p><code>第八步：</code> 在 <code>test/java</code> 目录下 新建 <code>club.guoshizhan.Test.MybatisTest</code> 类，这样写的目的就是让 IDEA 自动生成三级包结构。然后编写 <code>MybatisTest 类</code> ，代码如下：</p>
<figure class="highlight java"><figcaption><span>MybatisTest.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.dao.IUserDao;</span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/6/23 11:03</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Mybatis 测试类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 01-读取 mybatis 主配置文件</span></span><br><span class="line">        InputStream in = Resources.getResourceAsStream(<span class="string">"SqlMapConfig.xml"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 02-创建 SqlSessionFactory 工厂 ，SqlSessionFactory 是一个接口，不能 new 对象，所以使用它的实现类 SqlSessionFactoryBuilder 来创建对象</span></span><br><span class="line">        SqlSessionFactoryBuilder factory = <span class="keyword">new</span> SqlSessionFactoryBuilder();</span><br><span class="line">        SqlSessionFactory build = factory.build(in);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 03-使用上面创建的工厂来生产 SqlSession 对象，SqlSession 的作用是创建 Dao 接口的代理对象</span></span><br><span class="line">        SqlSession session = build.openSession();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 04-使用 SqlSession 创建 Dao 接口的代理对象</span></span><br><span class="line">        IUserDao userDao = session.getMapper(IUserDao<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 05-使用代理对象执行方法</span></span><br><span class="line">        List&lt;User&gt; users = userDao.findAll();</span><br><span class="line">        <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 06-关闭资源</span></span><br><span class="line">        session.close();</span><br><span class="line">        in.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第九步：</code> 运行 <strong><em>MybatisTest 测试类中的</em></strong> <code>main</code> 方法，结果如下：</p>
<p><img src="../gallery/Java-Study/Mybatis/mybatis-017.png" alt=""></p>
<blockquote>
<p><code>注解使用总结：</code></p>
<p><strong><em>1、把 IUserDao.xml 移除，在 dao 接口中的方法上使用 @Select 注解，并且指定 SQL 语句。</em></strong><br><strong><em>2、同时需要在 SqlMapConfig.xml 中的 mapper 配置时，使用 class 属性指定 dao 接口的全限定类名。</em></strong></p>
</blockquote>
<h2 id="自定义-mybatis-框架"><a href="#自定义-mybatis-框架" class="headerlink" title="自定义 mybatis 框架"></a>自定义 mybatis 框架</h2><hr/>

<p><code>第一步：</code> 创建一个 Maven 工程。这里就不新创建了。具体创建可参考上一小节： <strong><em>mybatis 注解案例</em></strong> 。</p>
<hr/>

<p><code>第二步：</code> 导入相关依赖 。打开 <code>pom.xml</code> 文件，复制如下代码：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>club.guoshizhan<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-03<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- mybatis 依赖，这个依赖注释掉或删掉，因为我们要自己定义一个</span></span><br><span class="line"><span class="comment">        &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">            &lt;groupId&gt;org.mybatis&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">            &lt;artifactId&gt;mybatis&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">            &lt;version&gt;3.4.5&lt;/version&gt;</span></span><br><span class="line"><span class="comment">        &lt;/dependency&gt;</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- mysql 数据库驱动依赖，必须要 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 日志依赖，不是一定要 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 测试依赖，不是一定要 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 用于解析 XML ，必须要 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dom4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dom4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 与 xpath 相关 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jaxen<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jaxen<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>第三步：</code> <strong><em>删除工程中的 <code>src 目录</code> 。</em></strong> 然后把以下压缩文件里的 <strong><em>src 目录</em></strong> 复制到工程中。做这一步的原因主要是不想再去重复创建上面几个小结的步骤，也是为了节省时间。代码都是看的懂的。压缩包点击即可下载： <a href="../gallery/Resources/src.zip">src 目录文件的压缩包</a> 复制完成之后的工程截图如下：</p>
<p><img src="../gallery/Java-Study/Mybatis/mybatis-018.png" alt=""></p>
<p><code>第四步：</code> 在 <strong><em>guoshizhan 包</em></strong> 下新建 <code>mybatis 包</code> ，然后在 <strong><em>mybatis</em></strong> 包中新建 <code>Resources 类</code> 。该类的代码如下： </p>
<figure class="highlight java"><figcaption><span>Resources.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.mybatis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/7/8 0:38</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 使用类加载器读取配置文件的类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Resources</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据传入的参数，获取一个字节输入流</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> InputStream <span class="title">getResourceAsStream</span><span class="params">(String filePath)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Resources<span class="class">.<span class="keyword">class</span>.<span class="title">getClassLoader</span>().<span class="title">getResourceAsStream</span>(<span class="title">filePath</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接着在 <code>mybatis 包</code> 下新建 <code>SqlSession 接口</code> ，该接口的代码如下： </p>
<figure class="highlight java"><figcaption><span>SqlSession.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.mybatis;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/7/8 0:52</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 自定义 SqlSession 接口，这是和数据库交互的核心接口，它里面可以创建 dao 接口的代理对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SqlSession</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 dao 接口的字节码创建一个代理对象</span></span><br><span class="line">    &lt;T&gt; <span class="function">T <span class="title">getMapper</span><span class="params">(Class&lt;T&gt; daoInterfaceClass)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 释放资源</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">close</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在 <code>mybatis 包</code> 下新建 <code>SqlSessionFactory 接口</code> ，该接口的代码如下： </p>
<figure class="highlight java"><figcaption><span>SqlSessionFactory.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.mybatis;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/7/8 0:47</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 自定义 SqlSessionFactory 接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SqlSessionFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用于打开一个新的 SqpSession 对象</span></span><br><span class="line">    <span class="function">SqlSession <span class="title">openSession</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后在 <code>mybatis 包</code> 下新建 <code>SqlSessionFactoryBuilder 类</code> ，该类初始代码如下【后面还需完善】： </p>
<figure class="highlight java"><figcaption><span>SqlSessionFactoryBuilder.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.mybatis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/7/8 0:45</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 自定义 SqlSessionFactoryBuilder 类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SqlSessionFactoryBuilder</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SqlSessionFactory <span class="title">build</span><span class="params">(InputStream config)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当类和接口创建好后，就去把 <code>MybatisTest 测试类</code> 中的报红问题解决。先删除无用的包，然后导入自定义的接口和类即可。最终 <code>MybatisTest 测试类</code> 代码和截图如下：</p>
<p><img src="../gallery/Java-Study/Mybatis/mybatis-019.png" alt=""></p>
<figure class="highlight java"><figcaption><span>MybatisTest.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.dao.IUserDao;</span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.User;</span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.mybatis.Resources;</span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.mybatis.SqlSession;</span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.mybatis.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.mybatis.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/6/23 11:03</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Mybatis 测试类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 01-读取配置文件</span></span><br><span class="line">        InputStream in = Resources.getResourceAsStream(<span class="string">"SqlMapConfig.xml"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 02-创建 SqlSessionFactory 工厂 ，SqlSessionFactory 是一个接口，不能 new 对象</span></span><br><span class="line">        SqlSessionFactoryBuilder factory = <span class="keyword">new</span> SqlSessionFactoryBuilder();</span><br><span class="line">        SqlSessionFactory build = factory.build(in);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 03-使用工厂生产 SqlSession 对象</span></span><br><span class="line">        SqlSession session = build.openSession();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 04-使用 SqlSession 创建 Dao 接口的代理对象</span></span><br><span class="line">        IUserDao userDao = session.getMapper(IUserDao<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 05-使用代理对象执行方法</span></span><br><span class="line">        List&lt;User&gt; users = userDao.findAll();</span><br><span class="line">        <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 06-关闭资源</span></span><br><span class="line">        session.close();</span><br><span class="line">        in.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第五步：</code> <strong><em>解析 XML 配置文件</em></strong> 。首先在 <code>mybatis 包</code> 下新建 <code>Configuration 配置类</code> ，该类的代码如下：</p>
<figure class="highlight java"><figcaption><span>Configuration.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.mybatis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/7/8 10:08</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 自定义 mybatis 的配置类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Configuration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String driver;</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Mapper&gt; mappers = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Mapper&gt; <span class="title">getMappers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mappers;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMappers</span><span class="params">(Map&lt;String, Mapper&gt; mappers)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mappers.putAll(mappers);    <span class="comment">// 采用追加方式，而不是覆盖【this.mappers = mappers】</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDriver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> driver;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDriver</span><span class="params">(String driver)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.driver = driver;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUrl</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUrl</span><span class="params">(String url)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.url = url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在 <code>mybatis 包</code> 下新建 <code>Mapper 类</code> ，该类的代码如下：</p>
<figure class="highlight java"><figcaption><span>Mapper.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.mybatis;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/7/8 10:12</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 用于封装执行的 SQL 语句和结果类型的全限定类名</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Mapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String queryString;    <span class="comment">// SQL</span></span><br><span class="line">    <span class="keyword">private</span> String resultType;     <span class="comment">// 实体类的全限定类名</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getQueryString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> queryString;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setQueryString</span><span class="params">(String queryString)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.queryString = queryString;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getResultType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> resultType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setResultType</span><span class="params">(String resultType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.resultType = resultType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后在 <code>mybatis 包</code> 下新建 <code>XMLConfigBuilder 类</code> <strong><em>用于解析 xml 文件</em></strong> 。该类的代码如下：</p>
<figure class="highlight java"><figcaption><span>XMLConfigBuilder.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.mybatis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.dom4j.Attribute;</span><br><span class="line"><span class="keyword">import</span> org.dom4j.Document;</span><br><span class="line"><span class="keyword">import</span> org.dom4j.Element;</span><br><span class="line"><span class="keyword">import</span> org.dom4j.io.SAXReader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XMLConfigBuilder</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 解析主配置文件，把里面的内容填充到DefaultSqlSession所需要的地方</span></span><br><span class="line"><span class="comment">     * 使用的技术：dom4j + xpath</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Configuration <span class="title">loadConfiguration</span><span class="params">(InputStream config)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 定义封装连接信息的配置对象（mybatis的配置对象）</span></span><br><span class="line">            Configuration cfg = <span class="keyword">new</span> Configuration();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 1.获取 SAXReader 对象</span></span><br><span class="line">            SAXReader reader = <span class="keyword">new</span> SAXReader();</span><br><span class="line">            <span class="comment">// 2.根据字节输入流获取 Document 对象</span></span><br><span class="line">            Document document = reader.read(config);</span><br><span class="line">            <span class="comment">// 3.获取根节点</span></span><br><span class="line">            Element root = document.getRootElement();</span><br><span class="line">            <span class="comment">// 4.使用 xpath 中选择指定节点的方式，获取所有 property 节点</span></span><br><span class="line">            List&lt;Element&gt; propertyElements = root.selectNodes(<span class="string">"//property"</span>);</span><br><span class="line">            <span class="comment">// 5.遍历节点</span></span><br><span class="line">            <span class="keyword">for</span> (Element propertyElement : propertyElements) &#123;</span><br><span class="line">                <span class="comment">//判断节点是连接数据库的哪部分信息</span></span><br><span class="line">                <span class="comment">//取出name属性的值</span></span><br><span class="line">                String name = propertyElement.attributeValue(<span class="string">"name"</span>);</span><br><span class="line">                <span class="keyword">if</span> (<span class="string">"driver"</span>.equals(name)) &#123;</span><br><span class="line">                    <span class="comment">//表示驱动</span></span><br><span class="line">                    <span class="comment">//获取property标签value属性的值</span></span><br><span class="line">                    String driver = propertyElement.attributeValue(<span class="string">"value"</span>);</span><br><span class="line">                    cfg.setDriver(driver);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (<span class="string">"url"</span>.equals(name)) &#123;</span><br><span class="line">                    <span class="comment">//表示连接字符串</span></span><br><span class="line">                    <span class="comment">//获取property标签value属性的值</span></span><br><span class="line">                    String url = propertyElement.attributeValue(<span class="string">"value"</span>);</span><br><span class="line">                    cfg.setUrl(url);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (<span class="string">"username"</span>.equals(name)) &#123;</span><br><span class="line">                    <span class="comment">//表示用户名</span></span><br><span class="line">                    <span class="comment">//获取property标签value属性的值</span></span><br><span class="line">                    String username = propertyElement.attributeValue(<span class="string">"value"</span>);</span><br><span class="line">                    cfg.setUsername(username);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (<span class="string">"password"</span>.equals(name)) &#123;</span><br><span class="line">                    <span class="comment">// 表示密码</span></span><br><span class="line">                    <span class="comment">// 获取 property 标签 value 属性的值</span></span><br><span class="line">                    String password = propertyElement.attributeValue(<span class="string">"value"</span>);</span><br><span class="line">                    cfg.setPassword(password);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 取出 mappers 中的所有 mapper 标签，判断他们使用了 resource 还是 class 属性</span></span><br><span class="line">            List&lt;Element&gt; mapperElements = root.selectNodes(<span class="string">"//mappers/mapper"</span>);</span><br><span class="line">            <span class="comment">// 遍历集合</span></span><br><span class="line">            <span class="keyword">for</span> (Element mapperElement : mapperElements) &#123;</span><br><span class="line">                <span class="comment">// 判断 mapperElement 使用的是哪个属性</span></span><br><span class="line">                Attribute attribute = mapperElement.attribute(<span class="string">"resource"</span>);</span><br><span class="line">                <span class="keyword">if</span> (attribute != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    System.out.println(<span class="string">"使用的是 XML "</span>);</span><br><span class="line">                    <span class="comment">// 表示有 resource 属性，用的是XML</span></span><br><span class="line">                    <span class="comment">// 取出属性的值</span></span><br><span class="line">                    String mapperPath = attribute.getValue();  <span class="comment">// 获取属性的值"club/guoshizhan/dao/IUserDao.xml"</span></span><br><span class="line">                    <span class="comment">// 把映射配置文件的内容获取出来，封装成一个 map</span></span><br><span class="line">                    Map&lt;String, Mapper&gt; mappers = loadMapperConfiguration(mapperPath);</span><br><span class="line">                    <span class="comment">// 给 configuration 中的 mappers 赋值</span></span><br><span class="line">                    cfg.setMappers(mappers);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">/*System.out.println("使用的是注解");</span></span><br><span class="line"><span class="comment">                    //表示没有resource属性，用的是注解</span></span><br><span class="line"><span class="comment">                    //获取class属性的值</span></span><br><span class="line"><span class="comment">                    String daoClassPath = mapperElement.attributeValue("class");</span></span><br><span class="line"><span class="comment">                    //根据daoClassPath获取封装的必要信息</span></span><br><span class="line"><span class="comment">                    Map&lt;String, Mapper&gt; mappers = loadMapperAnnotation(daoClassPath);</span></span><br><span class="line"><span class="comment">                    //给configuration中的mappers赋值</span></span><br><span class="line"><span class="comment">                    cfg.setMappers(mappers);*/</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 返回 Configuration</span></span><br><span class="line">            <span class="keyword">return</span> cfg;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                config.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据传入的参数，解析XML，并且封装到Map中</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> mapperPath 映射配置文件的位置</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> map中包含了获取的唯一标识（key是由dao的全限定类名和方法名组成）</span></span><br><span class="line"><span class="comment">     * 以及执行所需的必要信息（value是一个Mapper对象，里面存放的是执行的SQL语句和要封装的实体类全限定类名）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Mapper&gt; <span class="title">loadMapperConfiguration</span><span class="params">(String mapperPath)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        InputStream in = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 定义返回值对象</span></span><br><span class="line">            Map&lt;String, Mapper&gt; mappers = <span class="keyword">new</span> HashMap&lt;String, Mapper&gt;();</span><br><span class="line">            <span class="comment">// 1.根据路径获取字节输入流</span></span><br><span class="line">            in = Resources.getResourceAsStream(mapperPath);</span><br><span class="line">            <span class="comment">// 2.根据字节输入流获取 Document 对象</span></span><br><span class="line">            SAXReader reader = <span class="keyword">new</span> SAXReader();</span><br><span class="line">            Document document = reader.read(in);</span><br><span class="line">            <span class="comment">// 3.获取根节点</span></span><br><span class="line">            Element root = document.getRootElement();</span><br><span class="line">            <span class="comment">// 4.获取根节点的 namespace 属性取值</span></span><br><span class="line">            String namespace = root.attributeValue(<span class="string">"namespace"</span>);  <span class="comment">// 是组成 map 中 key 的部分</span></span><br><span class="line">            <span class="comment">// 5.获取所有的 select 节点</span></span><br><span class="line">            List&lt;Element&gt; selectElements = root.selectNodes(<span class="string">"//select"</span>);</span><br><span class="line">            <span class="comment">// 6.遍历 select 节点集合</span></span><br><span class="line">            <span class="keyword">for</span> (Element selectElement : selectElements) &#123;</span><br><span class="line">                <span class="comment">// 取出 id 属性的值【map 中 key 的部分】</span></span><br><span class="line">                String id = selectElement.attributeValue(<span class="string">"id"</span>);</span><br><span class="line">                <span class="comment">// 取出 resultType 属性的值  组成map中value的部分</span></span><br><span class="line">                String resultType = selectElement.attributeValue(<span class="string">"resultType"</span>);</span><br><span class="line">                <span class="comment">// 取出文本内容【map 中 value 的部分】</span></span><br><span class="line">                String queryString = selectElement.getText();</span><br><span class="line">                <span class="comment">// 创建 Key</span></span><br><span class="line">                String key = namespace + <span class="string">"."</span> + id;</span><br><span class="line">                <span class="comment">// 创建 Value</span></span><br><span class="line">                Mapper mapper = <span class="keyword">new</span> Mapper();</span><br><span class="line">                mapper.setQueryString(queryString);</span><br><span class="line">                mapper.setResultType(resultType);</span><br><span class="line">                <span class="comment">// 把 key 和 value 存入 mappers 中</span></span><br><span class="line">                mappers.put(key, mapper);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> mappers;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            in.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据传入的参数，得到 dao 中所有被 select 注解标注的方法。</span></span><br><span class="line"><span class="comment">     * 根据方法名称和类名，以及方法上注解 value 属性的值，组成 Mapper 的必要信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">/*private static Map&lt;String, Mapper&gt; loadMapperAnnotation(String daoClassPath) throws Exception &#123;</span></span><br><span class="line"><span class="comment">        //定义返回值对象</span></span><br><span class="line"><span class="comment">        Map&lt;String, Mapper&gt; mappers = new HashMap&lt;String, Mapper&gt;();</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        //1.得到dao接口的字节码对象</span></span><br><span class="line"><span class="comment">        Class daoClass = Class.forName(daoClassPath);</span></span><br><span class="line"><span class="comment">        //2.得到dao接口中的方法数组</span></span><br><span class="line"><span class="comment">        Method[] methods = daoClass.getMethods();</span></span><br><span class="line"><span class="comment">        //3.遍历Method数组</span></span><br><span class="line"><span class="comment">        for (Method method : methods) &#123;</span></span><br><span class="line"><span class="comment">            //取出每一个方法，判断是否有select注解</span></span><br><span class="line"><span class="comment">            boolean isAnnotated = method.isAnnotationPresent(Select.class);</span></span><br><span class="line"><span class="comment">            if (isAnnotated) &#123;</span></span><br><span class="line"><span class="comment">                //创建Mapper对象</span></span><br><span class="line"><span class="comment">                Mapper mapper = new Mapper();</span></span><br><span class="line"><span class="comment">                //取出注解的value属性值</span></span><br><span class="line"><span class="comment">                Select selectAnno = method.getAnnotation(Select.class);</span></span><br><span class="line"><span class="comment">                String queryString = selectAnno.value();</span></span><br><span class="line"><span class="comment">                mapper.setQueryString(queryString);</span></span><br><span class="line"><span class="comment">                //获取当前方法的返回值，还要求必须带有泛型信息</span></span><br><span class="line"><span class="comment">                Type type = method.getGenericReturnType();//List&lt;User&gt;</span></span><br><span class="line"><span class="comment">                //判断type是不是参数化的类型</span></span><br><span class="line"><span class="comment">                if (type instanceof ParameterizedType) &#123;</span></span><br><span class="line"><span class="comment">                    //强转</span></span><br><span class="line"><span class="comment">                    ParameterizedType ptype = (ParameterizedType) type;</span></span><br><span class="line"><span class="comment">                    //得到参数化类型中的实际类型参数</span></span><br><span class="line"><span class="comment">                    Type[] types = ptype.getActualTypeArguments();</span></span><br><span class="line"><span class="comment">                    //取出第一个</span></span><br><span class="line"><span class="comment">                    Class domainClass = (Class) types[0];</span></span><br><span class="line"><span class="comment">                    //获取domainClass的类名</span></span><br><span class="line"><span class="comment">                    String resultType = domainClass.getName();</span></span><br><span class="line"><span class="comment">                    //给Mapper赋值</span></span><br><span class="line"><span class="comment">                    mapper.setResultType(resultType);</span></span><br><span class="line"><span class="comment">                &#125;</span></span><br><span class="line"><span class="comment">                //组装key的信息</span></span><br><span class="line"><span class="comment">                //获取方法的名称</span></span><br><span class="line"><span class="comment">                String methodName = method.getName();</span></span><br><span class="line"><span class="comment">                String className = method.getDeclaringClass().getName();</span></span><br><span class="line"><span class="comment">                String key = className + "." + methodName;</span></span><br><span class="line"><span class="comment">                //给map赋值</span></span><br><span class="line"><span class="comment">                mappers.put(key, mapper);</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        return mappers;</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第六步：</code> <strong><em>编写工具类和代理类</em></strong> 。首先在 <code>mybatis 包</code> 下新建 <code>DataSourceUtil 类</code> ，该类的代码如下：</p>
<figure class="highlight java"><figcaption><span>DataSourceUtil.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.mybatis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/7/8 13:38</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 创建数据源的工具类 DataSourceUtil</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataSourceUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用于获取一个连接</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">(Configuration cfg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(cfg.getDriver());</span><br><span class="line">            <span class="keyword">return</span> DriverManager.getConnection(cfg.getUrl(), cfg.getUsername(), cfg.getPassword());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接着在 <code>mybatis 包</code> 下新建 <code>Executor 类</code> ，该类的代码如下：</p>
<figure class="highlight java"><figcaption><span>Executor.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.mybatis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.beans.PropertyDescriptor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSetMetaData;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Executor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> &lt;E&gt; <span class="function">List&lt;E&gt; <span class="title">selectList</span><span class="params">(Mapper mapper, Connection conn)</span> </span>&#123;</span><br><span class="line">        PreparedStatement pstm = <span class="keyword">null</span>;</span><br><span class="line">        ResultSet rs = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1.取出 mapper 中的数据</span></span><br><span class="line">            String queryString = mapper.getQueryString();  <span class="comment">// select * from user</span></span><br><span class="line">            String resultType = mapper.getResultType();</span><br><span class="line">            Class domainClass = Class.forName(resultType);</span><br><span class="line">            <span class="comment">// 2.获取 PreparedStatement 对象</span></span><br><span class="line">            pstm = conn.prepareStatement(queryString);</span><br><span class="line">            <span class="comment">// 3.执行 SQL 语句，获取结果集</span></span><br><span class="line">            rs = pstm.executeQuery();</span><br><span class="line">            <span class="comment">// 4.封装结果集</span></span><br><span class="line">            List&lt;E&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();  <span class="comment">// 定义返回值</span></span><br><span class="line">            <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                <span class="comment">// 实例化要封装的实体类对象</span></span><br><span class="line">                E obj = (E) domainClass.newInstance();</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 取出结果集的元信息：ResultSetMetaData</span></span><br><span class="line">                ResultSetMetaData rsmd = rs.getMetaData();</span><br><span class="line">                <span class="comment">// 取出总列数</span></span><br><span class="line">                <span class="keyword">int</span> columnCount = rsmd.getColumnCount();</span><br><span class="line">                <span class="comment">// 遍历总列数</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= columnCount; i++) &#123;</span><br><span class="line">                    <span class="comment">// 获取每列的名称，列名的序号是从1开始的</span></span><br><span class="line">                    String columnName = rsmd.getColumnName(i);</span><br><span class="line">                    <span class="comment">// 根据得到列名，获取每列的值</span></span><br><span class="line">                    Object columnValue = rs.getObject(columnName);</span><br><span class="line">                    <span class="comment">// 给obj赋值：使用 Java 内省机制（借助 PropertyDescriptor 实现属性的封装）</span></span><br><span class="line">                    PropertyDescriptor pd = <span class="keyword">new</span> PropertyDescriptor(columnName, domainClass);  <span class="comment">// 要求：实体类的属性和数据库表的列名保持一种</span></span><br><span class="line">                    <span class="comment">// 获取它的写入方法</span></span><br><span class="line">                    Method writeMethod = pd.getWriteMethod();</span><br><span class="line">                    <span class="comment">// 把获取的列的值，给对象赋值</span></span><br><span class="line">                    writeMethod.invoke(obj, columnValue);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 把赋好值的对象加入到集合中</span></span><br><span class="line">                list.add(obj);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> list;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            release(pstm, rs);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">release</span><span class="params">(PreparedStatement pstm, ResultSet rs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (rs != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                rs.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (pstm != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                pstm.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后在 <code>mybatis 包</code> 下新建 <code>MapperProxy 类</code> ，该类的代码如下：</p>
<figure class="highlight java"><figcaption><span>MapperProxy.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.mybatis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/7/8 13:21</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: MapperProxy 代理类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MapperProxy</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Mapper&gt; mappers;</span><br><span class="line">    <span class="keyword">private</span> Connection connection;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MapperProxy</span><span class="params">(Map&lt;String, Mapper&gt; mappers, Connection connection)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mappers = mappers;</span><br><span class="line">        <span class="keyword">this</span>.connection = connection;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、获取方法名</span></span><br><span class="line">        String methodName = method.getName();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、获取方法所在的类名称</span></span><br><span class="line">        String className = method.getDeclaringClass().getName();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、组合 key</span></span><br><span class="line">        String key = className + <span class="string">"."</span> + methodName;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、获取 mappers 中的 Mapper 对象</span></span><br><span class="line">        Mapper mapper = mappers.get(key);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5、判断是否有 mapper</span></span><br><span class="line">        <span class="keyword">if</span> (mapper == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"The args is wrong!!!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6、调用工具类执行查询所有</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Executor().selectList(mapper, connection);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第七步：</code> <strong><em>编写实现类</em></strong> 。首先在 <code>mybatis 包</code> 下新建 <code>DefaultSqlSession 类</code> <strong><em>来实现 SqlSession 接口</em></strong>，该类的代码如下：</p>
<figure class="highlight java"><figcaption><span>DefaultSqlSession.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.mybatis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/7/8 10:52</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: SqlSession 接口的实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultSqlSession</span> <span class="keyword">implements</span> <span class="title">SqlSession</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Configuration cfg;</span><br><span class="line">    <span class="keyword">private</span> Connection conn;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DefaultSqlSession</span><span class="params">(Configuration cfg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.cfg = cfg;</span><br><span class="line">        conn = DataSourceUtil.getConnection(cfg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用于创建代理对象</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">getMapper</span><span class="params">(Class&lt;T&gt; daoInterfaceClass)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (T) Proxy.newProxyInstance(daoInterfaceClass.getClassLoader(), <span class="keyword">new</span> Class[]&#123;daoInterfaceClass&#125;, <span class="keyword">new</span> MapperProxy(cfg.getMappers(), conn));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用于释放资源</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (conn != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                conn.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接着在 <code>mybatis 包</code> 下新建 <code>DefaultSqlSessionFactory 类</code> <strong><em>来实现 SqlSessionFactory 接口</em></strong>，该类的代码如下：</p>
<figure class="highlight java"><figcaption><span>DefaultSqlSessionFactory.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.mybatis;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/7/8 10:55</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: SqlSessionFactory 接口的实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultSqlSessionFactory</span> <span class="keyword">implements</span> <span class="title">SqlSessionFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Configuration cfg;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DefaultSqlSessionFactory</span><span class="params">(Configuration cfg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.cfg = cfg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用于创建一个新的操作数据库对象</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SqlSession <span class="title">openSession</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DefaultSqlSession(cfg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后继续编写 <code>mybatis 包</code> 下的 <code>SqlSessionFactoryBuilder 类</code> 【原先没有写完】，该类的代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.mybatis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/7/8 0:45</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 自定义 SqlSessionFactoryBuilder 类，用于创建一个 SqlSessionFactory 对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SqlSessionFactoryBuilder</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据参数的字节输入流来构建一个 SqlSessionFactory 工厂</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SqlSessionFactory <span class="title">build</span><span class="params">(InputStream config)</span> </span>&#123;</span><br><span class="line">        Configuration cfg = XMLConfigBuilder.loadConfiguration(config);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DefaultSqlSessionFactory(cfg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>最后一步：</code> <strong><em>运行 MybatisTest 测试类中的 <code>main</code> 方法</em></strong> ，结果如下图：</p>
<p><img src="../gallery/Java-Study/Mybatis/mybatis-020.png" alt=""></p>
<hr/>

<p><code>附加功能：</code> <strong><em>自定义 mybatis 并支持注解</em></strong> 。<code>第一步：</code> <strong><em>修改 IUserDao 接口【就是加一个 Select 注解】</em></strong> 。代码如下：</p>
<figure class="highlight java"><figcaption><span>IUserDao.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.User;</span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.mybatis.Select;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/6/22 23:53</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 用户持久层接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUserDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有用户</span></span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">"select * from user"</span>)</span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第二步：</code> <strong><em>修改 <code>SqlMapConfig.xml</code> 配置文件中的 mapper 属性，将其改为 class</em></strong> 。代码如下：</p>
<figure class="highlight xml"><figcaption><span>SqlMapConfig.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 06-使用注解的话，将 mapper 属性改为 class --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">"club.guoshizhan.dao.IUserDao"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>第三步：</code> <strong><em>新建 Select 注解类</em></strong> 。在 <code>mybatis 包</code> 下新建 <code>Select 注解</code> 。代码如下：</p>
<figure class="highlight java"><figcaption><span>Select.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.mybatis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/7/8 15:10</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 自定义的 Select 注解</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Target</span>(ElementType.METHOD)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Select &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 配置 SQL 语句</span></span><br><span class="line">    <span class="function">String <span class="title">value</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第四步：</code> <strong><em>修改 XMLConfigBuilder 类</em></strong> 。<strong><em>即把原先注释的部分放开【原先注解部分被注释掉了】</em></strong> 。代码如下：</p>
<figure class="highlight java"><figcaption><span>XMLConfigBuilder.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.mybatis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.dom4j.Attribute;</span><br><span class="line"><span class="keyword">import</span> org.dom4j.Document;</span><br><span class="line"><span class="keyword">import</span> org.dom4j.Element;</span><br><span class="line"><span class="keyword">import</span> org.dom4j.io.SAXReader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.ParameterizedType;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Type;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XMLConfigBuilder</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 解析主配置文件，把里面的内容填充到DefaultSqlSession所需要的地方</span></span><br><span class="line"><span class="comment">     * 使用的技术：dom4j + xpath</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Configuration <span class="title">loadConfiguration</span><span class="params">(InputStream config)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 定义封装连接信息的配置对象（mybatis的配置对象）</span></span><br><span class="line">            Configuration cfg = <span class="keyword">new</span> Configuration();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 1.获取 SAXReader 对象</span></span><br><span class="line">            SAXReader reader = <span class="keyword">new</span> SAXReader();</span><br><span class="line">            <span class="comment">// 2.根据字节输入流获取 Document 对象</span></span><br><span class="line">            Document document = reader.read(config);</span><br><span class="line">            <span class="comment">// 3.获取根节点</span></span><br><span class="line">            Element root = document.getRootElement();</span><br><span class="line">            <span class="comment">// 4.使用 xpath 中选择指定节点的方式，获取所有 property 节点</span></span><br><span class="line">            List&lt;Element&gt; propertyElements = root.selectNodes(<span class="string">"//property"</span>);</span><br><span class="line">            <span class="comment">// 5.遍历节点</span></span><br><span class="line">            <span class="keyword">for</span> (Element propertyElement : propertyElements) &#123;</span><br><span class="line">                <span class="comment">//判断节点是连接数据库的哪部分信息</span></span><br><span class="line">                <span class="comment">//取出name属性的值</span></span><br><span class="line">                String name = propertyElement.attributeValue(<span class="string">"name"</span>);</span><br><span class="line">                <span class="keyword">if</span> (<span class="string">"driver"</span>.equals(name)) &#123;</span><br><span class="line">                    <span class="comment">//表示驱动</span></span><br><span class="line">                    <span class="comment">//获取property标签value属性的值</span></span><br><span class="line">                    String driver = propertyElement.attributeValue(<span class="string">"value"</span>);</span><br><span class="line">                    cfg.setDriver(driver);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (<span class="string">"url"</span>.equals(name)) &#123;</span><br><span class="line">                    <span class="comment">//表示连接字符串</span></span><br><span class="line">                    <span class="comment">//获取property标签value属性的值</span></span><br><span class="line">                    String url = propertyElement.attributeValue(<span class="string">"value"</span>);</span><br><span class="line">                    cfg.setUrl(url);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (<span class="string">"username"</span>.equals(name)) &#123;</span><br><span class="line">                    <span class="comment">//表示用户名</span></span><br><span class="line">                    <span class="comment">//获取property标签value属性的值</span></span><br><span class="line">                    String username = propertyElement.attributeValue(<span class="string">"value"</span>);</span><br><span class="line">                    cfg.setUsername(username);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (<span class="string">"password"</span>.equals(name)) &#123;</span><br><span class="line">                    <span class="comment">// 表示密码</span></span><br><span class="line">                    <span class="comment">// 获取 property 标签 value 属性的值</span></span><br><span class="line">                    String password = propertyElement.attributeValue(<span class="string">"value"</span>);</span><br><span class="line">                    cfg.setPassword(password);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 取出 mappers 中的所有 mapper 标签，判断他们使用了 resource 还是 class 属性</span></span><br><span class="line">            List&lt;Element&gt; mapperElements = root.selectNodes(<span class="string">"//mappers/mapper"</span>);</span><br><span class="line">            <span class="comment">// 遍历集合</span></span><br><span class="line">            <span class="keyword">for</span> (Element mapperElement : mapperElements) &#123;</span><br><span class="line">                <span class="comment">// 判断 mapperElement 使用的是哪个属性</span></span><br><span class="line">                Attribute attribute = mapperElement.attribute(<span class="string">"resource"</span>);</span><br><span class="line">                <span class="keyword">if</span> (attribute != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    System.out.println(<span class="string">"使用的是 XML "</span>);</span><br><span class="line">                    <span class="comment">// 表示有 resource 属性，用的是XML</span></span><br><span class="line">                    <span class="comment">// 取出属性的值</span></span><br><span class="line">                    String mapperPath = attribute.getValue();  <span class="comment">// 获取属性的值"club/guoshizhan/dao/IUserDao.xml"</span></span><br><span class="line">                    <span class="comment">// 把映射配置文件的内容获取出来，封装成一个 map</span></span><br><span class="line">                    Map&lt;String, Mapper&gt; mappers = loadMapperConfiguration(mapperPath);</span><br><span class="line">                    <span class="comment">// 给 configuration 中的 mappers 赋值</span></span><br><span class="line">                    cfg.setMappers(mappers);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">"使用的是注解"</span>);</span><br><span class="line">                    <span class="comment">//表示没有resource属性，用的是注解</span></span><br><span class="line">                    <span class="comment">//获取class属性的值</span></span><br><span class="line">                    String daoClassPath = mapperElement.attributeValue(<span class="string">"class"</span>);</span><br><span class="line">                    <span class="comment">//根据daoClassPath获取封装的必要信息</span></span><br><span class="line">                    Map&lt;String, Mapper&gt; mappers = loadMapperAnnotation(daoClassPath);</span><br><span class="line">                    <span class="comment">//给configuration中的mappers赋值</span></span><br><span class="line">                    cfg.setMappers(mappers);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 返回 Configuration</span></span><br><span class="line">            <span class="keyword">return</span> cfg;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                config.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据传入的参数，解析XML，并且封装到Map中</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> mapperPath 映射配置文件的位置</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> map中包含了获取的唯一标识（key是由dao的全限定类名和方法名组成）</span></span><br><span class="line"><span class="comment">     * 以及执行所需的必要信息（value是一个Mapper对象，里面存放的是执行的SQL语句和要封装的实体类全限定类名）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Mapper&gt; <span class="title">loadMapperConfiguration</span><span class="params">(String mapperPath)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        InputStream in = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 定义返回值对象</span></span><br><span class="line">            Map&lt;String, Mapper&gt; mappers = <span class="keyword">new</span> HashMap&lt;String, Mapper&gt;();</span><br><span class="line">            <span class="comment">// 1.根据路径获取字节输入流</span></span><br><span class="line">            in = Resources.getResourceAsStream(mapperPath);</span><br><span class="line">            <span class="comment">// 2.根据字节输入流获取 Document 对象</span></span><br><span class="line">            SAXReader reader = <span class="keyword">new</span> SAXReader();</span><br><span class="line">            Document document = reader.read(in);</span><br><span class="line">            <span class="comment">// 3.获取根节点</span></span><br><span class="line">            Element root = document.getRootElement();</span><br><span class="line">            <span class="comment">// 4.获取根节点的 namespace 属性取值</span></span><br><span class="line">            String namespace = root.attributeValue(<span class="string">"namespace"</span>);  <span class="comment">// 是组成 map 中 key 的部分</span></span><br><span class="line">            <span class="comment">// 5.获取所有的 select 节点</span></span><br><span class="line">            List&lt;Element&gt; selectElements = root.selectNodes(<span class="string">"//select"</span>);</span><br><span class="line">            <span class="comment">// 6.遍历 select 节点集合</span></span><br><span class="line">            <span class="keyword">for</span> (Element selectElement : selectElements) &#123;</span><br><span class="line">                <span class="comment">// 取出 id 属性的值【map 中 key 的部分】</span></span><br><span class="line">                String id = selectElement.attributeValue(<span class="string">"id"</span>);</span><br><span class="line">                <span class="comment">// 取出 resultType 属性的值  组成map中value的部分</span></span><br><span class="line">                String resultType = selectElement.attributeValue(<span class="string">"resultType"</span>);</span><br><span class="line">                <span class="comment">// 取出文本内容【map 中 value 的部分】</span></span><br><span class="line">                String queryString = selectElement.getText();</span><br><span class="line">                <span class="comment">// 创建 Key</span></span><br><span class="line">                String key = namespace + <span class="string">"."</span> + id;</span><br><span class="line">                <span class="comment">// 创建 Value</span></span><br><span class="line">                Mapper mapper = <span class="keyword">new</span> Mapper();</span><br><span class="line">                mapper.setQueryString(queryString);</span><br><span class="line">                mapper.setResultType(resultType);</span><br><span class="line">                <span class="comment">// 把 key 和 value 存入 mappers 中</span></span><br><span class="line">                mappers.put(key, mapper);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> mappers;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            in.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据传入的参数，得到 dao 中所有被 select 注解标注的方法。</span></span><br><span class="line"><span class="comment">     * 根据方法名称和类名，以及方法上注解 value 属性的值，组成 Mapper 的必要信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Mapper&gt; <span class="title">loadMapperAnnotation</span><span class="params">(String daoClassPath)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//定义返回值对象</span></span><br><span class="line">        Map&lt;String, Mapper&gt; mappers = <span class="keyword">new</span> HashMap&lt;String, Mapper&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.得到dao接口的字节码对象</span></span><br><span class="line">        Class daoClass = Class.forName(daoClassPath);</span><br><span class="line">        <span class="comment">//2.得到dao接口中的方法数组</span></span><br><span class="line">        Method[] methods = daoClass.getMethods();</span><br><span class="line">        <span class="comment">//3.遍历Method数组</span></span><br><span class="line">        <span class="keyword">for</span> (Method method : methods) &#123;</span><br><span class="line">            <span class="comment">//取出每一个方法，判断是否有select注解</span></span><br><span class="line">            <span class="keyword">boolean</span> isAnnotated = method.isAnnotationPresent(Select<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">            <span class="keyword">if</span> (isAnnotated) &#123;</span><br><span class="line">                <span class="comment">//创建Mapper对象</span></span><br><span class="line">                Mapper mapper = <span class="keyword">new</span> Mapper();</span><br><span class="line">                <span class="comment">//取出注解的value属性值</span></span><br><span class="line">                Select selectAnno = method.getAnnotation(Select<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">                String queryString = selectAnno.value();</span><br><span class="line">                mapper.setQueryString(queryString);</span><br><span class="line">                <span class="comment">//获取当前方法的返回值，还要求必须带有泛型信息</span></span><br><span class="line">                Type type = method.getGenericReturnType();<span class="comment">//List&lt;User&gt;</span></span><br><span class="line">                <span class="comment">//判断type是不是参数化的类型</span></span><br><span class="line">                <span class="keyword">if</span> (type <span class="keyword">instanceof</span> ParameterizedType) &#123;</span><br><span class="line">                    <span class="comment">//强转</span></span><br><span class="line">                    ParameterizedType ptype = (ParameterizedType) type;</span><br><span class="line">                    <span class="comment">//得到参数化类型中的实际类型参数</span></span><br><span class="line">                    Type[] types = ptype.getActualTypeArguments();</span><br><span class="line">                    <span class="comment">//取出第一个</span></span><br><span class="line">                    Class domainClass = (Class) types[<span class="number">0</span>];</span><br><span class="line">                    <span class="comment">//获取domainClass的类名</span></span><br><span class="line">                    String resultType = domainClass.getName();</span><br><span class="line">                    <span class="comment">//给Mapper赋值</span></span><br><span class="line">                    mapper.setResultType(resultType);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//组装key的信息</span></span><br><span class="line">                <span class="comment">//获取方法的名称</span></span><br><span class="line">                String methodName = method.getName();</span><br><span class="line">                String className = method.getDeclaringClass().getName();</span><br><span class="line">                String key = className + <span class="string">"."</span> + methodName;</span><br><span class="line">                <span class="comment">//给map赋值</span></span><br><span class="line">                mappers.put(key, mapper);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mappers;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>最后一步：</code> <strong><em>运行 MybatisTest 测试类中的 <code>main</code> 方法</em></strong> ，结果如下图：</p>
<p><img src="../gallery/Java-Study/Mybatis/mybatis-021.png" alt=""></p>
<h1 id="mybatis-的基本使用"><a href="#mybatis-的基本使用" class="headerlink" title="mybatis 的基本使用"></a>mybatis 的基本使用</h1><h2 id="mybatis-的单表操作"><a href="#mybatis-的单表操作" class="headerlink" title="mybatis 的单表操作"></a>mybatis 的单表操作</h2><p>这部分内容主要是用 mybatis 实现对数据库的 <code>添加、删除、修改、查询</code> 操作，<strong><em>使用在第一次搭建环境时候的代码 mybatis-01 （主要是省时间，就不再重新搭建环境了）</em></strong>，在这个工程的代码上进行操作。</p>
<hr>
<h3 id="mybatis-保存操作"><a href="#mybatis-保存操作" class="headerlink" title="mybatis 保存操作"></a>mybatis 保存操作</h3><p><code>第一步：</code> <strong><em>编写 IUserDao 类，新加 <code>保存用户</code> 的方法。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>IUserDao.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/6/22 23:53</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 用户持久层接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUserDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有用户</span></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 保存用户</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">saveUser</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第二步：</code> <strong><em>编写 <code>IUserDao.xml</code> 文件，新加 <code>保存用户</code> 的 SQL 语句（使用 insert 标签的）。</em></strong> 代码如下：</p>
<figure class="highlight xml"><figcaption><span>IUserDao.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 01-持久层映射配置中，mapper 标签的 namespace 属性取值必须是持久层接口的全限定类名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"club.guoshizhan.dao.IUserDao"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 02-查询所有用户：resultType 很重要，是查询结果的封装位置，不写会报错，表示 mybatis 框架不知道把结果往哪里封装 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 03-属性 id 不能随便写，必须是接口中方法的名称 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultType</span>=<span class="string">"club.guoshizhan.domain.User"</span>&gt;</span></span><br><span class="line">      select * from user;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 保存用户。parameterType 是用于指定参数类型，必须加上，否则报错 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 注意：使用 # 号取值，里面的变量名字是和实体类里面的变量一一对应的 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"saveUser"</span> <span class="attr">parameterType</span>=<span class="string">"club.guoshizhan.domain.User"</span>&gt;</span></span><br><span class="line">        insert into user(username,birthday,sex,address) values (#&#123;username&#125;,#&#123;birthday&#125;,#&#123;sex&#125;,#&#123;address&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>第三步：</code> <strong><em>编写 <code>MybatisTest</code> 测试类，然后执行 testSave 方法即可。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>MybatisTest.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.dao.IUserDao;</span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.After;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/6/23 11:03</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Mybatis 测试类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> InputStream in;</span><br><span class="line">    <span class="keyword">private</span> SqlSessionFactory factory;</span><br><span class="line">    <span class="keyword">private</span> SqlSession session;</span><br><span class="line">    <span class="keyword">private</span> IUserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// // 测试方法执行之前执行，用于一些初始化的操作，不理解的应该去看看单元测试相关知识</span></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 01-读取配置文件</span></span><br><span class="line">        in = Resources.getResourceAsStream(<span class="string">"SqlMapConfig.xml"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 02-创建 SqlSessionFactory 工厂 ，SqlSessionFactory 是一个接口，不能 new 对象(因此需要使用它的实现类 SqlSessionFactoryBuilder)</span></span><br><span class="line">        factory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 03-使用工厂生产 SqlSession 对象</span></span><br><span class="line">        session = factory.openSession();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 04-使用 SqlSession 创建 Dao 接口的代理对象</span></span><br><span class="line">        userDao = session.getMapper(IUserDao<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 05-使用代理对象执行方法</span></span><br><span class="line">        List&lt;User&gt; users = userDao.findAll();</span><br><span class="line">        <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSave</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setBirthday(<span class="keyword">new</span> Date());</span><br><span class="line">        user.setAddress(<span class="string">"BeiJing"</span>);</span><br><span class="line">        user.setSex(<span class="string">"女"</span>);</span><br><span class="line">        user.setUsername(<span class="string">"testSave"</span>);</span><br><span class="line">        userDao.saveUser(user);</span><br><span class="line">        session.commit();    <span class="comment">// 提交事务，不写此行代码无法实现保存操作。我们可以把此行代码移动到 destory 方法中。</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试方法执行之后执行，用于释放资源，不理解的应该去看看单元测试相关知识</span></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destory</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 06-关闭资源</span></span><br><span class="line">        session.close();</span><br><span class="line">        in.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><em>如果没有加提交事务那行代码，那么虽然测试成功，但是数据库是查不到数据的。</em></strong> 结果如下图：</p>
<p><img src="../gallery/Java-Study/Mybatis/mybatis-022.png" alt=""></p>
<p><strong><em>加上提交事务的代码，保存操作才可成功。</em></strong> 结果如下图：</p>
<p><img src="../gallery/Java-Study/Mybatis/mybatis-023.png" alt=""></p>
<hr>
<p><code>附加内容，细节操作：</code> 保存操作虽然成功了，<strong><em>但是我们无法获取到保存数据的 id 值。</em></strong> 如下图：</p>
<p><img src="../gallery/Java-Study/Mybatis/mybatis-025.png" alt=""></p>
<p><strong><em>如果我一定要获取保存数据的 id 值，那怎么办呢？</em></strong> 这个简单，只需要修改 <code>IUserDao.xml</code> 文件中的 <strong><em>保存操作</em></strong> 部分即可。<strong><em>使用以下代码覆盖原先的 SQL 语句即可（使用 insert 标签的）。</em></strong> 代码如下：</p>
<figure class="highlight xml"><figcaption><span>IUserDao.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 保存用户。parameterType 是用于指定参数类型，必须加上，否则报错 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 注意：使用 # 号取值，里面的变量名字是和实体类里面的变量一一对应的 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"saveUser"</span> <span class="attr">parameterType</span>=<span class="string">"club.guoshizhan.domain.User"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 插入操作完成后，获取到插入数据的 id 值。keyProperty 对应实体类中的 id。keyColumn 对应数据库的字段。order 代表何时执行此配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">"id"</span> <span class="attr">keyColumn</span>=<span class="string">"id"</span> <span class="attr">resultType</span>=<span class="string">"Integer"</span> <span class="attr">order</span>=<span class="string">"AFTER"</span>&gt;</span></span><br><span class="line">        select last_insert_id();</span><br><span class="line">    <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">    insert into user(username,birthday,sex,address) values (#&#123;username&#125;,#&#123;birthday&#125;,#&#123;sex&#125;,#&#123;address&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>编写完配置之后，<strong><em>我们运行 <code>testSave</code> 方法，这个时候我们就获取到了保存数据的 id 值。</em></strong> 结果如下图：</p>
<p><img src="../gallery/Java-Study/Mybatis/mybatis-026.png" alt=""></p>
<blockquote>
<p><code>TIPS：</code> mybatis 的 <strong><em>保存操作</em></strong> 到此结束！！！</p>
</blockquote>
<h3 id="mybatis-修改操作"><a href="#mybatis-修改操作" class="headerlink" title="mybatis 修改操作"></a>mybatis 修改操作</h3><p><code>第一步：</code> <strong><em>编写 IUserDao 类，新加 <code>修改用户</code> 的方法。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>IUserDao.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/6/22 23:53</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 用户持久层接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUserDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有用户</span></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 保存用户</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">saveUser</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 修改用户</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">updateUser</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第二步：</code> <strong><em>编写 <code>IUserDao.xml</code> 文件，新加 <code>修改用户</code> 的 SQL 语句（使用 update 标签的）。</em></strong> 代码如下：</p>
<figure class="highlight xml"><figcaption><span>IUserDao.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 01-持久层映射配置中，mapper 标签的 namespace 属性取值必须是持久层接口的全限定类名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"club.guoshizhan.dao.IUserDao"</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 02-查询所有用户：resultType 很重要，是查询结果的封装位置，不写会报错，表示 mybatis 框架不知道把结果往哪里封装 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 03-属性 id 不能随便写，必须是接口中方法的名称 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultType</span>=<span class="string">"club.guoshizhan.domain.User"</span>&gt;</span></span><br><span class="line">      select * from user;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 保存用户。parameterType 是用于指定参数类型，必须加上，否则报错 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 注意：使用 # 号取值，里面的变量名字是和实体类里面的变量一一对应的 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"saveUser"</span> <span class="attr">parameterType</span>=<span class="string">"club.guoshizhan.domain.User"</span>&gt;</span></span><br><span class="line">        insert into user(username,birthday,sex,address) values (#&#123;username&#125;,#&#123;birthday&#125;,#&#123;sex&#125;,#&#123;address&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 修改用户 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateUser"</span> <span class="attr">parameterType</span>=<span class="string">"club.guoshizhan.domain.User"</span>&gt;</span></span><br><span class="line">        update user set username=#&#123;username&#125;,birthday=#&#123;birthday&#125;,sex=#&#123;sex&#125;,address=#&#123;address&#125; where id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>第三步：</code> <strong><em>编写 <code>MybatisTest</code> 测试类，然后执行 testUpdate 方法即可。</em></strong> 代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.dao.IUserDao;</span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.After;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/6/23 11:03</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Mybatis 测试类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> InputStream in;</span><br><span class="line">    <span class="keyword">private</span> SqlSessionFactory factory;</span><br><span class="line">    <span class="keyword">private</span> SqlSession session;</span><br><span class="line">    <span class="keyword">private</span> IUserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// // 测试方法执行之前执行，用于一些初始化的操作，不理解的应该去看看单元测试相关知识</span></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 01-读取配置文件</span></span><br><span class="line">        in = Resources.getResourceAsStream(<span class="string">"SqlMapConfig.xml"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 02-创建 SqlSessionFactory 工厂 ，SqlSessionFactory 是一个接口，不能 new 对象(因此需要使用它的实现类 SqlSessionFactoryBuilder)</span></span><br><span class="line">        factory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 03-使用工厂生产 SqlSession 对象</span></span><br><span class="line">        session = factory.openSession();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 04-使用 SqlSession 创建 Dao 接口的代理对象</span></span><br><span class="line">        userDao = session.getMapper(IUserDao<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有用户</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 05-使用代理对象执行方法</span></span><br><span class="line">        List&lt;User&gt; users = userDao.findAll();</span><br><span class="line">        <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 保存用户</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSave</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setBirthday(<span class="keyword">new</span> Date());</span><br><span class="line">        user.setAddress(<span class="string">"BeiJing"</span>);</span><br><span class="line">        user.setSex(<span class="string">"女"</span>);</span><br><span class="line">        user.setUsername(<span class="string">"testSave"</span>);</span><br><span class="line">        userDao.saveUser(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 修改用户</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setId(<span class="number">57</span>);    <span class="comment">// 57 是刚刚 testSave 方法保存的数据的 id。每个人的不一样，需要修改成你数据库中有的数据</span></span><br><span class="line">        user.setAddress(<span class="string">"ShangHai"</span>);</span><br><span class="line">        user.setBirthday(<span class="keyword">new</span> Date());</span><br><span class="line">        user.setSex(<span class="string">"女"</span>);</span><br><span class="line">        user.setUsername(<span class="string">"testUpdate"</span>);</span><br><span class="line">        userDao.updateUser(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试方法执行之后执行，用于释放资源，不理解的应该去看看单元测试相关知识</span></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destory</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 06-关闭资源</span></span><br><span class="line">        session.commit();    <span class="comment">// 提交事务，不写此行代码无法实现保存操作</span></span><br><span class="line">        session.close();</span><br><span class="line">        in.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><em>执行 testUpdate 方法，</em></strong> 结果如下图：</p>
<p><img src="../gallery/Java-Study/Mybatis/mybatis-024.png" alt=""></p>
<blockquote>
<p><code>TIPS：</code> mybatis 的 <strong><em>修改操作</em></strong> 到此结束！！！</p>
</blockquote>
<h3 id="mybatis-删除操作"><a href="#mybatis-删除操作" class="headerlink" title="mybatis 删除操作"></a>mybatis 删除操作</h3><p><code>第一步：</code> <strong><em>编写 IUserDao 类，新加 <code>根据 id 删除用户</code> 的方法。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>IUserDao.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/6/22 23:53</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 用户持久层接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUserDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有用户</span></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 保存用户</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">saveUser</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 修改用户</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">updateUser</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 id 删除用户</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteUser</span><span class="params">(Integer id)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第二步：</code> <strong><em>编写 <code>IUserDao.xml</code> 文件，新加 <code>根据 id 删除用户</code> 的 SQL 语句（使用 delete 标签的）。</em></strong> 代码如下：</p>
<figure class="highlight xml"><figcaption><span>IUserDao.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 01-持久层映射配置中，mapper 标签的 namespace 属性取值必须是持久层接口的全限定类名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"club.guoshizhan.dao.IUserDao"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 02-查询所有用户：resultType 很重要，是查询结果的封装位置，不写会报错，表示 mybatis 框架不知道把结果往哪里封装 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 03-属性 id 不能随便写，必须是接口中方法的名称 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultType</span>=<span class="string">"club.guoshizhan.domain.User"</span>&gt;</span></span><br><span class="line">      select * from user;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 保存用户。parameterType 是用于指定参数类型，必须加上，否则报错 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 注意：使用 # 号取值，里面的变量名字是和实体类里面的变量一一对应的 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"saveUser"</span> <span class="attr">parameterType</span>=<span class="string">"club.guoshizhan.domain.User"</span>&gt;</span></span><br><span class="line">        insert into user(username,birthday,sex,address) values (#&#123;username&#125;,#&#123;birthday&#125;,#&#123;sex&#125;,#&#123;address&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 修改用户 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateUser"</span> <span class="attr">parameterType</span>=<span class="string">"club.guoshizhan.domain.User"</span>&gt;</span></span><br><span class="line">        update user set username=#&#123;username&#125;,birthday=#&#123;birthday&#125;,sex=#&#123;sex&#125;,address=#&#123;address&#125; where id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 根据 id 删除用户。注意：当只有一个参数时，占位符名称可以是任意值，我写的是#&#123;id&#125;，也可写#&#123;aa&#125;，都可以 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"deleteUser"</span> <span class="attr">parameterType</span>=<span class="string">"Integer"</span>&gt;</span></span><br><span class="line">        delete from user where id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>第三步：</code> <strong><em>编写 <code>MybatisTest</code> 测试类，然后执行 testDelete 方法即可实现删除操作。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>IUserDao.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.dao.IUserDao;</span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.After;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/6/23 11:03</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Mybatis 测试类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> InputStream in;</span><br><span class="line">    <span class="keyword">private</span> SqlSessionFactory factory;</span><br><span class="line">    <span class="keyword">private</span> SqlSession session;</span><br><span class="line">    <span class="keyword">private</span> IUserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// // 测试方法执行之前执行，用于一些初始化的操作，不理解的应该去看看单元测试相关知识</span></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 01-读取配置文件</span></span><br><span class="line">        in = Resources.getResourceAsStream(<span class="string">"SqlMapConfig.xml"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 02-创建 SqlSessionFactory 工厂 ，SqlSessionFactory 是一个接口，不能 new 对象(因此需要使用它的实现类 SqlSessionFactoryBuilder)</span></span><br><span class="line">        factory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 03-使用工厂生产 SqlSession 对象</span></span><br><span class="line">        session = factory.openSession();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 04-使用 SqlSession 创建 Dao 接口的代理对象</span></span><br><span class="line">        userDao = session.getMapper(IUserDao<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有用户</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 05-使用代理对象执行方法</span></span><br><span class="line">        List&lt;User&gt; users = userDao.findAll();</span><br><span class="line">        <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 保存用户</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSave</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setBirthday(<span class="keyword">new</span> Date());</span><br><span class="line">        user.setAddress(<span class="string">"BeiJing"</span>);</span><br><span class="line">        user.setSex(<span class="string">"女"</span>);</span><br><span class="line">        user.setUsername(<span class="string">"testSave"</span>);</span><br><span class="line">        userDao.saveUser(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 修改用户</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setId(<span class="number">57</span>);    <span class="comment">// 57 是刚刚 testSave 方法保存的数据的 id。每个人的不一样，需要修改成你数据库中有的数据</span></span><br><span class="line">        user.setAddress(<span class="string">"ShangHai"</span>);</span><br><span class="line">        user.setBirthday(<span class="keyword">new</span> Date());</span><br><span class="line">        user.setSex(<span class="string">"女"</span>);</span><br><span class="line">        user.setUsername(<span class="string">"testUpdate"</span>);</span><br><span class="line">        userDao.updateUser(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 id 删除用户</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDelete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        userDao.deleteUser(<span class="number">57</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试方法执行之后执行，用于释放资源，不理解的应该去看看单元测试相关知识</span></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destory</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 06-关闭资源</span></span><br><span class="line">        session.commit();    <span class="comment">// 提交事务，不写此行代码无法实现保存操作</span></span><br><span class="line">        session.close();</span><br><span class="line">        in.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>TIPS：</code> mybatis 的 <strong><em>删除操作</em></strong> 到此结束！！！</p>
</blockquote>
<h3 id="mybatis-查询操作"><a href="#mybatis-查询操作" class="headerlink" title="mybatis 查询操作"></a>mybatis 查询操作</h3><p><code>第一步：</code> <strong><em>编写 IUserDao 类，新加 <code>根据 id 查询用户</code> 的方法。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>IUserDao.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/6/22 23:53</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 用户持久层接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUserDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有用户</span></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 保存用户</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">saveUser</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 修改用户</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">updateUser</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 id 删除用户</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteUser</span><span class="params">(Integer id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 id 查询用户</span></span><br><span class="line">    <span class="function">User <span class="title">findById</span><span class="params">(Integer userId)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第二步：</code> <strong><em>编写 <code>IUserDao.xml</code> 文件，新加 <code>根据 id 查询用户</code> 的 SQL 语句（使用 select 标签的）。</em></strong> 代码如下：</p>
<figure class="highlight xml"><figcaption><span>IUserDao.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 01-持久层映射配置中，mapper 标签的 namespace 属性取值必须是持久层接口的全限定类名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"club.guoshizhan.dao.IUserDao"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 02-查询所有用户：resultType 很重要，是查询结果的封装位置，不写会报错，表示 mybatis 框架不知道把结果往哪里封装 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 03-属性 id 不能随便写，必须是接口中方法的名称 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultType</span>=<span class="string">"club.guoshizhan.domain.User"</span>&gt;</span></span><br><span class="line">      select * from user;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 保存用户。parameterType 是用于指定参数类型，必须加上，否则报错 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 注意：使用 # 号取值，里面的变量名字是和实体类里面的变量一一对应的 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"saveUser"</span> <span class="attr">parameterType</span>=<span class="string">"club.guoshizhan.domain.User"</span>&gt;</span></span><br><span class="line">        insert into user(username,birthday,sex,address) values (#&#123;username&#125;,#&#123;birthday&#125;,#&#123;sex&#125;,#&#123;address&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 修改用户 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateUser"</span> <span class="attr">parameterType</span>=<span class="string">"club.guoshizhan.domain.User"</span>&gt;</span></span><br><span class="line">        update user set username=#&#123;username&#125;,birthday=#&#123;birthday&#125;,sex=#&#123;sex&#125;,address=#&#123;address&#125; where id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 根据 id 删除用户。注意：当只有一个参数时，占位符名称可以是任意值，我写的是#&#123;id&#125;，也可写#&#123;aa&#125;，都可以 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"deleteUser"</span> <span class="attr">parameterType</span>=<span class="string">"Integer"</span>&gt;</span></span><br><span class="line">        delete from user where id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 根据 id 查询用户。注意：1、当只有一个参数时，占位符名称可以是任意值。2、需要指定结果集的返回值类型 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findById"</span> <span class="attr">parameterType</span>=<span class="string">"Integer"</span> <span class="attr">resultType</span>=<span class="string">"club.guoshizhan.domain.User"</span>&gt;</span></span><br><span class="line">        select * from user where id=#&#123;aaabbbccc&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>第三步：</code> <strong><em>编写 <code>MybatisTest</code> 测试类，然后执行 testFindById 方法即可。</em></strong> 代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.dao.IUserDao;</span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.After;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/6/23 11:03</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Mybatis 测试类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> InputStream in;</span><br><span class="line">    <span class="keyword">private</span> SqlSessionFactory factory;</span><br><span class="line">    <span class="keyword">private</span> SqlSession session;</span><br><span class="line">    <span class="keyword">private</span> IUserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// // 测试方法执行之前执行，用于一些初始化的操作，不理解的应该去看看单元测试相关知识</span></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 01-读取配置文件</span></span><br><span class="line">        in = Resources.getResourceAsStream(<span class="string">"SqlMapConfig.xml"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 02-创建 SqlSessionFactory 工厂 ，SqlSessionFactory 是一个接口，不能 new 对象(因此需要使用它的实现类 SqlSessionFactoryBuilder)</span></span><br><span class="line">        factory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 03-使用工厂生产 SqlSession 对象</span></span><br><span class="line">        session = factory.openSession();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 04-使用 SqlSession 创建 Dao 接口的代理对象</span></span><br><span class="line">        userDao = session.getMapper(IUserDao<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有用户</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 05-使用代理对象执行方法</span></span><br><span class="line">        List&lt;User&gt; users = userDao.findAll();</span><br><span class="line">        <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 保存用户</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSave</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setBirthday(<span class="keyword">new</span> Date());</span><br><span class="line">        user.setAddress(<span class="string">"BeiJing"</span>);</span><br><span class="line">        user.setSex(<span class="string">"女"</span>);</span><br><span class="line">        user.setUsername(<span class="string">"testSave"</span>);</span><br><span class="line">        userDao.saveUser(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 修改用户</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setId(<span class="number">57</span>);    <span class="comment">// 57 是刚刚 testSave 方法保存的数据的 id。每个人的不一样，需要修改成你数据库中有的数据</span></span><br><span class="line">        user.setAddress(<span class="string">"ShangHai"</span>);</span><br><span class="line">        user.setBirthday(<span class="keyword">new</span> Date());</span><br><span class="line">        user.setSex(<span class="string">"女"</span>);</span><br><span class="line">        user.setUsername(<span class="string">"testUpdate"</span>);</span><br><span class="line">        userDao.updateUser(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 id 删除用户</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDelete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        userDao.deleteUser(<span class="number">57</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 id 查询用户</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindById</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user = userDao.findById(<span class="number">55</span>);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试方法执行之后执行，用于释放资源，不理解的应该去看看单元测试相关知识</span></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destory</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 06-关闭资源</span></span><br><span class="line">        session.commit();    <span class="comment">// 提交事务，不写此行代码无法实现保存操作</span></span><br><span class="line">        session.close();</span><br><span class="line">        in.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>执行 testFindById 方法便可查询到结果了，这里就不截图了。<strong><em>那么问题来了，如果我需要模糊查询改怎么做呢？安排！！！</em></strong> <code>第一步：</code> <strong><em>编写 IUserDao 类，新加 <code>模糊查询用户</code> 的方法。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>IUserDao.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/6/22 23:53</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 用户持久层接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUserDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有用户</span></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 保存用户</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">saveUser</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 修改用户</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">updateUser</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 id 删除用户</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteUser</span><span class="params">(Integer id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 id 查询用户</span></span><br><span class="line">    <span class="function">User <span class="title">findById</span><span class="params">(Integer userId)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 模糊查询用户</span></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findByName</span><span class="params">(String username)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第二步：</code> <strong><em>编写 <code>IUserDao.xml</code> 文件，新加 <code>模糊查询用户</code> 的 SQL 语句（使用 select 标签的）。</em></strong> 代码如下：</p>
<figure class="highlight xml"><figcaption><span>IUserDao.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 01-持久层映射配置中，mapper 标签的 namespace 属性取值必须是持久层接口的全限定类名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"club.guoshizhan.dao.IUserDao"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 02-查询所有用户：resultType 很重要，是查询结果的封装位置，不写会报错，表示 mybatis 框架不知道把结果往哪里封装 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 03-属性 id 不能随便写，必须是接口中方法的名称 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultType</span>=<span class="string">"club.guoshizhan.domain.User"</span>&gt;</span></span><br><span class="line">      select * from user;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 保存用户。parameterType 是用于指定参数类型，必须加上，否则报错 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 注意：使用 # 号取值，里面的变量名字是和实体类里面的变量一一对应的 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"saveUser"</span> <span class="attr">parameterType</span>=<span class="string">"club.guoshizhan.domain.User"</span>&gt;</span></span><br><span class="line">        insert into user(username,birthday,sex,address) values (#&#123;username&#125;,#&#123;birthday&#125;,#&#123;sex&#125;,#&#123;address&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 修改用户 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateUser"</span> <span class="attr">parameterType</span>=<span class="string">"club.guoshizhan.domain.User"</span>&gt;</span></span><br><span class="line">        update user set username=#&#123;username&#125;,birthday=#&#123;birthday&#125;,sex=#&#123;sex&#125;,address=#&#123;address&#125; where id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 根据 id 删除用户。注意：当只有一个参数时，占位符名称可以是任意值，我写的是#&#123;id&#125;，也可写#&#123;aa&#125;，都可以 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"deleteUser"</span> <span class="attr">parameterType</span>=<span class="string">"Integer"</span>&gt;</span></span><br><span class="line">        delete from user where id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 根据 id 查询用户。注意：1、当只有一个参数时，占位符名称可以是任意值。2、需要指定结果集的返回值类型 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findById"</span> <span class="attr">parameterType</span>=<span class="string">"Integer"</span> <span class="attr">resultType</span>=<span class="string">"club.guoshizhan.domain.User"</span>&gt;</span></span><br><span class="line">        select * from user where id=#&#123;aaabbbccc&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 模糊查询查询用户 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findByName"</span> <span class="attr">parameterType</span>=<span class="string">"String"</span> <span class="attr">resultType</span>=<span class="string">"club.guoshizhan.domain.User"</span>&gt;</span></span><br><span class="line">        -- 如果使用下列语句实现模糊查询，那么需要在测试类的代码中添加上 % 符号，否则查询不出来。</span><br><span class="line">        -- 注意：此处执行的 SQL 语句用的是占位符方式（带有预处理方式），可以防止 SQL 注入，更安全</span><br><span class="line">        select * from user where username like #&#123;name&#125;</span><br><span class="line">        -- 如果使用下列语句实现模糊查询，那么在测试类的代码中就不需要加上 % 了。注意：此处执行的 SQL 语句用的是拼接方式，不安全</span><br><span class="line">        -- 下列语句中的 value 是固定的，不能写成其他的名字，这个是在源码规定好的，详情请参考 TextSqlNode 类</span><br><span class="line">        -- select * from user where username like '%$&#123;value&#125;%'</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>第三步：</code> <strong><em>编写 <code>MybatisTest</code> 测试类，然后执行 testFindByName 方法即可。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>MybatisTest.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.dao.IUserDao;</span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.After;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/6/23 11:03</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Mybatis 测试类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> InputStream in;</span><br><span class="line">    <span class="keyword">private</span> SqlSessionFactory factory;</span><br><span class="line">    <span class="keyword">private</span> SqlSession session;</span><br><span class="line">    <span class="keyword">private</span> IUserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// // 测试方法执行之前执行，用于一些初始化的操作，不理解的应该去看看单元测试相关知识</span></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 01-读取配置文件</span></span><br><span class="line">        in = Resources.getResourceAsStream(<span class="string">"SqlMapConfig.xml"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 02-创建 SqlSessionFactory 工厂 ，SqlSessionFactory 是一个接口，不能 new 对象(因此需要使用它的实现类 SqlSessionFactoryBuilder)</span></span><br><span class="line">        factory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 03-使用工厂生产 SqlSession 对象</span></span><br><span class="line">        session = factory.openSession();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 04-使用 SqlSession 创建 Dao 接口的代理对象</span></span><br><span class="line">        userDao = session.getMapper(IUserDao<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有用户</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 05-使用代理对象执行方法</span></span><br><span class="line">        List&lt;User&gt; users = userDao.findAll();</span><br><span class="line">        <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 保存用户</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSave</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setBirthday(<span class="keyword">new</span> Date());</span><br><span class="line">        user.setAddress(<span class="string">"BeiJing"</span>);</span><br><span class="line">        user.setSex(<span class="string">"女"</span>);</span><br><span class="line">        user.setUsername(<span class="string">"testSave"</span>);</span><br><span class="line">        userDao.saveUser(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 修改用户</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setId(<span class="number">57</span>);    <span class="comment">// 57 是刚刚 testSave 方法保存的数据的 id。每个人的不一样，需要修改成你数据库中有的数据</span></span><br><span class="line">        user.setAddress(<span class="string">"ShangHai"</span>);</span><br><span class="line">        user.setBirthday(<span class="keyword">new</span> Date());</span><br><span class="line">        user.setSex(<span class="string">"女"</span>);</span><br><span class="line">        user.setUsername(<span class="string">"testUpdate"</span>);</span><br><span class="line">        userDao.updateUser(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 id 删除用户</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDelete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        userDao.deleteUser(<span class="number">57</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 id 查询用户</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindById</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user = userDao.findById(<span class="number">55</span>);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 模糊查询用户</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindByName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 此处需要加上 % ，否则查询无结果</span></span><br><span class="line">        List&lt;User&gt; users = userDao.findByName(<span class="string">"%王%"</span>);</span><br><span class="line">        <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试方法执行之后执行，用于释放资源，不理解的应该去看看单元测试相关知识</span></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destory</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 06-关闭资源</span></span><br><span class="line">        session.commit();    <span class="comment">// 提交事务，不写此行代码无法实现保存操作</span></span><br><span class="line">        session.close();</span><br><span class="line">        in.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>TIPS：</code> mybatis 的 <strong><em>查询操作</em></strong> 到此结束！！！</p>
</blockquote>
<h2 id="mybatis-的参数和返回值"><a href="#mybatis-的参数和返回值" class="headerlink" title="mybatis 的参数和返回值"></a>mybatis 的参数和返回值</h2><h3 id="mybatis-的参数"><a href="#mybatis-的参数" class="headerlink" title="mybatis 的参数"></a>mybatis 的参数</h3><p>我们先看如下代码，了解一下 mybatis 的参数位置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateUser"</span> <span class="attr">parameterType</span>=<span class="string">"club.guoshizhan.domain.User"</span>&gt;</span></span><br><span class="line">    update user set username=#&#123;username&#125;,birthday=#&#123;birthday&#125;,sex=#&#123;sex&#125;,address=#&#123;address&#125; where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在上述代码中，<strong><em><code>parameterType</code> 就是 mybatis 的参数类型，它的值有多种类型。</em></strong> 具体如下：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ parameterType（输入类型），其输入类型如下：</span></span><br><span class="line"><span class="addition">+ 基本类型</span></span><br><span class="line"><span class="addition">+ 引用类型</span></span><br><span class="line"><span class="addition">+ 实体类型（POJO 实体类）</span></span><br><span class="line"><span class="addition">+ POJO 的包装类</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ OGNL 表达式的全称为： Object Graphic Navigation Language，翻译一下就是：对象图导航语言，</span></span><br><span class="line"><span class="addition">+ 它是通过对象的取值方法来获取数据。在写法上把 get 给省略了。</span></span><br><span class="line"><span class="addition">+ 比如：我们获取用户的名称</span></span><br><span class="line"><span class="addition">+     类中的写法：user.getUsername();</span></span><br><span class="line"><span class="addition">+     OGNL 表达式写法：user.username</span></span><br><span class="line"><span class="addition">+ mybatis 中为什么能直接写 username，而不用 user. 呢？因为在 parameterType 中已经提供了属性所属的类，所以此时不需要写对象名</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span></span><br></pre></td></tr></table></figure>

<p><strong><em>开发中通过 POJO 传递查询条件，查询条件是综合的查询条件，</em></strong> 不仅包括用户查询条件还包括其它的查询条件（比如将用户购买商品信息也作为查询条件），这时可以 <strong><em>使用 POJO 包装对象（POJO 类中包含 POJO）传递输入参数。</em></strong> 接下来我们搞定一个需求：<strong><em>根据用户名查询用户信息，查询条件放到 QueryVo 的 user 属性中。</em></strong></p>
<hr>
<p><code>第一步：</code> <strong><em>在 domain 包下新建 QueryVo 类。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>QueryVo.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.domain;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/8/22 20:34</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: QueryVo 实体类（此类中还包含了 User 实体类）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QueryVo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.user = user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第二步：</code> <strong><em>编写 <code>IUserDao</code> 类，新加 <code>QueryVo 中的条件查询用户</code> 的方法。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>IUserDao.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.QueryVo;</span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/6/22 23:53</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 用户持久层接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUserDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有用户</span></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 保存用户</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">saveUser</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 修改用户</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">updateUser</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 id 删除用户</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteUser</span><span class="params">(Integer id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 id 查询用户</span></span><br><span class="line">    <span class="function">User <span class="title">findById</span><span class="params">(Integer userId)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 模糊查询用户</span></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findByName</span><span class="params">(String username)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// QueryVo 中的条件查询用户</span></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findByVo</span><span class="params">(QueryVo vo)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第三步：</code> <strong><em>把以下代码加入到 <code>IUserDao.xml</code> 文件的 mapper 标签内。</em></strong> 代码如下：</p>
<figure class="highlight xml"><figcaption><span>IUserDao.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- QueryVo 中的条件查询用户：注意 mybatis 的参数类型和 SQL 语句中的查询条件的写法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findByVo"</span> <span class="attr">parameterType</span>=<span class="string">"club.guoshizhan.domain.QueryVo"</span> <span class="attr">resultType</span>=<span class="string">"club.guoshizhan.domain.User"</span>&gt;</span></span><br><span class="line">    select * from user where username like #&#123;user.username&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>第四步：</code> <strong><em>把以下的测试代码加入到 <code>MybatisTest</code> 类中，然后运行即可。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>MybatisTest.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// QueryVo 中的条件查询用户</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindByVo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    QueryVo queryVo = <span class="keyword">new</span> QueryVo();</span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setUsername(<span class="string">"%王%"</span>);</span><br><span class="line">    queryVo.setUser(user);</span><br><span class="line"></span><br><span class="line">    List&lt;User&gt; users = userDao.findByVo(queryVo);</span><br><span class="line">    <span class="keyword">for</span> (User user1 : users) &#123;</span><br><span class="line">        System.out.println(user1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第五步：</code> <strong><em>执行 <code>testFindByVo</code> 方法。</em></strong> 结果如下：</p>
<p><img src="../gallery/Java-Study/Mybatis/mybatis-027.png" alt=""></p>
<blockquote>
<p><code>TIPS：</code> <strong><em>mybatis 的参数</em></strong> 到此结束！！！</p>
</blockquote>
<h3 id="mybatis-的返回值"><a href="#mybatis-的返回值" class="headerlink" title="mybatis 的返回值"></a>mybatis 的返回值</h3><p>我们先看如下代码，了解一下 mybatis 的返回值位置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultType</span>=<span class="string">"club.guoshizhan.domain.User"</span>&gt;</span></span><br><span class="line">  select * from user;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在上述代码中，<strong><em><code>resultType</code> 就是 mybatis 的返回值类型，它的值有多种类型。</em></strong> 具体如下：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ resultType（输入类型），其输入类型如下：</span></span><br><span class="line"><span class="addition">+ 基本类型</span></span><br><span class="line"><span class="addition">+ 引用类型</span></span><br><span class="line"><span class="addition">+ 实体类型（POJO 实体类）</span></span><br><span class="line"><span class="addition">+ 实体类型列表（说白了就是集合。例如 List&lt;User&gt;）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span></span><br></pre></td></tr></table></figure>

<p>在我们编写实体类 <code>User</code> 时，<strong><em>我们需要把 User 类的变量名和数据库中的字段名保持一致。那么问题来了，如果不一致，会有什么后果呢？</em></strong> 带着这个问题，我们把实体类 User 做一下修改（每个变量名加上前缀 user）。代码如下：</p>
<figure class="highlight java"><figcaption><span>User.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/6/22 23:52</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: User 实体类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer userId;</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="keyword">private</span> Date userBirthday;</span><br><span class="line">    <span class="keyword">private</span> String userSex;</span><br><span class="line">    <span class="keyword">private</span> String userAddress;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getUserId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserId</span><span class="params">(Integer userId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userId = userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserName</span><span class="params">(String userName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userName = userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getUserBirthday</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userBirthday;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserBirthday</span><span class="params">(Date userBirthday)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userBirthday = userBirthday;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserSex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userSex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserSex</span><span class="params">(String userSex)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userSex = userSex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userAddress;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserAddress</span><span class="params">(String userAddress)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userAddress = userAddress;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"User&#123;"</span> +</span><br><span class="line">                <span class="string">"userId="</span> + userId +</span><br><span class="line">                <span class="string">", userName='"</span> + userName + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", userBirthday="</span> + userBirthday +</span><br><span class="line">                <span class="string">", userSex='"</span> + userSex + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", userAddress='"</span> + userAddress + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当我们修改完之后，测试类就报错了。这个没有关系，修改一下就好了（自行修改），这个错误是可以看见的错误。<strong><em>那么不可见的错误出现在哪呢？它在 <code>IUserDao.xml</code> 文件中。以下将以文件中的部分代码举例。</em></strong> 如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 注意：使用 # 号取值，里面的变量名字是和实体类里面的变量一一对应的，所以实体类变量名改变了，就无法取到值了 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"saveUser"</span> <span class="attr">parameterType</span>=<span class="string">"club.guoshizhan.domain.User"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- keyProperty 对应实体类中的属性，实体类 id 变成了 userId ，所以此处也要修改。--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- keyColumn 对应着数据库的字段。order 代表何时执行此配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">"id"</span> <span class="attr">keyColumn</span>=<span class="string">"id"</span> <span class="attr">resultType</span>=<span class="string">"Integer"</span> <span class="attr">order</span>=<span class="string">"AFTER"</span>&gt;</span></span><br><span class="line">        select last_insert_id();</span><br><span class="line">    <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">    insert into user(username,birthday,sex,address) values (#&#123;username&#125;,#&#123;birthday&#125;,#&#123;sex&#125;,#&#123;address&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>上述介绍完之后，<strong><em>我们就修改一下 <code>IUserDao.xml</code> 文件（修改部分，其他照着例子完成修改）。</em></strong> 修改如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"saveUser"</span> <span class="attr">parameterType</span>=<span class="string">"club.guoshizhan.domain.User"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 此处 keyProperty 修改了 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">"userId"</span> <span class="attr">keyColumn</span>=<span class="string">"id"</span> <span class="attr">resultType</span>=<span class="string">"Integer"</span> <span class="attr">order</span>=<span class="string">"AFTER"</span>&gt;</span></span><br><span class="line">        select last_insert_id();</span><br><span class="line">    <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 此处 OGNL 表达式都进行了修改 --&gt;</span></span><br><span class="line">    insert into user(username,birthday,sex,address) values (#&#123;userName&#125;,#&#123;userBirthday&#125;,#&#123;userSex&#125;,#&#123;userAddress&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<p>上述做了局部修改，其他修改都差不多，我就不过多讲述。修改完成后去测试类进行测试，<code>发现了问题：</code> <strong><em>增删改的测试没有问题。查询出问题。查询结果不能封装到对象里面，只有 userName 一个属性可以封装成功，其他属性都为 null。</em></strong> 接下来就解释原因，并提供解决方案。</p>
<hr>
<p><code>问题的原因：</code> 之所以 userName 有值，其他属性没有值，<strong><em>原因有两个：第一，MySQL 在 windows 中不区分大小写（如果在 Linux 中，userName 也为 null，因为 Linux 中 MySQL 严格区分大小写）。第二，实体类属性和数据库字段需要对的上才可封装。</em></strong> 因为第一个原因，所以 User 中的 userName 属性和数据库中的 username 字段可以认为是一样的，所以 userName 就有值，而其他的属性对不上，所以没有值。</p>
<hr>
<p><code>问题的解决方案一：</code> <strong><em>我们可以通过起别名的方式进行封装（在 IUserDao.xml 中操作）。</em></strong> 部分代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultType</span>=<span class="string">"club.guoshizhan.domain.User"</span>&gt;</span></span><br><span class="line">  select id as userId,username As userName,birthday as userBirthday,address as userAddress,sex as userSex from user;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<p><code>问题的解决方案二：</code> <strong><em>我们还可以通过配置的方式进行封装（在 IUserDao.xml 中操作）。</em></strong> 部分代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置数据库字段和实体类属性相对应。以下所有代码都写在 mapper 标签里面 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- resultMap 是唯一标志，名字可以随便写。type 对应的是实体类的类型 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userMap"</span> <span class="attr">type</span>=<span class="string">"club.guoshizhan.domain.User"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 主键字段的对应。property 对应实体类 id 属性，column 对应数据库 id 字段 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"userId"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 非主键字段的对应。注意：property 对应 Java 中的属性，是严格区分大小写的 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"userName"</span> <span class="attr">column</span>=<span class="string">"username"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"userSex"</span> <span class="attr">column</span>=<span class="string">"sex"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"userBirthday"</span> <span class="attr">column</span>=<span class="string">"birthday"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"userAddress"</span> <span class="attr">column</span>=<span class="string">"address"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 这里需要使用 resultMap 封装结果集，它的值是 resultMap 标签中的 id 属性的值 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultMap</span>=<span class="string">"userMap"</span>&gt;</span></span><br><span class="line">  select * from user;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<p><strong><em>上述两种解决方案都可以解决封装不成功的问题</em></strong> （使用上述任意一种方案，再次执行查询，那就不会再出现封装不上的情况了）。<code>这两种方案各有利弊：</code> <strong><em>配置的方式效率不如起别名的高，但是对于代码的维护和修改，配置的方式是更方便的。</em></strong></p>
<blockquote>
<p><code>TIPS：</code> <strong><em>mybatis 的返回值</em></strong> 到此结束！！！</p>
</blockquote>
<h2 id="mybatis-自定义-dao-实现类"><a href="#mybatis-自定义-dao-实现类" class="headerlink" title="mybatis 自定义 dao 实现类"></a>mybatis 自定义 dao 实现类</h2><p>上述的 mybatis 的修改操作完成之后，<strong><em>把代码都复原一下（复原到 mybatis 的返回值这一小结之前），这便于以下的操作。</em></strong> 我们知道，<strong><em>mybatis 是使用代理 dao 的方式实现增删改查操作，那如果不使用这种方式，而是我们自己写实现类，那该怎么做呢？</em></strong> 那就安排一下吧！！！</p>
<hr>
<p><code>第一步：</code> <strong><em>查看我们的 IUserDao 接口。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>IUserDao.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/6/22 23:53</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 用户持久层接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUserDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有用户</span></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 保存用户</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">saveUser</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 修改用户</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">updateUser</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 id 删除用户</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteUser</span><span class="params">(Integer id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 id 查询用户</span></span><br><span class="line">    <span class="function">User <span class="title">findById</span><span class="params">(Integer userId)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 模糊查询用户</span></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findByName</span><span class="params">(String username)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第二步：</code> <strong><em>在 dao 包下新建 IUserDao 接口的实现类 <code>UserDaoImpl</code> ，这个就是我们的自定义实现类。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>UserDaoImpl.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/8/22 23:20</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 自定义 IUserDao 的实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title">IUserDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> SqlSessionFactory factory;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserDaoImpl</span><span class="params">(SqlSessionFactory factory)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.factory = factory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 01-根据 factory 获取 SqlSession 对象</span></span><br><span class="line">        SqlSession session = factory.openSession();</span><br><span class="line">        <span class="comment">// 02-调用方法实现查询所有。参数是 IUserDao.xml 中的 namespace 的值 + 方法名称，相当于获取配置信息的 key</span></span><br><span class="line">        List&lt;User&gt; user = session.selectList(<span class="string">"club.guoshizhan.dao.IUserDao.findAll"</span>);</span><br><span class="line">        <span class="comment">// 03-释放资源</span></span><br><span class="line">        session.close();</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 01-根据 factory 获取 SqlSession 对象</span></span><br><span class="line">        SqlSession session = factory.openSession();</span><br><span class="line">        <span class="comment">// 02-调用方法实现保存操作。注意：参数 user 别忘记了，忘了的话会报错：username 不能为空</span></span><br><span class="line">        session.insert(<span class="string">"club.guoshizhan.dao.IUserDao.saveUser"</span>, user);</span><br><span class="line">        <span class="comment">// 03-提交事务</span></span><br><span class="line">        session.commit();</span><br><span class="line">        <span class="comment">// 04-释放资源</span></span><br><span class="line">        session.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 01-根据 factory 获取 SqlSession 对象</span></span><br><span class="line">        SqlSession session = factory.openSession();</span><br><span class="line">        <span class="comment">// 02-调用方法实现修改操作。注意：参数 user 别忘记了，忘了的话会报错：username 不能为空</span></span><br><span class="line">        session.update(<span class="string">"club.guoshizhan.dao.IUserDao.updateUser"</span>, user);</span><br><span class="line">        <span class="comment">// 03-提交事务</span></span><br><span class="line">        session.commit();</span><br><span class="line">        <span class="comment">// 04-释放资源</span></span><br><span class="line">        session.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteUser</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 01-根据 factory 获取 SqlSession 对象</span></span><br><span class="line">        SqlSession session = factory.openSession();</span><br><span class="line">        <span class="comment">// 02-调用方法实现删除操作。调用 delete 和 update 方法都可以实现</span></span><br><span class="line">        session.delete(<span class="string">"club.guoshizhan.dao.IUserDao.deleteUser"</span>, id);</span><br><span class="line">        <span class="comment">// 03-提交事务</span></span><br><span class="line">        session.commit();</span><br><span class="line">        <span class="comment">// 04-释放资源</span></span><br><span class="line">        session.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">findById</span><span class="params">(Integer userId)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 01-根据 factory 获取 SqlSession 对象</span></span><br><span class="line">        SqlSession session = factory.openSession();</span><br><span class="line">        <span class="comment">// 02-调用方法实现通过 id 查询一个用户</span></span><br><span class="line">        User user = session.selectOne(<span class="string">"club.guoshizhan.dao.IUserDao.findById"</span>, userId);</span><br><span class="line">        <span class="comment">// 03-释放资源</span></span><br><span class="line">        session.close();</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findByName</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 01-根据 factory 获取 SqlSession 对象</span></span><br><span class="line">        SqlSession session = factory.openSession();</span><br><span class="line">        <span class="comment">// 02-调用方法实现模糊查询</span></span><br><span class="line">        List&lt;User&gt; user = session.selectList(<span class="string">"club.guoshizhan.dao.IUserDao.findByName"</span>, username);</span><br><span class="line">        <span class="comment">// 03-释放资源</span></span><br><span class="line">        session.close();</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第三步：</code> <strong><em>查看我们的配置文件 IUserDao.xml ，看看是否编写正确</em></strong> 代码如下：</p>
<figure class="highlight xml"><figcaption><span>IUserDao.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 01-持久层映射配置中，mapper 标签的 namespace 属性取值必须是持久层接口的全限定类名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"club.guoshizhan.dao.IUserDao"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 02-查询所有用户：resultType 很重要，是查询结果的封装位置，不写会报错，表示 mybatis 框架不知道把结果往哪里封装 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 03-属性 id 不能随便写，必须是接口中方法的名称 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultType</span>=<span class="string">"club.guoshizhan.domain.User"</span>&gt;</span></span><br><span class="line">      select * from user;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 保存用户。parameterType 是用于指定参数类型，必须加上，否则报错 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 注意：使用 # 号取值，里面的变量名字是和实体类里面的变量一一对应的 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"saveUser"</span> <span class="attr">parameterType</span>=<span class="string">"club.guoshizhan.domain.User"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 插入操作完成后，获取到插入数据的 id 值。keyColumn 对应数据库的字段。order 代表何时执行此配置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">"id"</span> <span class="attr">keyColumn</span>=<span class="string">"id"</span> <span class="attr">resultType</span>=<span class="string">"Integer"</span> <span class="attr">order</span>=<span class="string">"AFTER"</span>&gt;</span></span><br><span class="line">            select last_insert_id();</span><br><span class="line">        <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">        insert into user(username,birthday,sex,address) values (#&#123;username&#125;,#&#123;birthday&#125;,#&#123;sex&#125;,#&#123;address&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 修改用户 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateUser"</span> <span class="attr">parameterType</span>=<span class="string">"club.guoshizhan.domain.User"</span>&gt;</span></span><br><span class="line">        update user set username=#&#123;username&#125;,birthday=#&#123;birthday&#125;,sex=#&#123;sex&#125;,address=#&#123;address&#125; where id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 根据 id 删除用户。注意：当只有一个参数时，占位符名称可以是任意值，我写的是#&#123;id&#125;，也可写#&#123;aa&#125;，都可以 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"deleteUser"</span> <span class="attr">parameterType</span>=<span class="string">"Integer"</span>&gt;</span></span><br><span class="line">        delete from user where id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 根据 id 查询用户。注意：1、当只有一个参数时，占位符名称可以是任意值。2、需要指定结果集的返回值类型 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findById"</span> <span class="attr">parameterType</span>=<span class="string">"Integer"</span> <span class="attr">resultType</span>=<span class="string">"club.guoshizhan.domain.User"</span>&gt;</span></span><br><span class="line">        select * from user where id=#&#123;aaabbbccc&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 模糊查询用户 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findByName"</span> <span class="attr">parameterType</span>=<span class="string">"String"</span> <span class="attr">resultType</span>=<span class="string">"club.guoshizhan.domain.User"</span>&gt;</span></span><br><span class="line">        -- 如果使用下列语句实现模糊查询，那么 % 需要在测试类的代码中添加上，否则查询不出来</span><br><span class="line">        -- 注意：此处执行的 SQL 语句用的是占位符方式，可以防止 SQL 注入，更安全</span><br><span class="line">        select * from user where username like #&#123;name&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>第四步：</code> <strong><em>编写我们的 MybatisTest 测试类（此类在 init 方法和 destory 方法中稍有改动）。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>MybatisTest.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.dao.IUserDao;</span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.dao.UserDaoImpl;</span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.After;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/6/23 11:03</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Mybatis 测试类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> InputStream in;</span><br><span class="line">    <span class="keyword">private</span> IUserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试方法执行之前执行，用于一些初始化的操作，不理解的应该去看看单元测试相关知识</span></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 01-读取配置文件</span></span><br><span class="line">        in = Resources.getResourceAsStream(<span class="string">"SqlMapConfig.xml"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 02-创建 SqlSessionFactory 工厂 ，SqlSessionFactory 是一个接口，不能 new 对象(因此需要使用它的实现类 SqlSessionFactoryBuilder)</span></span><br><span class="line">        SqlSessionFactory factory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 03-使用工厂对象创建 dao 对象</span></span><br><span class="line">        userDao = <span class="keyword">new</span> UserDaoImpl(factory);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有用户</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 05-使用代理对象执行方法</span></span><br><span class="line">        List&lt;User&gt; users = userDao.findAll();</span><br><span class="line">        <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 保存用户</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSave</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setBirthday(<span class="keyword">new</span> Date());</span><br><span class="line">        user.setAddress(<span class="string">"Java"</span>);</span><br><span class="line">        user.setSex(<span class="string">"女"</span>);</span><br><span class="line">        user.setUsername(<span class="string">"testSave"</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"保存操作之前"</span> + user);</span><br><span class="line">        userDao.saveUser(user);</span><br><span class="line">        System.out.println(<span class="string">"保存操作之后"</span> + user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 修改用户</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setId(<span class="number">67</span>);</span><br><span class="line">        user.setAddress(<span class="string">"ShangHai"</span>);</span><br><span class="line">        user.setBirthday(<span class="keyword">new</span> Date());</span><br><span class="line">        user.setSex(<span class="string">"女"</span>);</span><br><span class="line">        user.setUsername(<span class="string">"testUpdate"</span>);</span><br><span class="line">        userDao.updateUser(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 id 删除用户</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDelete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        userDao.deleteUser(<span class="number">68</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 id 查询用户</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindById</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user = userDao.findById(<span class="number">55</span>);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 模糊查询用户</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindByName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 此处需要加上 % ，否则查询无结果</span></span><br><span class="line">        List&lt;User&gt; users = userDao.findByName(<span class="string">"%王%"</span>);</span><br><span class="line">        <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试方法执行之后执行，用于释放资源，不理解的应该去看看单元测试相关知识</span></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destory</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 06-关闭资源</span></span><br><span class="line">        in.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>TIPS：</code> 运行每一个方法，结果都是一样的（我的没有报错，和原来完全一样），这里就不截图了。<strong><em>自定义 dao 实现类</em></strong> 到此结束！！</p>
</blockquote>
<h2 id="mybatis-的基本配置"><a href="#mybatis-的基本配置" class="headerlink" title="mybatis 的基本配置"></a>mybatis 的基本配置</h2><h3 id="properties-标签"><a href="#properties-标签" class="headerlink" title="properties 标签"></a>properties 标签</h3><p><code>properties</code> <strong><em>标签主要用于加载配置（例如数据库的配置文件），使用起来更为灵活。</em></strong> 那么先看一下我们的 mybatis 的配置文件，等会使用 <strong><em>propertis 标签</em></strong> 改造一下。<strong><em>mybatis 的配置文件（SqlMapConfig.xml）</em></strong> 的代码如下：</p>
<figure class="highlight xml"><figcaption><span>SqlMapConfig.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Config 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 01-mybatis 的主配置文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 02-配置 mybatis 的环境，default 属性的值随便写，写完之后，下面 id 的值必须和 default 的值一样 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"mysql"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 03-配置 mysql 的环境 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"mysql"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 04-配置事务的类型，type 先写 JDBC ，其他的以后说 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>&gt;</span><span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 05-配置连接数据库的信息：用的是数据源(连接池) --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/eesy_mybatis"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 06-指定 mybatis 映射配置的位置，即从 resources/club/guoshizhan/dao/ 包下找 IUserDao.xml 文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"club/guoshizhan/dao/IUserDao.xml"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>看完上述配置之后，<strong><em>我们使用 <code>properties 标签</code> 改造一下（用法和详情都写在注释中了）。</em></strong> 代码如下：</p>
<figure class="highlight xml"><figcaption><span>SqlMapConfig.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Config 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 01-mybatis 的主配置文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置 properties，方便下面的取值（此时这样写多此一举，一般都是引入外部配置文件，等下讲） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/eesy_mybatis"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"mysql"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"mysql"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>&gt;</span><span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- $&#123;&#125; 里面的值取的就是上面 properties 标签中 name 属性的值 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"$&#123;driver&#125;"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;url&#125;"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;username&#125;"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;password&#125;"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"club/guoshizhan/dao/IUserDao.xml"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>配置完后，我们去测试类执行各种方法，也是一样可以的。<strong><em>但是，有没有发现， properties 标签不是多此一举吗？的确，如果像上述配置那样，那就是多此一举。</em></strong> 所以，我们还需要改造一下，接着往下看！！！</p>
<hr>
<p><code>第一步：</code> <strong><em>在 <code>resources</code> 目录下新建 <code>jdbcConfig.properties</code> 数据库配置文件，把以下代码复制到里面：</em></strong></p>
<figure class="highlight properties"><figcaption><span>jdbcConfig.properties</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这些是数据库的连接信息，写自己的，此处仅供参考</span></span><br><span class="line"><span class="meta">jdbc.driver</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="meta">jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/eesy_mybatis</span></span><br><span class="line"><span class="meta">jdbc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">jdbc.password</span>=<span class="string">root</span></span><br></pre></td></tr></table></figure>

<p><code>第二步：</code> <strong><em>重新编写 <code>SqlMapConfig.xml</code> 配置文件（properties 标签的用法都在里面）。</em></strong> 代码如下：</p>
<figure class="highlight xml"><figcaption><span>SqlMapConfig.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Config 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 01-mybatis 的主配置文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 可以在 properties 标签内部配置数据库的信息，也可以通过属性引用外部配置文件的信息 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- resource 属性(常用)：用于指定配置文件的位置，按照类路径的写法来写，且必须存在于类路径下 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- url 属性(不常用)：需要按照 URL(Uniform Resources Locator 统一资源定位符) 写法来写</span></span><br><span class="line"><span class="comment">         它可以唯一标识一个资源的位置。它的写法：协议+主机+端口+URI  例如：http://localhost:8080/hello</span></span><br><span class="line"><span class="comment">         URI(Uniform Resources Identifier): 统一资源标识符，她在应用中可以唯一标识一个资源</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">"jdbcConfig.properties"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 这是使用 resource 的方式指定配置文件，配置文件存在于类路径中，即 resources 目录下 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 运行测试类可能报错：Could not find resource jdbcConfig.properties ，解决方法：选中 resources 目录，点击右键 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 选择 Make Directory as 选项，把 resources 改为 Source Root ，然后改回 Resources 即可 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--&lt;properties url="file:///c:/users/guoshizhan/Desktop/jdbcConfig.properties"&gt;</span></span><br><span class="line"><span class="comment">        &amp;lt;!&amp;ndash; 此处使用 url 的方式，把外部的配置文件加载进来。为了方便演示，我们把 jdbcConfig.properties 文件复制到桌面 &amp;ndash;&amp;gt;</span></span><br><span class="line"><span class="comment">        &amp;lt;!&amp;ndash; 然后把上述 properties 标签注释掉，再打开此处的 properties 标签。url 格式必须和上面的一样，否则报错（只需要改用户名） &amp;ndash;&amp;gt;</span></span><br><span class="line"><span class="comment">    &lt;/properties&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"mysql"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"mysql"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>&gt;</span><span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 此处别忘了，$&#123;&#125; 里面的值要和配置文件的 key 要一致 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driver&#125;"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"club/guoshizhan/dao/IUserDao.xml"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>TIPS：</code> 最后，我们只需要执行测试类进行测试即可。<strong><em>properties 标签</em></strong> 到此结束！！！</p>
</blockquote>
<h3 id="typeAliases-标签"><a href="#typeAliases-标签" class="headerlink" title="typeAliases 标签"></a>typeAliases 标签</h3><p><code>typeAliases</code> <strong><em>标签主要用于起别名，方便我们的代码编写，从而提高效率。</em></strong> 我们先看如下代码：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 此处的参数类型为：club.guoshizhan.domain.User ，那我能简写成 User 吗。没有起别名之前，是不行的 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateUser"</span> <span class="attr">parameterType</span>=<span class="string">"club.guoshizhan.domain.User"</span>&gt;</span></span><br><span class="line">    update user set username=#&#123;username&#125;,birthday=#&#123;birthday&#125;,sex=#&#123;sex&#125;,address=#&#123;address&#125; where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 此处的参数类型为：Integer ，我们也可以写 int ，java.lang.Integer 。那这是为什么呢？这是因为 mybatis 框架事先给这些常用的类型起好了别名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"deleteUser"</span> <span class="attr">parameterType</span>=<span class="string">"Integer"</span>&gt;</span></span><br><span class="line">    delete from user where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong><em>那么我们想给的实体类指定别名怎么做？</em></strong> 安排（具体操作和详情写于注释中）！！！ 代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Config 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 01-mybatis 的主配置文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">"jdbcConfig.properties"</span>&gt;</span><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 使用 typeAliases 标签配置别名 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- typeAlias 标签用于起别名，type 属性用于指定实体类的全限定类名， alias 属性用于指定别名 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定的别名不区分大小写。User、user、UsEr、uSER 等等都是一样的 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">type</span>=<span class="string">"club.guoshizhan.domain.User"</span> <span class="attr">alias</span>=<span class="string">"User"</span>&gt;</span><span class="tag">&lt;/<span class="name">typeAlias</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"mysql"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"mysql"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>&gt;</span><span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driver&#125;"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"club/guoshizhan/dao/IUserDao.xml"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>配置完成之后，<strong><em>我们再编写我们的 <code>IUserDao.xml</code> 的部分代码（起完别名之后，参数类型可以用别名，也可以不用）。</em></strong> 如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 原先我们必须写 club.guoshizhan.domain.User ，起别名之后，就可以简写成 User 了（不区分大小写）  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateUser"</span> <span class="attr">parameterType</span>=<span class="string">"User"</span>&gt;</span></span><br><span class="line">    update user set username=#&#123;username&#125;,birthday=#&#123;birthday&#125;,sex=#&#123;sex&#125;,address=#&#123;address&#125; where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong><em>然后我们去测试类进行测试即可（放心，没问题）。</em></strong> 那么问题又来了，<strong><em>如果我有非常非常多的实体类，一个一个的注册，那岂不是超级耗时间？</em></strong> 所以，它还有另一种起别名的方式（使用 package 标签，在 mappers 的标签中也可以使用 package 标签）。代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Config 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 01-mybatis 的主配置文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">"jdbcConfig.properties"</span>&gt;</span><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 使用 typeAliases 标签配置别名 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- typeAlias 标签用于起别名，type 属性用于指定实体类的全限定类名， alias 属性用于指定别名 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定的别名不区分大小写。User、user、UsEr、uSER 等等都是一样的 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;typeAlias type="club.guoshizhan.domain.User" alias="User"&gt;&lt;/typeAlias&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 这个是第二种起别名的方式，使用 package 标签，具体结介绍如下 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- package 标签用于指定要配置别名的包，当指定之后，该包下的所有实体类都会注册别名，并且类名就是别名，且不区分大小写 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"club.guoshizhan.domain"</span>&gt;</span><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"mysql"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"mysql"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>&gt;</span><span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driver&#125;"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;mapper resource="club/guoshizhan/dao/IUserDao.xml"/&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 此处 package 标签用于指定 dao 接口所在的包，当指定完成之后，不需要再写 resource 或者 class 属性了 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"club.guoshizhan.dao"</span>&gt;</span><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>TIPS：</code> 最后，我们只需要执行测试类进行测试即可。<strong><em>typeAliases 标签</em></strong> 到此结束！！！</p>
</blockquote>
<h1 id="mybatis-连接池"><a href="#mybatis-连接池" class="headerlink" title="mybatis 连接池"></a>mybatis 连接池</h1><h2 id="连接池概念和优点"><a href="#连接池概念和优点" class="headerlink" title="连接池概念和优点"></a>连接池概念和优点</h2><p><code>连接池概念：</code> <strong><em>连接池其实就是一个容器(集合)，存放数据库连接的容器。</em></strong> 当系统初始化好后，容器被创建，容器中会申请一些连接对象，当用户来访问数据库时，从容器中获取连接对象，<strong><em>用户访问完之后，会将连接对象归还给容器。</em></strong> 草图如下：</p>
<p><img src="../gallery/Java-Study/Mybatis/mybatis-028.png" alt=""></p>
<div class="hacker">
    <div  class="block-title ">
        <i class="fa fa-bullseye" aria-hidden="true"></i>
        <span>连接池的好处：</span>
    </div>
    <div class="block">
        1、节约资源（可重复利用）
        2、用户访问高效（减少了我们获取连接所消耗的时间）
    </div>
</div>

<h2 id="mybatis-连接池的三种配置"><a href="#mybatis-连接池的三种配置" class="headerlink" title="mybatis 连接池的三种配置"></a>mybatis 连接池的三种配置</h2><p><code>mybatis 连接池</code> <strong><em>提供了 3 种方式的配置，</em></strong> 具体详情如下：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ mybatis 连接池配置的位置：</span></span><br><span class="line"><span class="addition">+ 在主配置文件 SqlMapConfig.xml 中的 dataSource 标签中，type 属性就是表示采用何种连接池方式。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ type 属性的取值如下：</span></span><br><span class="line"><span class="addition">+ POOLED     采用传统的 javax.sql.DataSource 规范中的连接池，mybatis 中有针对规范的实现</span></span><br><span class="line"><span class="addition">+ UNPOOLED   采用传统的获取连接的方式，虽然也实现 Javax.sql.DataSource 接口，但是并没有使用池的思想。</span></span><br><span class="line"><span class="addition">+ JNDI       采用服务器提供的 JNDI 技术实现，来获取 DataSource 对象，不同的服务器所能拿到 DataSource 是不一样。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ 注意：如果不是 web 或者 maven 的 war 工程，JNDI 是不能使用的。我们使用的是 tomcat 服务器，采用连接池就是 dbcp 连接池。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span></span><br></pre></td></tr></table></figure>

<p><strong><em>接下来，我们使用 <code>POOLED</code> 方式进行相关测试（就是对 SqlMapConfig.xml 中的 dataSource 标签进行修改）。</em></strong> 代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用 POOLED 的方式。然后去测试类执行查询所有的方法。 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 执行成功之后，把 POOLED 改为 UNPOOLED ，然后再执行一次查询所有的方法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driver&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>经过上述操作后，<strong><em>我们来对比一下上述两种方式的不同。</em></strong> 如下图：</p>
<p><img src="../gallery/Java-Study/Mybatis/mybatis-029.png" alt=""></p>
<p><code>POOLED 方式</code> <strong><em>的源码分析</em></strong> 如下图：</p>
<p><img src="../gallery/Java-Study/Mybatis/mybatis-030.png" alt=""><br><img src="../gallery/Java-Study/Mybatis/mybatis-031.png" alt=""></p>
<blockquote>
<p><code>TIPS：</code> 一般情况下，<strong><em>我们都是使用 <code>POOLED</code> 的配置方式。</em></strong></p>
</blockquote>
<h2 id="mybatis-中的事务"><a href="#mybatis-中的事务" class="headerlink" title="mybatis 中的事务"></a>mybatis 中的事务</h2><p><strong><em>学习 MySQL 的时候就已经学过事务了，所以这里只是简单的概述一下。</em></strong> 介绍如下：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ 学习事务需要知道的几个问题：</span></span><br><span class="line"><span class="addition">+ 1、什么是事务</span></span><br><span class="line"><span class="addition">+ 2、事务的四大特性 ACID</span></span><br><span class="line"><span class="addition">+ 3、不考虑隔离性会产生的 3 个问题</span></span><br><span class="line"><span class="addition">+ 4、解决办法：四种隔离级别</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ 注意：它是通过 sqlsession 对象的 commit 方法和 rollback 方法实现事务的提交和回滚</span></span><br><span class="line"><span class="comment">+++ 根据 factory 获取 SqlSession 对象时，我们可以设置自动提交事务，只要在里面写上 true 即可</span></span><br><span class="line"><span class="addition">+ SqlSession session = factory.openSession(true);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span></span><br></pre></td></tr></table></figure>

<h1 id="mybatis-的动态-SQL"><a href="#mybatis-的动态-SQL" class="headerlink" title="mybatis 的动态 SQL"></a>mybatis 的动态 SQL</h1><p><strong><em>动态 SQL 语句都是和查询相关的。</em></strong> 那么为什么需要动态 SQL 呢？我举个例子，我们去淘宝买东西的时候，是不是可以根据条件来购买我们需要的东西。比如说：价格区间、销量、颜色等等。<strong><em>这些条件便需要我们的动态 SQL 去完成（以后学习 mybatisPlus 的时候，wrapper 也可以实现条件查询）。所以，动态 SQL 是用来做 <code>多条件查询</code> 的。接着往下看！！！</em></strong></p>
<hr>
<h2 id="if-标签"><a href="#if-标签" class="headerlink" title="if 标签"></a>if 标签</h2><p><strong><em><code>if 标签</code> 根据实体类的不同取值，使用不同的 SQL 语句来进行查询，从而实现了多条件的综合查询。</em></strong> 比如在 id 如果不为空时可以根据 id 查询。那么我们就来操作一波吧！！！</p>
<hr>
<p><code>第一步：</code> <strong><em>编写 <code>IUserDao</code> 类，新加  <code>根据传入的条件进行查询</code> 的方法。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>IUserDao.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/6/22 23:53</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 用户持久层接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUserDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有用户</span></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 id 查询用户</span></span><br><span class="line">    <span class="function">User <span class="title">findById</span><span class="params">(Integer userId)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 模糊查询用户</span></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findByName</span><span class="params">(String username)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据传入的条件进行查询。可能有用户名，可能有性别，也可能什么都有，也可能什么都没有</span></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findByCondition</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第二步：</code> <strong><em>编写 <code>IUserDaoImpl</code> 类，重写 <code>根据传入的条件进行查询</code> 的方法。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>IUserDaoImpl.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findByCondition</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 01-根据 factory 获取 SqlSession 对象</span></span><br><span class="line">    SqlSession session = factory.openSession();</span><br><span class="line">    <span class="comment">// 02-调用方法实现模糊查询</span></span><br><span class="line">    List&lt;User&gt; list = session.selectList(<span class="string">"club.guoshizhan.dao.IUserDao.findByCondition"</span>, user);</span><br><span class="line">    <span class="comment">// 03-释放资源</span></span><br><span class="line">    session.close();</span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第三步：</code> <strong><em>编写 <code>IUserDao.xml</code> 配置文件，新加如下代码（里面就是 <code>if 标签</code> 的用法）。</em></strong> 代码如下：</p>
<figure class="highlight xml"><figcaption><span>IUserDao.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 根据传入的条件进行查询 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findByCondition"</span> <span class="attr">parameterType</span>=<span class="string">"user"</span> <span class="attr">resultType</span>=<span class="string">"club.guoshizhan.domain.User"</span>&gt;</span></span><br><span class="line">    select * from user where 1=1</span><br><span class="line">    <span class="comment">&lt;!-- 此处使用了 if 标签。注意：OGNL 表达式里面的 username 和 test 里面的 username 要和实体类中的属性相对应。--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"username != null"</span>&gt;</span></span><br><span class="line">        and username like #&#123;username&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"sex != null"</span>&gt;</span></span><br><span class="line">        and sex = #&#123;sex&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>第四步：</code> <strong><em>编写测试类代码，然后执行相应的方法即可。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>MybatisTest.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据传入的条件进行查询</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindByCondition</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setUsername(<span class="string">"%王%"</span>);</span><br><span class="line">    user.setSex(<span class="string">"男"</span>);</span><br><span class="line"></span><br><span class="line">    List&lt;User&gt; users = userDao.findByCondition(user);</span><br><span class="line">    <span class="keyword">for</span> (User user1 : users) &#123;</span><br><span class="line">        System.out.println(user1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><em>执行测试代码中的 <code>testFindByCondition</code> 方法，</em></strong> 截取的部分结果如下<strong><em>（注意结果中的 SQL 语句）</em></strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">2020-08-23 22:34:07,143 308    [           main] DEBUG .apache.ibatis.io.ResolverUtil  - Checking to see if class club.guoshizhan.dao.IUserDao matches criteria [is assignable to Object]</span><br><span class="line">2020-08-23 22:34:07,146 311    [           main] DEBUG .apache.ibatis.io.ResolverUtil  - Checking to see if class club.guoshizhan.dao.UserDaoImpl matches criteria [is assignable to Object]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">23</span> <span class="number">22</span>:<span class="number">34</span>:<span class="number">07</span>,<span class="number">426</span> <span class="number">591</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Opening JDBC Connection</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">23</span> <span class="number">22</span>:<span class="number">34</span>:<span class="number">07</span>,<span class="number">701</span> <span class="number">866</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Setting autocommit to <span class="keyword">false</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection<span class="meta">@ac</span>3dc3]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">23</span> <span class="number">22</span>:<span class="number">34</span>:<span class="number">07</span>,<span class="number">708</span> <span class="number">873</span>    [           main] DEBUG n.dao.IUserDao.findByCondition  - ==&gt;  Preparing: select * from user where <span class="number">1</span>=<span class="number">1</span> and username like ? and sex = ? </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">23</span> <span class="number">22</span>:<span class="number">34</span>:<span class="number">07</span>,<span class="number">739</span> <span class="number">904</span>    [           main] DEBUG n.dao.IUserDao.findByCondition  - ==&gt; Parameters: %王%(String), 男(String)</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">23</span> <span class="number">22</span>:<span class="number">34</span>:<span class="number">07</span>,<span class="number">765</span> <span class="number">930</span>    [           main] DEBUG n.dao.IUserDao.findByCondition  - &lt;==      Total: <span class="number">2</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">23</span> <span class="number">22</span>:<span class="number">34</span>:<span class="number">07</span>,<span class="number">765</span> <span class="number">930</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Resetting autocommit to <span class="keyword">true</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection<span class="meta">@ac</span>3dc3]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">23</span> <span class="number">22</span>:<span class="number">34</span>:<span class="number">07</span>,<span class="number">765</span> <span class="number">930</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Closing JDBC Connection [com.mysql.jdbc.JDBC4Connection<span class="meta">@ac</span>3dc3]</span><br><span class="line">User&#123;id=<span class="number">43</span>, username=<span class="string">'大王'</span>, birthday=Tue Nov <span class="number">12</span> <span class="number">10</span>:<span class="number">19</span>:<span class="number">13</span> CST <span class="number">2019</span>, sex=<span class="string">'男'</span>, address=<span class="string">'Los Angeles'</span>&#125;</span><br><span class="line">User&#123;id=<span class="number">46</span>, username=<span class="string">'老王'</span>, birthday=Wed Mar <span class="number">07</span> <span class="number">17</span>:<span class="number">37</span>:<span class="number">26</span> CST <span class="number">2018</span>, sex=<span class="string">'男'</span>, address=<span class="string">'北京'</span>&#125;</span><br></pre></td></tr></table></figure>

<h2 id="where-标签"><a href="#where-标签" class="headerlink" title="where 标签"></a>where 标签</h2><p><strong><em>为了简化上面 where 1=1 的条件拼装，我们可以采用 <code>where 标签</code> 来简化开发。</em></strong> 简化后的代码如下：</p>
<figure class="highlight xml"><figcaption><span>IUserDao.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 根据传入的条件进行查询 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findByCondition"</span> <span class="attr">parameterType</span>=<span class="string">"user"</span> <span class="attr">resultType</span>=<span class="string">"club.guoshizhan.domain.User"</span>&gt;</span></span><br><span class="line">    select * from user</span><br><span class="line">    /* 此处使用了 where 标签 */</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"username != null"</span>&gt;</span></span><br><span class="line">            and username like #&#123;username&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"sex != null"</span>&gt;</span></span><br><span class="line">            and sex = #&#123;sex&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong><em>然后执行测试代码中的 <code>testFindByCondition</code> 方法，</em></strong> 截取的部分结果如下<strong><em>（注意结果中的 SQL 语句）</em></strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">2020-08-23 22:46:21,752 207    [           main] DEBUG .apache.ibatis.io.ResolverUtil  - Checking to see if class club.guoshizhan.dao.IUserDao matches criteria [is assignable to Object]</span><br><span class="line">2020-08-23 22:46:21,752 207    [           main] DEBUG .apache.ibatis.io.ResolverUtil  - Checking to see if class club.guoshizhan.dao.UserDaoImpl matches criteria [is assignable to Object]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">23</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">22</span>,<span class="number">008</span> <span class="number">463</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Opening JDBC Connection</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">23</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">22</span>,<span class="number">254</span> <span class="number">709</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Setting autocommit to <span class="keyword">false</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">1</span>c8530f]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">23</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">22</span>,<span class="number">262</span> <span class="number">717</span>    [           main] DEBUG n.dao.IUserDao.findByCondition  - ==&gt;  Preparing: select * from user <span class="comment">/* 此处使用了 where 标签 */</span> WHERE username like ? and sex = ? </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">23</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">22</span>,<span class="number">300</span> <span class="number">755</span>    [           main] DEBUG n.dao.IUserDao.findByCondition  - ==&gt; Parameters: %王%(String), 男(String)</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">23</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">22</span>,<span class="number">330</span> <span class="number">785</span>    [           main] DEBUG n.dao.IUserDao.findByCondition  - &lt;==      Total: <span class="number">2</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">23</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">22</span>,<span class="number">331</span> <span class="number">786</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Resetting autocommit to <span class="keyword">true</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">1</span>c8530f]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">23</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">22</span>,<span class="number">331</span> <span class="number">786</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Closing JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">1</span>c8530f]</span><br><span class="line">User&#123;id=<span class="number">43</span>, username=<span class="string">'大王'</span>, birthday=Tue Nov <span class="number">12</span> <span class="number">10</span>:<span class="number">19</span>:<span class="number">13</span> CST <span class="number">2019</span>, sex=<span class="string">'男'</span>, address=<span class="string">'Los Angeles'</span>&#125;</span><br><span class="line">User&#123;id=<span class="number">46</span>, username=<span class="string">'老王'</span>, birthday=Wed Mar <span class="number">07</span> <span class="number">17</span>:<span class="number">37</span>:<span class="number">26</span> CST <span class="number">2018</span>, sex=<span class="string">'男'</span>, address=<span class="string">'北京'</span>&#125;</span><br></pre></td></tr></table></figure>

<h2 id="foreach-标签"><a href="#foreach-标签" class="headerlink" title="foreach 标签"></a>foreach 标签</h2><p><strong><em>现在提出一个需求：传入多个 id 查询用户信息。</em></strong> 我们如何做呢？当然，我们可以用下边两个 SQL 实现：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">USERS</span> <span class="keyword">WHERE</span> username <span class="keyword">LIKE</span> <span class="string">'%王%'</span> <span class="keyword">AND</span> (<span class="keyword">id</span> =<span class="number">10</span> <span class="keyword">OR</span> <span class="keyword">id</span> =<span class="number">89</span> <span class="keyword">OR</span> <span class="keyword">id</span>=<span class="number">16</span>)</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">USERS</span> <span class="keyword">WHERE</span> username <span class="keyword">LIKE</span> <span class="string">'%王%'</span> <span class="keyword">AND</span> <span class="keyword">id</span> <span class="keyword">IN</span> (<span class="number">10</span>,<span class="number">89</span>,<span class="number">16</span>)</span><br></pre></td></tr></table></figure>

<p>根据上面的需求，问题来了：<strong><em>我们在进行范围查询时，就要将一个集合中的值，作为参数动态添加进来。</em></strong> 这样的话，<strong><em>mybatis 将如何进行参数的传递？</em></strong> 接着往下看吧！！！</p>
<hr>
<p><code>第一步：</code> <strong><em>编写 <code>QueryVo</code> 类，新加了 <code>ids 属性</code> 。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>QueryVo.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/8/22 20:34</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: QueryVo 实体类（此类中还包含了 User 实体类）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QueryVo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Integer&gt; ids;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title">getIds</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ids;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setIds</span><span class="params">(List&lt;Integer&gt; ids)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.ids = ids;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.user = user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第二步：</code> <strong><em>编写 <code>IUserDao</code> 类，新加了 <code>findUserInIds</code> 方法。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>IUserDao.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.QueryVo;</span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/6/22 23:53</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 用户持久层接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUserDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有用户</span></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 保存用户</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">saveUser</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 修改用户</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">updateUser</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 id 删除用户</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteUser</span><span class="params">(Integer id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 id 查询用户</span></span><br><span class="line">    <span class="function">User <span class="title">findById</span><span class="params">(Integer userId)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 模糊查询用户</span></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findByName</span><span class="params">(String username)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据传入的条件进行查询。可能有用户名，可能有性别，也可能什么都有，也可能什么都没有</span></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findByCondition</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 QueryVo 中提供的 id 集合查询用户信息</span></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findUserInIds</span><span class="params">(QueryVo vo)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第三步：</code> <strong><em>编写 <code>IUserDaoImpl</code> 类，重写 <code>findUserInIds</code> 方法。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>IUserDaoImpl.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findUserInIds</span><span class="params">(QueryVo vo)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 01-根据 factory 获取 SqlSession 对象</span></span><br><span class="line">    SqlSession session = factory.openSession();</span><br><span class="line">    List&lt;User&gt; list = session.selectList(<span class="string">"club.guoshizhan.dao.IUserDao.findByCondition"</span>, vo);</span><br><span class="line">    <span class="comment">// 03-释放资源</span></span><br><span class="line">    session.close();</span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第四步：</code> 编写 <code>IUserDao.xml</code> 配置文件，新加如下代码（里面就是 <code>foreach 标签</code> 的用法）。 代码如下：</p>
<figure class="highlight xml"><figcaption><span>IUserDao.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 根据 QueryVo 中提供的 id 集合查询用户信息 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUserInIds"</span> <span class="attr">parameterType</span>=<span class="string">"club.guoshizhan.domain.QueryVo"</span> <span class="attr">resultType</span>=<span class="string">"club.guoshizhan.domain.User"</span>&gt;</span></span><br><span class="line">    select * from user</span><br><span class="line">    /* 此处使用了 where 标签 */</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"ids != null and ids.size() &gt; 0"</span>&gt;</span></span><br><span class="line">            /* 此处使用了 foreach 标签。如果把此行注释去掉，那么下方 open 的值是 ="and id in(" */</span><br><span class="line">            <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"ids"</span> <span class="attr">open</span>=<span class="string">"id in("</span> <span class="attr">close</span>=<span class="string">")"</span> <span class="attr">item</span>=<span class="string">"aaaId"</span> <span class="attr">separator</span>=<span class="string">","</span>&gt;</span></span><br><span class="line">                #&#123;aaaId&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>foreach 标签</code> 的相关属性的详细介绍如下：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+ SQL语句：select 字段 from user where id in (?)</span></span><br><span class="line"><span class="comment">+++ &lt;foreach&gt; 标签用于遍历集合，它的属性有：</span></span><br><span class="line"><span class="addition">+ collection:    代表要遍历的集合元素，注意编写时不要写#&#123;&#125;</span></span><br><span class="line"><span class="addition">+ open:          代表语句的开始部分</span></span><br><span class="line"><span class="addition">+ close:         代表结束部分</span></span><br><span class="line"><span class="addition">+ item:          代表遍历集合的每个元素，生成的变量名</span></span><br><span class="line"><span class="addition">+ sperator:      代表分隔符</span></span><br><span class="line"></span><br><span class="line"><span class="comment">++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span></span><br></pre></td></tr></table></figure>

<p><code>第五步：</code> <strong><em>编写测试类代码，然后执行相应的方法即可。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>MybatisTest.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据传入的条件进行查询</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindUserInIds</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    QueryVo vo = <span class="keyword">new</span> QueryVo();</span><br><span class="line">    List&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    list.add(<span class="number">42</span>);</span><br><span class="line">    list.add(<span class="number">43</span>);</span><br><span class="line">    list.add(<span class="number">46</span>);</span><br><span class="line">    vo.setIds(list);</span><br><span class="line"></span><br><span class="line">    List&lt;User&gt; users = userDao.findUserInIds(vo);</span><br><span class="line">    <span class="keyword">for</span> (User user1 : users) &#123;</span><br><span class="line">        System.out.println(user1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><em>执行测试代码中的 <code>testFindUserInIds</code> 方法，</em></strong> 截取的部分结果如下<strong><em>（注意结果中的 SQL 语句）</em></strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">2020-08-24 00:10:27,079 145    [           main] DEBUG .apache.ibatis.io.ResolverUtil  - Checking to see if class club.guoshizhan.dao.UserDaoImpl matches criteria [is assignable to Object]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">24</span> <span class="number">00</span>:<span class="number">10</span>:<span class="number">27</span>,<span class="number">244</span> <span class="number">310</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Opening JDBC Connection</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">24</span> <span class="number">00</span>:<span class="number">10</span>:<span class="number">27</span>,<span class="number">552</span> <span class="number">618</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Setting autocommit to <span class="keyword">false</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">76</span>c8cd]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">24</span> <span class="number">00</span>:<span class="number">10</span>:<span class="number">27</span>,<span class="number">559</span> <span class="number">625</span>    [           main] DEBUG han.dao.IUserDao.findUserInIds  - ==&gt;  Preparing: select * from user <span class="comment">/* 此处使用了 where 标签 */</span> WHERE <span class="comment">/* 此处使用了 foreach 标签。如果把此行注释去掉，那么下方 open 的值是 ="and id in(" */</span> <span class="function">id <span class="title">in</span><span class="params">( ? , ? , ? )</span> </span></span><br><span class="line"><span class="function">2020-08-24 00:10:27,589 655    [           main] DEBUG han.dao.IUserDao.findUserInIds  - </span>==&gt; Parameters: <span class="number">42</span>(Integer), <span class="number">43</span>(Integer), <span class="number">46</span>(Integer)</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">24</span> <span class="number">00</span>:<span class="number">10</span>:<span class="number">27</span>,<span class="number">609</span> <span class="number">675</span>    [           main] DEBUG han.dao.IUserDao.findUserInIds  - &lt;==      Total: <span class="number">3</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">24</span> <span class="number">00</span>:<span class="number">10</span>:<span class="number">27</span>,<span class="number">610</span> <span class="number">676</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Resetting autocommit to <span class="keyword">true</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">76</span>c8cd]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">24</span> <span class="number">00</span>:<span class="number">10</span>:<span class="number">27</span>,<span class="number">610</span> <span class="number">676</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Closing JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">76</span>c8cd]</span><br><span class="line">User&#123;id=<span class="number">42</span>, username=<span class="string">'小二王'</span>, birthday=Fri Mar <span class="number">02</span> <span class="number">15</span>:<span class="number">09</span>:<span class="number">37</span> CST <span class="number">2018</span>, sex=<span class="string">'女'</span>, address=<span class="string">'北京金燕龙'</span>&#125;</span><br><span class="line">User&#123;id=<span class="number">43</span>, username=<span class="string">'大王'</span>, birthday=Tue Nov <span class="number">12</span> <span class="number">10</span>:<span class="number">19</span>:<span class="number">13</span> CST <span class="number">2019</span>, sex=<span class="string">'男'</span>, address=<span class="string">'Los Angeles'</span>&#125;</span><br><span class="line">User&#123;id=<span class="number">46</span>, username=<span class="string">'老王'</span>, birthday=Wed Mar <span class="number">07</span> <span class="number">17</span>:<span class="number">37</span>:<span class="number">26</span> CST <span class="number">2018</span>, sex=<span class="string">'男'</span>, address=<span class="string">'北京'</span>&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>TIPS：</code> <strong><em>mybatis 的动态 SQL</em></strong> 到此结束！！！</p>
</blockquote>
<h1 id="mybatis-的多表操作"><a href="#mybatis-的多表操作" class="headerlink" title="mybatis 的多表操作"></a>mybatis 的多表操作</h1><p>既然需要实现多表操作，<strong><em>那么就必须知道表与表之间的关系。</em></strong> 具体介绍如下：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ 表与表之间的关系：</span></span><br><span class="line"><span class="addition">+ 一对多    举例：用户和订单就是一对多，一个用户可以下多个订单</span></span><br><span class="line"><span class="addition">+ 多对一    举例：订单和用户就是多对一，多个订单可以被一个用户所支付</span></span><br><span class="line"><span class="addition">+ 一对一    举例：一个人只能有一个身份证号，一个身份证号只能属于一个人</span></span><br><span class="line"><span class="addition">+ 多对多    举例：一个学生可以选择多门课程，一门课程可以被多个学生选择</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ 特例：如果拿出每一个订单，他都只能属于一个用户。所以 Mybatis 就把多对一看成了一对一。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span></span><br></pre></td></tr></table></figure>

<h2 id="前期准备"><a href="#前期准备" class="headerlink" title="前期准备"></a>前期准备</h2><p>要实现 <code>多表操作</code> ，必须要多张表呀。<strong><em>所以需要先完成准备工作。</em></strong> 如下：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ mybatis 中的多表查询：用户表和账户表</span></span><br><span class="line"><span class="addition">+ 一个用户可以有多个账户，一个账户只能属于一个用户（多个账户也可以属于同一个用户）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ 要实现两张表的关联操作，需要如下步骤：</span></span><br><span class="line"><span class="addition">+ 1、建立两张表：用户表，账户表。让用户表和账户表之间具备一对多的关系：需要使用外键在账户表中添加</span></span><br><span class="line"><span class="addition">+ 2、建立两个实体类：用户实体类和账户实体类。让用户和账户的实体类能体现出来一对多的关系</span></span><br><span class="line"><span class="addition">+ 3、建立两个配置文件。用户的配置文件和账户的配置文件</span></span><br><span class="line"><span class="addition">+ 4、实现配置：当我们查询用户时，可以同时得到用户下所包含的账户信息；当我们查询账户时，可以同时得到账户的所属用户信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span></span><br></pre></td></tr></table></figure>

<p><code>建表语句</code> 在 <strong><em>mybatis 的环境搭建</em></strong> 小结已经完成了，所以第一步就搞定了。<strong><em>我们的用户实体类（User 类）在先前已经创建了，所以第二步操作只需要在 <code>domain</code> 包下建立账户实体类（Account 类），然后在 <code>dao</code> 包下新建对应的 dao 接口。</em></strong> 相关代码如下：</p>
<figure class="highlight java"><figcaption><span>Account.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/8/24 10:59</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Account 类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Account</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> Integer uid;</span><br><span class="line">    <span class="keyword">private</span> Double money;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getUid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> uid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUid</span><span class="params">(Integer uid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.uid = uid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Double <span class="title">getMoney</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> money;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMoney</span><span class="params">(Double money)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.money = money;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Account&#123;"</span> +</span><br><span class="line">                <span class="string">"id="</span> + id +</span><br><span class="line">                <span class="string">", uid="</span> + uid +</span><br><span class="line">                <span class="string">", money="</span> + money +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>账户实体类完成之后，<strong><em>我们去 <code>dao</code> 包下新建 <code>IAccountDao</code> 接口。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>IAccountDao.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.Account;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/8/24 11:07</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Account 的 dao 接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IAccountDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有账户</span></span><br><span class="line">    <span class="function">List&lt;Account&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接口搞定之后，<strong><em>我们去 <code>resources</code> 目录下的 club/guoshizhan/dao 下新建 <code>IAccountDao.xml</code> 配置文件。</em></strong> 代码如下：</p>
<figure class="highlight xml"><figcaption><span>IAccountDao.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 01-持久层映射配置中，mapper 标签的 namespace 属性取值必须是持久层接口的全限定类名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"club.guoshizhan.dao.IAccountDao"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultType</span>=<span class="string">"Account"</span>&gt;</span></span><br><span class="line">      select * from account;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong><em>最后，我们编写测试类进行测试。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>AccountTest.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.dao.IAccountDao;</span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.Account;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.After;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/6/23 11:03</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Mybatis 测试类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> InputStream in;</span><br><span class="line">    <span class="keyword">private</span> IAccountDao accountDao;</span><br><span class="line">    <span class="keyword">private</span> SqlSession session;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试方法执行之前执行，用于一些初始化的操作，不理解的应该去看看单元测试相关知识</span></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 01-读取配置文件</span></span><br><span class="line">        in = Resources.getResourceAsStream(<span class="string">"SqlMapConfig.xml"</span>);</span><br><span class="line">        <span class="comment">// 02-创建 SqlSessionFactory 工厂 ，SqlSessionFactory 是一个接口，不能 new 对象(因此需要使用它的实现类 SqlSessionFactoryBuilder)</span></span><br><span class="line">        SqlSessionFactory factory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br><span class="line">        <span class="comment">// 03-使用工厂对象创建 dao 对象</span></span><br><span class="line">        session = factory.openSession();</span><br><span class="line">        accountDao = session.getMapper(IAccountDao<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有账户</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 05-使用代理对象执行方法</span></span><br><span class="line">        List&lt;Account&gt; accounts = accountDao.findAll();</span><br><span class="line">        <span class="keyword">for</span> (Account account : accounts) &#123;</span><br><span class="line">            System.out.println(account);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试方法执行之后执行，用于释放资源，不理解的应该去看看单元测试相关知识</span></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destory</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 06-关闭资源</span></span><br><span class="line">        in.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><em>执行上述的 <code>testFindAll</code> 方法，</em></strong> 结果如下<strong><em>（注意 SQL 语句）</em></strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">2020-08-24 13:42:32,968 261    [           main] DEBUG .apache.ibatis.io.ResolverUtil  - Checking to see if class club.guoshizhan.dao.IAccountDao matches criteria [is assignable to Object]</span><br><span class="line">2020-08-24 13:42:32,968 261    [           main] DEBUG .apache.ibatis.io.ResolverUtil  - Checking to see if class club.guoshizhan.dao.IUserDao matches criteria [is assignable to Object]</span><br><span class="line">2020-08-24 13:42:32,968 261    [           main] DEBUG .apache.ibatis.io.ResolverUtil  - Checking to see if class club.guoshizhan.dao.UserDaoImpl matches criteria [is assignable to Object]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">24</span> <span class="number">13</span>:<span class="number">42</span>:<span class="number">33</span>,<span class="number">189</span> <span class="number">482</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Opening JDBC Connection</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">24</span> <span class="number">13</span>:<span class="number">42</span>:<span class="number">33</span>,<span class="number">454</span> <span class="number">747</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Setting autocommit to <span class="keyword">false</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">121</span>c9d6]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">24</span> <span class="number">13</span>:<span class="number">42</span>:<span class="number">33</span>,<span class="number">462</span> <span class="number">755</span>    [           main] DEBUG hizhan.dao.IAccountDao.findAll  - ==&gt;  Preparing: select * from account; </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">24</span> <span class="number">13</span>:<span class="number">42</span>:<span class="number">33</span>,<span class="number">492</span> <span class="number">785</span>    [           main] DEBUG hizhan.dao.IAccountDao.findAll  - ==&gt; Parameters: </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">24</span> <span class="number">13</span>:<span class="number">42</span>:<span class="number">33</span>,<span class="number">509</span> <span class="number">802</span>    [           main] DEBUG hizhan.dao.IAccountDao.findAll  - &lt;==      Total: <span class="number">2</span></span><br><span class="line">Account&#123;id=<span class="number">1</span>, uid=<span class="number">46</span>, money=<span class="number">1000.0</span>&#125;</span><br><span class="line">Account&#123;id=<span class="number">3</span>, uid=<span class="number">46</span>, money=<span class="number">2000.0</span>&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>TIPS：</code> <strong><em>前期准备工作</em></strong> 到此结束！！！</p>
</blockquote>
<h2 id="一对一"><a href="#一对一" class="headerlink" title="一对一"></a>一对一</h2><p>那么现在就搞定 <strong><em>一对一</em></strong> 的表结构。<code>第一步：</code> <strong><em>在 <code>domain</code> 包下新建 <code>AccountUser</code> 类。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>AccountUser.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.domain;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/8/24 13:57</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: AccountUser 类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountUser</span> <span class="keyword">extends</span> <span class="title">Account</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAddress</span><span class="params">(String address)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.toString().substring(<span class="number">0</span>, <span class="keyword">super</span>.toString().length() - <span class="number">1</span>) + <span class="string">", "</span> +</span><br><span class="line">                <span class="string">"username='"</span> + username + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", address='"</span> + address + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第二步：</code> <strong><em>在  <code>IAccountDao</code> 接口中新加 <code>findAllAccount</code> 方法。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>IAccountDao.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.Account;</span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.AccountUser;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/8/24 11:07</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Account 的 dao 接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IAccountDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有账户</span></span><br><span class="line">    <span class="function">List&lt;Account&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有账户，并且带有用户名称和地址信息</span></span><br><span class="line">    <span class="function">List&lt;AccountUser&gt; <span class="title">findAllAccount</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第三步：</code> <strong><em>在  <code>IAccountDao.xml</code> 文件中新加如下代码：</em></strong></p>
<figure class="highlight xml"><figcaption><span>IAccountDao.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 查询所有账户，并且带有用户名称和地址信息 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAllAccount"</span> <span class="attr">resultType</span>=<span class="string">"AccountUser"</span>&gt;</span></span><br><span class="line">  SELECT a.*,u.username,u.address FROM USER u , account a WHERE a.uid = u.id</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong><em><code>第四步：</code> 编写测试方法进行测试。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>AccountTest.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询所有账户，并且带有用户名称和地址信息</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAllAccount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 05-使用代理对象执行方法</span></span><br><span class="line">    List&lt;AccountUser&gt; accountUsers = accountDao.findAllAccount();</span><br><span class="line">    <span class="keyword">for</span> (AccountUser account : accountUsers) &#123;</span><br><span class="line">        System.out.println(account);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><em>执行上述的 <code>testFindAllAccount</code> 方法，</em></strong> 结果如下<strong><em>（注意 SQL 语句）</em></strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">2020-08-24 14:11:00,871 252    [           main] DEBUG .apache.ibatis.io.ResolverUtil  - Checking to see if class club.guoshizhan.dao.IAccountDao matches criteria [is assignable to Object]</span><br><span class="line">2020-08-24 14:11:00,871 252    [           main] DEBUG .apache.ibatis.io.ResolverUtil  - Checking to see if class club.guoshizhan.dao.IUserDao matches criteria [is assignable to Object]</span><br><span class="line">2020-08-24 14:11:00,872 253    [           main] DEBUG .apache.ibatis.io.ResolverUtil  - Checking to see if class club.guoshizhan.dao.UserDaoImpl matches criteria [is assignable to Object]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">24</span> <span class="number">14</span>:<span class="number">11</span>:<span class="number">01</span>,<span class="number">116</span> <span class="number">497</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Opening JDBC Connection</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">24</span> <span class="number">14</span>:<span class="number">11</span>:<span class="number">01</span>,<span class="number">423</span> <span class="number">804</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Setting autocommit to <span class="keyword">false</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">7f</span>383f]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">24</span> <span class="number">14</span>:<span class="number">11</span>:<span class="number">01</span>,<span class="number">430</span> <span class="number">811</span>    [           main] DEBUG dao.IAccountDao.findAllAccount  - ==&gt;  Preparing: SELECT a.*,u.username,u.address FROM USER u , account a WHERE a.uid = u.id </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">24</span> <span class="number">14</span>:<span class="number">11</span>:<span class="number">01</span>,<span class="number">460</span> <span class="number">841</span>    [           main] DEBUG dao.IAccountDao.findAllAccount  - ==&gt; Parameters: </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">24</span> <span class="number">14</span>:<span class="number">11</span>:<span class="number">01</span>,<span class="number">480</span> <span class="number">861</span>    [           main] DEBUG dao.IAccountDao.findAllAccount  - &lt;==      Total: <span class="number">2</span></span><br><span class="line">Account&#123;id=<span class="number">1</span>, uid=<span class="number">46</span>, money=<span class="number">1000.0</span>, username=<span class="string">'老王'</span>, address=<span class="string">'北京'</span>&#125;</span><br><span class="line">Account&#123;id=<span class="number">3</span>, uid=<span class="number">46</span>, money=<span class="number">2000.0</span>, username=<span class="string">'老王'</span>, address=<span class="string">'北京'</span>&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>虽然结果是查询出来了，<strong><em>但是，表结构之间的关系却没有体现出来。</em></strong> 所以，接下来需要解决的问题就是 <strong><em>让实体类能够体现出表结构之间的关系。</em></strong> 那么如何做呢？接着往下看（<strong><em>注意：以下是 <code>一对一</code> 体现</em></strong>）！！！</p>
<hr>
<p><code>第一步：</code> <strong><em>给 <code>Account</code> 实体类添加一个属性，从而体现表结构之间的关系。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>Account.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/8/24 10:59</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Account 类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Account</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> Integer uid;</span><br><span class="line">    <span class="keyword">private</span> Double money;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从表实体 Account 应该包含一个主表实体 User 的引用</span></span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.user = user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getUid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> uid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUid</span><span class="params">(Integer uid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.uid = uid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Double <span class="title">getMoney</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> money;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMoney</span><span class="params">(Double money)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.money = money;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Account&#123;"</span> +</span><br><span class="line">                <span class="string">"id="</span> + id +</span><br><span class="line">                <span class="string">", uid="</span> + uid +</span><br><span class="line">                <span class="string">", money="</span> + money +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第二步：</code> <strong><em>修改 <code>IAccountDao.xml</code> 文件重点在 <code>查询所有账户</code> 那里。</em></strong> 代码如下：</p>
<figure class="highlight xml"><figcaption><span>IAccountDao.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 01-持久层映射配置中，mapper 标签的 namespace 属性取值必须是持久层接口的全限定类名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"club.guoshizhan.dao.IAccountDao"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 定义封装 Account 和 User 的 resultMap --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"accountMap"</span> <span class="attr">type</span>=<span class="string">"account"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"aid"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"uid"</span> <span class="attr">column</span>=<span class="string">"uid"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"money"</span> <span class="attr">column</span>=<span class="string">"money"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 上述封装只能保证 Account 实体类的数据封装完成，并不能把 User 实体类的数据进行封装 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 一对一的关系映射，配置封装 User 的内容 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"user"</span> <span class="attr">column</span>=<span class="string">"uid"</span> <span class="attr">javaType</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"username"</span> <span class="attr">column</span>=<span class="string">"username"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"address"</span> <span class="attr">column</span>=<span class="string">"address"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"sex"</span> <span class="attr">column</span>=<span class="string">"sex"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"birthday"</span> <span class="attr">column</span>=<span class="string">"birthday"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 查询所有账户 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultMap</span>=<span class="string">"accountMap"</span>&gt;</span></span><br><span class="line">      SELECT u.*,a.id AS aid,a.uid,a.money FROM USER u,account a WHERE u.id = a.uid</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 查询所有账户，并且带有用户名称和地址信息 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAllAccount"</span> <span class="attr">resultType</span>=<span class="string">"AccountUser"</span>&gt;</span></span><br><span class="line">      SELECT a.*,u.username,u.address FROM USER u , account a WHERE a.uid = u.id</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>第三步：</code> <strong><em>修改测试类 AccountTest 中的 <code>testFindAll</code> 方法。</em></strong> 代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询所有用户</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 05-使用代理对象执行方法</span></span><br><span class="line">    List&lt;Account&gt; accounts = accountDao.findAll();</span><br><span class="line">    <span class="keyword">for</span> (Account account : accounts) &#123;</span><br><span class="line">        System.out.println(<span class="string">"======== 一对一表结构结果输出 ========"</span>);</span><br><span class="line">        System.out.println(account);</span><br><span class="line">        System.out.println(account.getUser());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><em><code>第四步：</code> 执行上述的 <code>testFindAll</code> 方法，</em></strong> 结果如下<strong><em>（注意 SQL 语句）</em></strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">2020-08-24 15:00:58,839 154    [           main] DEBUG .apache.ibatis.io.ResolverUtil  - Checking to see if class club.guoshizhan.dao.IAccountDao matches criteria [is assignable to Object]</span><br><span class="line">2020-08-24 15:00:58,839 154    [           main] DEBUG .apache.ibatis.io.ResolverUtil  - Checking to see if class club.guoshizhan.dao.IUserDao matches criteria [is assignable to Object]</span><br><span class="line">2020-08-24 15:00:58,840 155    [           main] DEBUG .apache.ibatis.io.ResolverUtil  - Checking to see if class club.guoshizhan.dao.UserDaoImpl matches criteria [is assignable to Object]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">24</span> <span class="number">15</span>:<span class="number">00</span>:<span class="number">58</span>,<span class="number">974</span> <span class="number">289</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Opening JDBC Connection</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">24</span> <span class="number">15</span>:<span class="number">00</span>:<span class="number">59</span>,<span class="number">260</span> <span class="number">575</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Setting autocommit to <span class="keyword">false</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">126f</span>7b2]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">24</span> <span class="number">15</span>:<span class="number">00</span>:<span class="number">59</span>,<span class="number">266</span> <span class="number">581</span>    [           main] DEBUG hizhan.dao.IAccountDao.findAll  - ==&gt;  Preparing: SELECT u.*,a.id AS aid,a.uid,a.money FROM USER u,account a WHERE u.id = a.uid </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">24</span> <span class="number">15</span>:<span class="number">00</span>:<span class="number">59</span>,<span class="number">292</span> <span class="number">607</span>    [           main] DEBUG hizhan.dao.IAccountDao.findAll  - ==&gt; Parameters: </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">24</span> <span class="number">15</span>:<span class="number">00</span>:<span class="number">59</span>,<span class="number">312</span> <span class="number">627</span>    [           main] DEBUG hizhan.dao.IAccountDao.findAll  - &lt;==      Total: <span class="number">2</span></span><br><span class="line">======== 一对一表结构结果输出 ========</span><br><span class="line">Account&#123;id=<span class="number">1</span>, uid=<span class="number">46</span>, money=<span class="number">1000.0</span>&#125;</span><br><span class="line">User&#123;id=<span class="number">46</span>, username=<span class="string">'老王'</span>, birthday=Wed Mar <span class="number">07</span> <span class="number">17</span>:<span class="number">37</span>:<span class="number">26</span> CST <span class="number">2018</span>, sex=<span class="string">'男'</span>, address=<span class="string">'北京'</span>&#125;</span><br><span class="line">======== 一对一表结构结果输出 ========</span><br><span class="line">Account&#123;id=<span class="number">3</span>, uid=<span class="number">46</span>, money=<span class="number">2000.0</span>&#125;</span><br><span class="line">User&#123;id=<span class="number">46</span>, username=<span class="string">'老王'</span>, birthday=Wed Mar <span class="number">07</span> <span class="number">17</span>:<span class="number">37</span>:<span class="number">26</span> CST <span class="number">2018</span>, sex=<span class="string">'男'</span>, address=<span class="string">'北京'</span>&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>TIPS：</code> <strong><em>一对一</em></strong> 表结构到此结束！！！</p>
</blockquote>
<h2 id="一对多"><a href="#一对多" class="headerlink" title="一对多"></a>一对多</h2><p>话不多说，现在就解决 <code>一对多</code> 的表结构。<strong><em><code>第一步：</code> 给 <code>User</code> 实体类添加一个属性，从而体现一对多的表结构。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>User.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/6/22 23:52</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: User 实体类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 一对多关系映射，主表实体应该包含从表实体的集合引用</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Account&gt; accounts;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Account&gt; <span class="title">getAccounts</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> accounts;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAccounts</span><span class="params">(List&lt;Account&gt; accounts)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.accounts = accounts;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"User&#123;"</span> +</span><br><span class="line">                <span class="string">"id="</span> + id +</span><br><span class="line">                <span class="string">", username='"</span> + username + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", birthday="</span> + birthday +</span><br><span class="line">                <span class="string">", sex='"</span> + sex + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", address='"</span> + address + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getBirthday</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> birthday;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBirthday</span><span class="params">(Date birthday)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.birthday = birthday;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSex</span><span class="params">(String sex)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sex = sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAddress</span><span class="params">(String address)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第二步：</code> <strong><em>修改 <code>IUserDao.xml</code> 文件，把以下代码替换原来的 <code>id=&quot;findAll&quot;</code> 的那部分查询代码 。</em></strong> 代码如下：</p>
<figure class="highlight xml"><figcaption><span>IUserDao.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 定义User 的 resultMap --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userMap"</span> <span class="attr">type</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"username"</span> <span class="attr">column</span>=<span class="string">"username"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"address"</span> <span class="attr">column</span>=<span class="string">"address"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"sex"</span> <span class="attr">column</span>=<span class="string">"sex"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"birthday"</span> <span class="attr">column</span>=<span class="string">"birthday"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置 user 对象中 accounts 的集合映射。ofType 代表集合中元素的类型 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"accounts"</span> <span class="attr">ofType</span>=<span class="string">"account"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"aid"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"uid"</span> <span class="attr">column</span>=<span class="string">"uid"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"money"</span> <span class="attr">column</span>=<span class="string">"money"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultMap</span>=<span class="string">"userMap"</span>&gt;</span></span><br><span class="line">  SELECT u.*,a.id as aid,a.money,a.uid FROM USER u LEFT OUTER JOIN account a ON a.uid=u.id</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>第三步：</code> <strong><em>编写测试类 <code>UserTest</code> 进行测试。</em></strong> 代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.dao.IUserDao;</span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.After;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/6/23 11:03</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Mybatis 测试类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> InputStream in;</span><br><span class="line">    <span class="keyword">private</span> IUserDao userDao;</span><br><span class="line">    <span class="keyword">private</span> SqlSession session;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试方法执行之前执行，用于一些初始化的操作，不理解的应该去看看单元测试相关知识</span></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        in = Resources.getResourceAsStream(<span class="string">"SqlMapConfig.xml"</span>);</span><br><span class="line">        SqlSessionFactory factory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br><span class="line">        session = factory.openSession();</span><br><span class="line">        userDao = session.getMapper(IUserDao<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有用户</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;User&gt; users = userDao.findAll();</span><br><span class="line">        <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">            System.out.println(<span class="string">"======== 一对多表结构结果输出 ========"</span>);</span><br><span class="line">            System.out.println(user);</span><br><span class="line">            System.out.println(user.getAccounts());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试方法执行之后执行，用于释放资源，不理解的应该去看看单元测试相关知识</span></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destory</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 06-关闭资源</span></span><br><span class="line">        in.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第四步：</code> <strong><em>执行 <code>testFindAll</code> 方法。</em></strong> 测试结果如下<strong><em>（注意 SQL 语句）</em></strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">2020-08-24 15:46:09,919 184    [           main] DEBUG .apache.ibatis.io.ResolverUtil  - Checking to see if class club.guoshizhan.dao.IAccountDao matches criteria [is assignable to Object]</span><br><span class="line">2020-08-24 15:46:09,919 184    [           main] DEBUG .apache.ibatis.io.ResolverUtil  - Checking to see if class club.guoshizhan.dao.IUserDao matches criteria [is assignable to Object]</span><br><span class="line">2020-08-24 15:46:09,919 184    [           main] DEBUG .apache.ibatis.io.ResolverUtil  - Checking to see if class club.guoshizhan.dao.UserDaoImpl matches criteria [is assignable to Object]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">24</span> <span class="number">15</span>:<span class="number">46</span>:<span class="number">10</span>,<span class="number">087</span> <span class="number">352</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Opening JDBC Connection</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">24</span> <span class="number">15</span>:<span class="number">46</span>:<span class="number">10</span>,<span class="number">394</span> <span class="number">659</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Setting autocommit to <span class="keyword">false</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">126f</span>7b2]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">24</span> <span class="number">15</span>:<span class="number">46</span>:<span class="number">10</span>,<span class="number">400</span> <span class="number">665</span>    [           main] DEBUG uoshizhan.dao.IUserDao.findAll  - ==&gt;  Preparing: SELECT u.*,a.id as aid,a.money,a.uid FROM USER u LEFT OUTER JOIN account a ON a.uid=u.id </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">24</span> <span class="number">15</span>:<span class="number">46</span>:<span class="number">10</span>,<span class="number">435</span> <span class="number">700</span>    [           main] DEBUG uoshizhan.dao.IUserDao.findAll  - ==&gt; Parameters: </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">24</span> <span class="number">15</span>:<span class="number">46</span>:<span class="number">10</span>,<span class="number">465</span> <span class="number">730</span>    [           main] DEBUG uoshizhan.dao.IUserDao.findAll  - &lt;==      Total: <span class="number">8</span></span><br><span class="line">======== 一对多表结构结果输出 ========</span><br><span class="line">User&#123;id=<span class="number">42</span>, username=<span class="string">'小二王'</span>, birthday=Fri Mar <span class="number">02</span> <span class="number">15</span>:<span class="number">09</span>:<span class="number">37</span> CST <span class="number">2018</span>, sex=<span class="string">'女'</span>, address=<span class="string">'北京金燕龙'</span>&#125;</span><br><span class="line">[]</span><br><span class="line">======== 一对多表结构结果输出 ========</span><br><span class="line">User&#123;id=<span class="number">43</span>, username=<span class="string">'大王'</span>, birthday=Tue Nov <span class="number">12</span> <span class="number">10</span>:<span class="number">19</span>:<span class="number">13</span> CST <span class="number">2019</span>, sex=<span class="string">'男'</span>, address=<span class="string">'Los Angeles'</span>&#125;</span><br><span class="line">[]</span><br><span class="line">======== 一对多表结构结果输出 ========</span><br><span class="line">User&#123;id=<span class="number">46</span>, username=<span class="string">'老王'</span>, birthday=Wed Mar <span class="number">07</span> <span class="number">17</span>:<span class="number">37</span>:<span class="number">26</span> CST <span class="number">2018</span>, sex=<span class="string">'男'</span>, address=<span class="string">'北京'</span>&#125;</span><br><span class="line">[Account&#123;id=<span class="number">1</span>, uid=<span class="number">46</span>, money=<span class="number">1000.0</span>&#125;, Account&#123;id=<span class="number">3</span>, uid=<span class="number">46</span>, money=<span class="number">2000.0</span>&#125;]</span><br><span class="line">======== 一对多表结构结果输出 ========</span><br><span class="line">User&#123;id=<span class="number">49</span>, username=<span class="string">'Jack'</span>, birthday=Mon Oct <span class="number">28</span> <span class="number">09</span>:<span class="number">15</span>:<span class="number">39</span> CST <span class="number">2019</span>, sex=<span class="string">'男'</span>, address=<span class="string">'上海闵行'</span>&#125;</span><br><span class="line">[]</span><br><span class="line">======== 一对多表结构结果输出 ========</span><br><span class="line">User&#123;id=<span class="number">51</span>, username=<span class="string">'Lisa'</span>, birthday=Mon Oct <span class="number">28</span> <span class="number">09</span>:<span class="number">17</span>:<span class="number">31</span> CST <span class="number">2019</span>, sex=<span class="string">'女'</span>, address=<span class="string">'广东佛山'</span>&#125;</span><br><span class="line">[]</span><br><span class="line">======== 一对多表结构结果输出 ========</span><br><span class="line">User&#123;id=<span class="number">52</span>, username=<span class="string">'Tom'</span>, birthday=Mon Oct <span class="number">28</span> <span class="number">10</span>:<span class="number">26</span>:<span class="number">42</span> CST <span class="number">2019</span>, sex=<span class="string">'男'</span>, address=<span class="string">'广东佛山'</span>&#125;</span><br><span class="line">[]</span><br><span class="line">======== 一对多表结构结果输出 ========</span><br><span class="line">User&#123;id=<span class="number">54</span>, username=<span class="string">'Bob'</span>, birthday=Tue Nov <span class="number">12</span> <span class="number">10</span>:<span class="number">21</span>:<span class="number">41</span> CST <span class="number">2019</span>, sex=<span class="string">'男'</span>, address=<span class="string">'广东佛山'</span>&#125;</span><br><span class="line">[]</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>TIPS：</code> <strong><em>一对多</em></strong> 表结构到此结束！！！</p>
</blockquote>
<h2 id="多对多"><a href="#多对多" class="headerlink" title="多对多"></a>多对多</h2><p><strong><em>为了实现 <code>多对多</code> 操作，我们需要新建一个工程（主要是为了操作方便，排除一些不必要的干扰）。</em></strong> 也可点击右侧下载工程： <a href="../gallery/Resources/mybatis-many2many.zip">多对多工程</a>。下载工程之后，我们来看一下需要做的准备工作。如下：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ mybatis 中的多表查询之多对多：用户表和角色表</span></span><br><span class="line"><span class="addition">+ 一个用户可以有多个角色，一个角色也可以赋予多个用户</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ 要实现两张表的关联操作，需要如下步骤：</span></span><br><span class="line"><span class="addition">+ 1、建立两张表：用户表，角色表。让用户表和角色表具有多对多的关系。需要使用中间表，中间表中包含各自的主键，在中间表中是外键。</span></span><br><span class="line"><span class="addition">+ 2、建立两个实体类：用户实体类和角色实体类。让用户和角色的实体类能体现出来多对多的关系（各自包含对方一个集合引用）</span></span><br><span class="line"><span class="addition">+ 3、建立两个配置文件。用户的配置文件和角色的配置文件</span></span><br><span class="line"><span class="addition">+ 4、实现配置：当我们查询用户时，可以同时得到用户所包含的角色信息；当我们查询角色时，可以同时得到角色的所赋予的用户信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span></span><br></pre></td></tr></table></figure>

<p><code>建表语句</code> 在 <strong><em>mybatis 的环境搭建</em></strong> 小结已经完成了，所以第一步就搞定了。<strong><em>我们的用户实体类（User 类）在工程中已经创好了，所以第二步操作只需要在 <code>domain</code> 包下建立角色实体类（Role 类），然后在 <code>dao</code> 包下新建对应的 dao 接口。</em></strong> 相关代码如下：</p>
<figure class="highlight java"><figcaption><span>Role.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/8/24 16:30</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 角色类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Role</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer roleId;</span><br><span class="line">    <span class="keyword">private</span> String roleName;</span><br><span class="line">    <span class="keyword">private</span> String roleDesc;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 多对多的关系映射，表示一个角色可以赋予多个用户</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;User&gt; users;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">getUsers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> users;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsers</span><span class="params">(List&lt;User&gt; users)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.users = users;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getRoleId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> roleId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRoleId</span><span class="params">(Integer roleId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.roleId = roleId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getRoleName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> roleName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRoleName</span><span class="params">(String roleName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.roleName = roleName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getRoleDesc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> roleDesc;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRoleDesc</span><span class="params">(String roleDesc)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.roleDesc = roleDesc;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Role&#123;"</span> +</span><br><span class="line">                <span class="string">"roleId="</span> + roleId +</span><br><span class="line">                <span class="string">", roleName='"</span> + roleName + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", roleDesc='"</span> + roleDesc + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>角色实体类完成之后，<strong><em>我们去 <code>dao</code> 包下新建 <code>IRoleDao</code> 接口。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>IRoleDao.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.Role;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/8/24 16:32</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: IRoleDao 接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IRoleDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有角色</span></span><br><span class="line">    <span class="function">List&lt;Role&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接口搞定之后，<strong><em>我们去 <code>resources</code> 目录下的 club/guoshizhan/dao 下新建 <code>IRoleDao.xml</code> 配置文件。</em></strong> 代码如下：</p>
<figure class="highlight xml"><figcaption><span>IRoleDao.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"club.guoshizhan.dao.IRoleDao"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 定义角色表的 resultMap --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"roleMap"</span> <span class="attr">type</span>=<span class="string">"club.guoshizhan.domain.Role"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"roleId"</span> <span class="attr">column</span>=<span class="string">"rid"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"roleName"</span> <span class="attr">column</span>=<span class="string">"role_name"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"roleDesc"</span> <span class="attr">column</span>=<span class="string">"role_desc"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"users"</span> <span class="attr">ofType</span>=<span class="string">"club.guoshizhan.domain.User"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"username"</span> <span class="attr">column</span>=<span class="string">"username"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"address"</span> <span class="attr">column</span>=<span class="string">"address"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"sex"</span> <span class="attr">column</span>=<span class="string">"sex"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"birthday"</span> <span class="attr">column</span>=<span class="string">"birthday"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 查询所有 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultMap</span>=<span class="string">"roleMap"</span>&gt;</span></span><br><span class="line">        SELECT u.*,r.id AS rid,r.role_name,r.role_desc FROM role r</span><br><span class="line">        LEFT OUTER JOIN user_role ur ON r.id=ur.rid</span><br><span class="line">        LEFT OUTER JOIN USER u ON u.id=ur.uid</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong><em>最后，我们新建 RoleTest 测试类进行测试。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>RoleTest.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.dao.IRoleDao;</span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.Role;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.After;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RoleTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> InputStream in;</span><br><span class="line">    <span class="keyword">private</span> SqlSession session;</span><br><span class="line">    <span class="keyword">private</span> IRoleDao roleDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span><span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        in = Resources.getResourceAsStream(<span class="string">"SqlMapConfig.xml"</span>);</span><br><span class="line">        SqlSessionFactoryBuilder builder = <span class="keyword">new</span> SqlSessionFactoryBuilder();</span><br><span class="line">        SqlSessionFactory factory = builder.build(in);</span><br><span class="line">        session = factory.openSession();</span><br><span class="line">        roleDao = session.getMapper(IRoleDao<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAll</span><span class="params">()</span></span>&#123;</span><br><span class="line">        List&lt;Role&gt; roles = roleDao.findAll();</span><br><span class="line">        <span class="keyword">for</span>(Role role : roles)&#123;</span><br><span class="line">            System.out.println(<span class="string">"-------- 每个角色的信息 --------"</span>);</span><br><span class="line">            System.out.println(role);</span><br><span class="line">            System.out.println(role.getUsers());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destory</span><span class="params">()</span><span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        session.commit();</span><br><span class="line">        session.close();</span><br><span class="line">        in.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><em>执行上述的 <code>testFindAll</code> 方法，</em></strong> 结果如下<strong><em>（注意 SQL 语句）</em></strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">2020-08-24 17:13:04,762 187    [           main] DEBUG .apache.ibatis.io.ResolverUtil  - Checking to see if class club.guoshizhan.dao.IRoleDao matches criteria [is assignable to Object]</span><br><span class="line">2020-08-24 17:13:04,762 187    [           main] DEBUG .apache.ibatis.io.ResolverUtil  - Checking to see if class club.guoshizhan.dao.IUserDao matches criteria [is assignable to Object]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">24</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">04</span>,<span class="number">964</span> <span class="number">389</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Opening JDBC Connection</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">24</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">05</span>,<span class="number">244</span> <span class="number">669</span>    [           main] DEBUG source.pooled.PooledDataSource  - Created connection <span class="number">8864840</span>.</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">24</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">05</span>,<span class="number">245</span> <span class="number">670</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Setting autocommit to <span class="keyword">false</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">874448</span>]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">24</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">05</span>,<span class="number">247</span> <span class="number">672</span>    [           main] DEBUG uoshizhan.dao.IRoleDao.findAll  - ==&gt;  Preparing: SELECT u.*,r.id AS rid,r.role_name,r.role_desc FROM role r LEFT OUTER JOIN user_role ur ON r.id=ur.rid LEFT OUTER JOIN USER u ON u.id=ur.uid </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">24</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">05</span>,<span class="number">275</span> <span class="number">700</span>    [           main] DEBUG uoshizhan.dao.IRoleDao.findAll  - ==&gt; Parameters: </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">24</span> <span class="number">17</span>:<span class="number">13</span>:<span class="number">05</span>,<span class="number">302</span> <span class="number">727</span>    [           main] DEBUG uoshizhan.dao.IRoleDao.findAll  - &lt;==      Total: <span class="number">5</span></span><br><span class="line">-------- 每个角色的信息 --------</span><br><span class="line">Role&#123;roleId=<span class="number">1</span>, roleName=<span class="string">'院长'</span>, roleDesc=<span class="string">'管理整个学院'</span>&#125;</span><br><span class="line">[User&#123;id=<span class="number">49</span>, username=<span class="string">'Jack'</span>, birthday=Mon Oct <span class="number">28</span> <span class="number">09</span>:<span class="number">15</span>:<span class="number">39</span> CST <span class="number">2019</span>, sex=<span class="string">'男'</span>, address=<span class="string">'上海闵行'</span>&#125;, User&#123;id=<span class="number">51</span>, username=<span class="string">'Lisa'</span>, birthday=Mon Oct <span class="number">28</span> <span class="number">09</span>:<span class="number">17</span>:<span class="number">31</span> CST <span class="number">2019</span>, sex=<span class="string">'女'</span>, address=<span class="string">'广东佛山'</span>&#125;]</span><br><span class="line">-------- 每个角色的信息 --------</span><br><span class="line">Role&#123;roleId=<span class="number">2</span>, roleName=<span class="string">'总裁'</span>, roleDesc=<span class="string">'管理整个公司'</span>&#125;</span><br><span class="line">[User&#123;id=<span class="number">51</span>, username=<span class="string">'Lisa'</span>, birthday=Mon Oct <span class="number">28</span> <span class="number">09</span>:<span class="number">17</span>:<span class="number">31</span> CST <span class="number">2019</span>, sex=<span class="string">'女'</span>, address=<span class="string">'广东佛山'</span>&#125;]</span><br><span class="line">-------- 每个角色的信息 --------</span><br><span class="line">Role&#123;roleId=<span class="number">3</span>, roleName=<span class="string">'校长'</span>, roleDesc=<span class="string">'管理整个学校'</span>&#125;</span><br><span class="line">[User&#123;id=<span class="number">49</span>, username=<span class="string">'Jack'</span>, birthday=Mon Oct <span class="number">28</span> <span class="number">09</span>:<span class="number">15</span>:<span class="number">39</span> CST <span class="number">2019</span>, sex=<span class="string">'男'</span>, address=<span class="string">'上海闵行'</span>&#125;, User&#123;id=<span class="number">51</span>, username=<span class="string">'Lisa'</span>, birthday=Mon Oct <span class="number">28</span> <span class="number">09</span>:<span class="number">17</span>:<span class="number">31</span> CST <span class="number">2019</span>, sex=<span class="string">'女'</span>, address=<span class="string">'广东佛山'</span>&#125;]</span><br></pre></td></tr></table></figure>

<hr>
<p>上述的操作实现了 <strong><em>从角色到用户的多对多操作。那么接下来要实现 <code>从用户到角色的多对多操作</code> 。这个过程和上面的操作极其相似，</em></strong> 所以下面使用简略步骤进行描述。</p>
<hr>
<p><code>第一步：</code> <strong><em>给 <code>User</code> 类加上 <code>roles</code> 属性，用于多对多的关系映射。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>User.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/6/22 23:52</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: User 实体类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 多对多的关系映射，表示一个用户可以具备多个角色</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Role&gt; roles;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Role&gt; <span class="title">getRoles</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> roles;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRoles</span><span class="params">(List&lt;Role&gt; roles)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.roles = roles;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"User&#123;"</span> +</span><br><span class="line">                <span class="string">"id="</span> + id +</span><br><span class="line">                <span class="string">", username='"</span> + username + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", birthday="</span> + birthday +</span><br><span class="line">                <span class="string">", sex='"</span> + sex + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", address='"</span> + address + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getBirthday</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> birthday;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBirthday</span><span class="params">(Date birthday)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.birthday = birthday;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSex</span><span class="params">(String sex)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sex = sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAddress</span><span class="params">(String address)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第二步：</code> <strong><em>编写 <code>IUserDao.xml</code> 配置文件。</em></strong> 代码如下：</p>
<figure class="highlight xml"><figcaption><span>IUserDao.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"club.guoshizhan.dao.IUserDao"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userMap"</span> <span class="attr">type</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"username"</span> <span class="attr">column</span>=<span class="string">"username"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"address"</span> <span class="attr">column</span>=<span class="string">"address"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"sex"</span> <span class="attr">column</span>=<span class="string">"sex"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"birthday"</span> <span class="attr">column</span>=<span class="string">"birthday"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 配置角色映射集合 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"roles"</span> <span class="attr">ofType</span>=<span class="string">"role"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"roleId"</span> <span class="attr">column</span>=<span class="string">"rid"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"roleName"</span> <span class="attr">column</span>=<span class="string">"role_name"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"roleDesc"</span> <span class="attr">column</span>=<span class="string">"role_desc"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultMap</span>=<span class="string">"userMap"</span>&gt;</span></span><br><span class="line">      SELECT u.*,r.id AS rid,r.role_name,r.role_desc FROM USER u</span><br><span class="line">      LEFT OUTER JOIN user_role ur ON u.id=ur.uid</span><br><span class="line">      LEFT OUTER JOIN role r ON r.id=ur.rid</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong><em>最后，在 <code>UserTest</code> 测试类中编写方法进行测试。</em></strong> 代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.dao.IUserDao;</span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.After;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/6/23 11:03</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Mybatis 测试类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> InputStream in;</span><br><span class="line">    <span class="keyword">private</span> IUserDao userDao;</span><br><span class="line">    <span class="keyword">private</span> SqlSession session;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试方法执行之前执行，用于一些初始化的操作，不理解的应该去看看单元测试相关知识</span></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        in = Resources.getResourceAsStream(<span class="string">"SqlMapConfig.xml"</span>);</span><br><span class="line">        SqlSessionFactory factory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br><span class="line">        session = factory.openSession();</span><br><span class="line">        userDao = session.getMapper(IUserDao<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有用户</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;User&gt; users = userDao.findAll();</span><br><span class="line">        <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">            System.out.println(<span class="string">"-------- 每个用户的信息 --------"</span>);</span><br><span class="line">            System.out.println(user);</span><br><span class="line">            System.out.println(user.getRoles());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试方法执行之后执行，用于释放资源，不理解的应该去看看单元测试相关知识</span></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destory</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 06-关闭资源</span></span><br><span class="line">        in.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><em>执行上述的 <code>testFindAll</code> 方法，</em></strong> 结果如下<strong><em>（注意 SQL 语句）</em></strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">2020-08-24 19:26:55,933 177    [           main] DEBUG .apache.ibatis.io.ResolverUtil  - Checking to see if class club.guoshizhan.dao.IRoleDao matches criteria [is assignable to Object]</span><br><span class="line">2020-08-24 19:26:55,934 178    [           main] DEBUG .apache.ibatis.io.ResolverUtil  - Checking to see if class club.guoshizhan.dao.IUserDao matches criteria [is assignable to Object]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">24</span> <span class="number">19</span>:<span class="number">26</span>:<span class="number">56</span>,<span class="number">080</span> <span class="number">324</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Opening JDBC Connection</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">24</span> <span class="number">19</span>:<span class="number">26</span>:<span class="number">56</span>,<span class="number">422</span> <span class="number">666</span>    [           main] DEBUG source.pooled.PooledDataSource  - Created connection <span class="number">8864840</span>.</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">24</span> <span class="number">19</span>:<span class="number">26</span>:<span class="number">56</span>,<span class="number">423</span> <span class="number">667</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Setting autocommit to <span class="keyword">false</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">874448</span>]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">24</span> <span class="number">19</span>:<span class="number">26</span>:<span class="number">56</span>,<span class="number">425</span> <span class="number">669</span>    [           main] DEBUG uoshizhan.dao.IUserDao.findAll  - ==&gt;  Preparing: SELECT u.*,r.id AS rid,r.role_name,r.role_desc FROM USER u LEFT OUTER JOIN user_role ur ON u.id=ur.uid LEFT OUTER JOIN role r ON r.id=ur.rid </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">24</span> <span class="number">19</span>:<span class="number">26</span>:<span class="number">56</span>,<span class="number">449</span> <span class="number">693</span>    [           main] DEBUG uoshizhan.dao.IUserDao.findAll  - ==&gt; Parameters: </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">24</span> <span class="number">19</span>:<span class="number">26</span>:<span class="number">56</span>,<span class="number">474</span> <span class="number">718</span>    [           main] DEBUG uoshizhan.dao.IUserDao.findAll  - &lt;==      Total: <span class="number">10</span></span><br><span class="line">-------- 每个用户的信息 --------</span><br><span class="line">User&#123;id=<span class="number">42</span>, username=<span class="string">'小二王'</span>, birthday=Fri Mar <span class="number">02</span> <span class="number">15</span>:<span class="number">09</span>:<span class="number">37</span> CST <span class="number">2018</span>, sex=<span class="string">'女'</span>, address=<span class="string">'北京金燕龙'</span>&#125;</span><br><span class="line">[]</span><br><span class="line">-------- 每个用户的信息 --------</span><br><span class="line">User&#123;id=<span class="number">43</span>, username=<span class="string">'大王'</span>, birthday=Tue Nov <span class="number">12</span> <span class="number">10</span>:<span class="number">19</span>:<span class="number">13</span> CST <span class="number">2019</span>, sex=<span class="string">'男'</span>, address=<span class="string">'Los Angeles'</span>&#125;</span><br><span class="line">[]</span><br><span class="line">-------- 每个用户的信息 --------</span><br><span class="line">User&#123;id=<span class="number">46</span>, username=<span class="string">'老王'</span>, birthday=Wed Mar <span class="number">07</span> <span class="number">17</span>:<span class="number">37</span>:<span class="number">26</span> CST <span class="number">2018</span>, sex=<span class="string">'男'</span>, address=<span class="string">'北京'</span>&#125;</span><br><span class="line">[]</span><br><span class="line">-------- 每个用户的信息 --------</span><br><span class="line">User&#123;id=<span class="number">49</span>, username=<span class="string">'Jack'</span>, birthday=Mon Oct <span class="number">28</span> <span class="number">09</span>:<span class="number">15</span>:<span class="number">39</span> CST <span class="number">2019</span>, sex=<span class="string">'男'</span>, address=<span class="string">'上海闵行'</span>&#125;</span><br><span class="line">[Role&#123;roleId=<span class="number">1</span>, roleName=<span class="string">'院长'</span>, roleDesc=<span class="string">'管理整个学院'</span>&#125;, Role&#123;roleId=<span class="number">3</span>, roleName=<span class="string">'校长'</span>, roleDesc=<span class="string">'管理整个学校'</span>&#125;]</span><br><span class="line">-------- 每个用户的信息 --------</span><br><span class="line">User&#123;id=<span class="number">51</span>, username=<span class="string">'Lisa'</span>, birthday=Mon Oct <span class="number">28</span> <span class="number">09</span>:<span class="number">17</span>:<span class="number">31</span> CST <span class="number">2019</span>, sex=<span class="string">'女'</span>, address=<span class="string">'广东佛山'</span>&#125;</span><br><span class="line">[Role&#123;roleId=<span class="number">1</span>, roleName=<span class="string">'院长'</span>, roleDesc=<span class="string">'管理整个学院'</span>&#125;, Role&#123;roleId=<span class="number">2</span>, roleName=<span class="string">'总裁'</span>, roleDesc=<span class="string">'管理整个公司'</span>&#125;, Role&#123;roleId=<span class="number">3</span>, roleName=<span class="string">'校长'</span>, roleDesc=<span class="string">'管理整个学校'</span>&#125;]</span><br><span class="line">-------- 每个用户的信息 --------</span><br><span class="line">User&#123;id=<span class="number">52</span>, username=<span class="string">'Tom'</span>, birthday=Mon Oct <span class="number">28</span> <span class="number">10</span>:<span class="number">26</span>:<span class="number">42</span> CST <span class="number">2019</span>, sex=<span class="string">'男'</span>, address=<span class="string">'广东佛山'</span>&#125;</span><br><span class="line">[]</span><br><span class="line">-------- 每个用户的信息 --------</span><br><span class="line">User&#123;id=<span class="number">54</span>, username=<span class="string">'Bob'</span>, birthday=Tue Nov <span class="number">12</span> <span class="number">10</span>:<span class="number">21</span>:<span class="number">41</span> CST <span class="number">2019</span>, sex=<span class="string">'男'</span>, address=<span class="string">'广东佛山'</span>&#125;</span><br><span class="line">[]</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>TIPS：</code> <strong><em>多对多</em></strong> 表结构到此结束！！！</p>
</blockquote>
<h1 id="JNDI-知识"><a href="#JNDI-知识" class="headerlink" title="JNDI 知识"></a>JNDI 知识</h1><p><em>这个部分的内容不是很重要，所以就先跳过，以后有空再完善。</em></p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+ 这个部分的内容不是很重要，所以就先跳过，以后有空再完善</span></span><br><span class="line"><span class="addition">+ 这个部分的内容不是很重要，所以就先跳过，以后有空再完善</span></span><br><span class="line"><span class="addition">+ 这个部分的内容不是很重要，所以就先跳过，以后有空再完善</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>TIPS：</code> <strong><em>JNDI 知识</em></strong> 到此结束！！！</p>
</blockquote>
<h1 id="延迟加载和缓存"><a href="#延迟加载和缓存" class="headerlink" title="延迟加载和缓存"></a>延迟加载和缓存</h1><h2 id="mybatis-的延迟加载"><a href="#mybatis-的延迟加载" class="headerlink" title="mybatis 的延迟加载"></a>mybatis 的延迟加载</h2><p>有没有想过，<strong><em>为什么需要延迟加载技术？延迟加载主要用来干嘛的？</em></strong> 带着问题往下看：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ 问题：在一对多中，当我们有一个用户，它有100个账户。</span></span><br><span class="line"><span class="addition">+ 1、在查询用户的时候，要不要把关联的账户查出来？        2、在查询账户的时候，要不要把关联的用户查出来？</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ 什么是延迟加载？</span></span><br><span class="line"><span class="addition">+ 在真正使用数据时才发起查询，不用的时候不查询。这种加载方式称之为延迟加载，也叫做按需加载（懒加载）</span></span><br><span class="line"><span class="addition">+ 延迟加载举例：在查询用户时，用户下的账户信息应该是这样的：什么时候使用，就什么时候查询，而不是一查询用户就把所有账户显示出来</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ 什么是立即加载？</span></span><br><span class="line"><span class="addition">+ 不管用不用，只要一调用方法，马上发起查询。这中加载方式就叫做立即加载</span></span><br><span class="line"><span class="addition">+ 立即加载举例：在查询账户时，账户的所属用户信息应该是随着账户查询时一起查询出来，否则我哪知道这个账户是谁的。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ 在对应的四种表关系（一对多，多对一，一对一，多对多）中，它们分别适合哪种加载方式？</span></span><br><span class="line"><span class="addition">+ 一对多，多对多：通常情况下我们都是采用延迟加载。        多对一，一对一：通常情况下我们都是采用立即加载。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span></span><br></pre></td></tr></table></figure>

<p>了解完 <strong><em>延迟加载</em></strong> 相关概念之后，我们就来操作一下吧！<strong><em>（一对一的延迟加载）</em></strong> <code>第一步：</code> <strong><em>新建一个 maven 工程（自己构建一下，包括新建包结构等等，这里不过多介绍了），然后加入如下依赖：</em></strong></p>
<figure class="highlight xml"><figcaption><span>pom.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- mybatis 依赖，必须要 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- mysql 数据库驱动依赖，必须要 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 日志依赖，不是一定要 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 测试依赖，不是一定要 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>第二步：</code> <strong><em>在 <code>domain</code> 包下新建一个 <code>User</code> 实体类和 <code>Account</code> 实体类。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>User.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/6/22 23:52</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: User 实体类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;Account&gt; accounts;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Account&gt; <span class="title">getAccounts</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> accounts;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAccounts</span><span class="params">(List&lt;Account&gt; accounts)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.accounts = accounts;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"User&#123;"</span> +</span><br><span class="line">                <span class="string">"id="</span> + id +</span><br><span class="line">                <span class="string">", username='"</span> + username + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", birthday="</span> + birthday +</span><br><span class="line">                <span class="string">", sex='"</span> + sex + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", address='"</span> + address + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getBirthday</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> birthday;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBirthday</span><span class="params">(Date birthday)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.birthday = birthday;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSex</span><span class="params">(String sex)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sex = sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAddress</span><span class="params">(String address)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><figcaption><span>Account.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/8/24 10:59</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Account 类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Account</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> Integer uid;</span><br><span class="line">    <span class="keyword">private</span> Double money;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.user = user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getUid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> uid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUid</span><span class="params">(Integer uid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.uid = uid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Double <span class="title">getMoney</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> money;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMoney</span><span class="params">(Double money)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.money = money;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Account&#123;"</span> +</span><br><span class="line">                <span class="string">"id="</span> + id +</span><br><span class="line">                <span class="string">", uid="</span> + uid +</span><br><span class="line">                <span class="string">", money="</span> + money +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第三步：</code> <strong><em>在 <code>dao</code> 包下新建 <code>IUserDao</code> 接口 和 <code>IAccountDao</code> 接口。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>IUserDao.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/6/22 23:53</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 用户持久层接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUserDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有用户</span></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据 id 查询用户</span></span><br><span class="line">    <span class="function">User <span class="title">findById</span><span class="params">(Integer userId)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><figcaption><span>IAccountDao.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.Account;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/8/24 11:07</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Account 的 dao 接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IAccountDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有账户，同时还需要获取到当前账户的所属用户信息</span></span><br><span class="line">    <span class="function">List&lt;Account&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第四步：</code> <strong><em>在 <code>resources</code> 目录下新建三个配置文件。</em></strong> 代码如下：</p>
<figure class="highlight properties"><figcaption><span>jdbcConfig.properties</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">jdbc.driver</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="meta">jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/eesy_mybatis</span></span><br><span class="line"><span class="meta">jdbc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">jdbc.password</span>=<span class="string">root</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><figcaption><span>SqlMapConfig.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Config 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 01-mybatis 的主配置文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">"jdbcConfig.properties"</span>&gt;</span><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"club.guoshizhan.domain"</span>&gt;</span><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"mysql"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"mysql"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>&gt;</span><span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"UNPOOLED"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driver&#125;"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"club.guoshizhan.dao"</span>&gt;</span><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight properties"><figcaption><span>log4j.properties</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Set root category priority to INFO and its only appender to CONSOLE.</span></span><br><span class="line"><span class="comment">#log4j.rootCategory=INFO, CONSOLE            debug   info   warn error fatal</span></span><br><span class="line"><span class="meta">log4j.rootCategory</span>=<span class="string">debug, CONSOLE, LOGFILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the enterprise logger category to FATAL and its only appender to CONSOLE.</span></span><br><span class="line"><span class="meta">log4j.logger.org.apache.axis.enterprise</span>=<span class="string">FATAL, CONSOLE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># CONSOLE is set to be a ConsoleAppender using a PatternLayout.</span></span><br><span class="line"><span class="meta">log4j.appender.CONSOLE</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="meta">log4j.appender.CONSOLE.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="meta">log4j.appender.CONSOLE.layout.ConversionPattern</span>=<span class="string">%d&#123;ISO8601&#125; %-6r [%15.15t] %-5p %30.30c %x - %m\n</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># LOGFILE is set to be a File appender using a PatternLayout.</span></span><br><span class="line"><span class="meta">log4j.appender.LOGFILE</span>=<span class="string">org.apache.log4j.FileAppender</span></span><br><span class="line"><span class="meta">log4j.appender.LOGFILE.File</span>=<span class="string">d:\axis.log</span></span><br><span class="line"><span class="meta">log4j.appender.LOGFILE.Append</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">log4j.appender.LOGFILE.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="meta">log4j.appender.LOGFILE.layout.ConversionPattern</span>=<span class="string">%d&#123;ISO8601&#125; %-6r [%15.15t] %-5p %30.30c %x - %m\n</span></span><br></pre></td></tr></table></figure>

<p><code>第五步：</code> <strong><em>在 <code>resources</code> 目录的包结构下新建 <code>IUserDao.xml</code> 文件 和 <code>IAccountDao.xml</code> 文件。</em></strong> 代码如下：</p>
<figure class="highlight xml"><figcaption><span>IUserDao.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"club.guoshizhan.dao.IUserDao"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 定义User 的 resultMap --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userMap"</span> <span class="attr">type</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"username"</span> <span class="attr">column</span>=<span class="string">"username"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"address"</span> <span class="attr">column</span>=<span class="string">"address"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"sex"</span> <span class="attr">column</span>=<span class="string">"sex"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"birthday"</span> <span class="attr">column</span>=<span class="string">"birthday"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 配置 user 对象中 accounts 的集合映射。ofType 代表集合中元素的类型 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"accounts"</span> <span class="attr">ofType</span>=<span class="string">"account"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"aid"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"uid"</span> <span class="attr">column</span>=<span class="string">"uid"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"money"</span> <span class="attr">column</span>=<span class="string">"money"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultMap</span>=<span class="string">"userMap"</span>&gt;</span></span><br><span class="line">      SELECT u.*,a.id as aid,a.money,a.uid FROM USER u LEFT OUTER JOIN account a ON a.uid=u.id</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 根据 id 查询用户 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findById"</span> <span class="attr">parameterType</span>=<span class="string">"Integer"</span> <span class="attr">resultType</span>=<span class="string">"User"</span>&gt;</span></span><br><span class="line">        select * from user where id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><figcaption><span>IAccountDao.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"club.guoshizhan.dao.IAccountDao"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"accountMap"</span> <span class="attr">type</span>=<span class="string">"account"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"uid"</span> <span class="attr">column</span>=<span class="string">"uid"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"money"</span> <span class="attr">column</span>=<span class="string">"money"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 查询所有账户 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultMap</span>=<span class="string">"accountMap"</span>&gt;</span></span><br><span class="line">      SELECT * FROM account</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>第六步：</code> <strong><em>编写 <code>AccountTest</code> 测试类。</em></strong> 代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.dao.IAccountDao;</span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.Account;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.After;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/6/23 11:03</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Mybatis 测试类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> InputStream in;</span><br><span class="line">    <span class="keyword">private</span> IAccountDao accountDao;</span><br><span class="line">    <span class="keyword">private</span> SqlSession session;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        in = Resources.getResourceAsStream(<span class="string">"SqlMapConfig.xml"</span>);</span><br><span class="line">        SqlSessionFactory factory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br><span class="line">        session = factory.openSession();</span><br><span class="line">        accountDao = session.getMapper(IAccountDao<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有用户</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;Account&gt; accounts = accountDao.findAll();</span><br><span class="line">        <span class="keyword">for</span> (Account account : accounts) &#123;</span><br><span class="line">            System.out.println(<span class="string">"======== 一对一 延迟加载 结果输出 ========"</span>);</span><br><span class="line">            System.out.println(account);</span><br><span class="line">            System.out.println(account.getUser());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destory</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        session.close();</span><br><span class="line">        in.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><em>执行上述 <code>testFindAll</code> 方法，</em></strong> 结果如下<strong><em>（注意 SQL 语句）</em></strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">2020-08-27 16:33:33,600 658    [           main] DEBUG .apache.ibatis.io.ResolverUtil  - Checking to see if class club.guoshizhan.dao.IAccountDao matches criteria [is assignable to Object]</span><br><span class="line">2020-08-27 16:33:33,600 658    [           main] DEBUG .apache.ibatis.io.ResolverUtil  - Checking to see if class club.guoshizhan.dao.IUserDao matches criteria [is assignable to Object]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">16</span>:<span class="number">33</span>:<span class="number">33</span>,<span class="number">886</span> <span class="number">944</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Opening JDBC Connection</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">16</span>:<span class="number">33</span>:<span class="number">34</span>,<span class="number">309</span> <span class="number">1367</span>   [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Setting autocommit to <span class="keyword">false</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">1f</span>bf16f]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">16</span>:<span class="number">33</span>:<span class="number">34</span>,<span class="number">316</span> <span class="number">1374</span>   [           main] DEBUG hizhan.dao.IAccountDao.findAll  - ==&gt;  Preparing: SELECT * FROM account </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">16</span>:<span class="number">33</span>:<span class="number">34</span>,<span class="number">348</span> <span class="number">1406</span>   [           main] DEBUG hizhan.dao.IAccountDao.findAll  - ==&gt; Parameters: </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">16</span>:<span class="number">33</span>:<span class="number">34</span>,<span class="number">368</span> <span class="number">1426</span>   [           main] DEBUG hizhan.dao.IAccountDao.findAll  - &lt;==      Total: <span class="number">2</span></span><br><span class="line">======== 一对一 延迟加载 结果输出 ========</span><br><span class="line">Account&#123;id=<span class="number">1</span>, uid=<span class="number">46</span>, money=<span class="number">1000.0</span>&#125;</span><br><span class="line"><span class="keyword">null</span></span><br><span class="line">======== 一对一 延迟加载 结果输出 ========</span><br><span class="line">Account&#123;id=<span class="number">3</span>, uid=<span class="number">46</span>, money=<span class="number">2000.0</span>&#125;</span><br><span class="line"><span class="keyword">null</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">16</span>:<span class="number">33</span>:<span class="number">34</span>,<span class="number">369</span> <span class="number">1427</span>   [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Resetting autocommit to <span class="keyword">true</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">1f</span>bf16f]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">16</span>:<span class="number">33</span>:<span class="number">34</span>,<span class="number">369</span> <span class="number">1427</span>   [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Closing JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">1f</span>bf16f]</span><br></pre></td></tr></table></figure>

<hr>
<p>为什么上述没有查到用户的信息呢（结果是 null）？因为我们只查询了 <code>account</code> 表，所以只有账户信息，没有用户信息。<strong><em>所以此时就需要去配置 <code>延迟加载</code> 了，接着往下看！！！</em></strong></p>
<hr>
<p><strong><em>那么如何配置延迟加载呢？</em></strong> <code>第一步：</code> <strong><em>在 <code>IAccountDao.xml</code> 文件中加入如下代码：</em></strong></p>
<figure class="highlight diff"><figcaption><span>IAccountDao.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;resultMap id="accountMap" type="account"&gt;</span><br><span class="line">    &lt;id property="id" column="id"&gt;&lt;/id&gt;</span><br><span class="line">    &lt;result property="uid" column="uid"&gt;&lt;/result&gt;</span><br><span class="line">    &lt;result property="money" column="money"&gt;&lt;/result&gt;</span><br><span class="line"><span class="addition">+   &lt;!-- 配置一对一延迟加载，使用 select 属性指定内容，就是去执行 IUserDao 下的 findById 方法 --&gt;</span></span><br><span class="line"><span class="addition">+   &lt;association property="user" column="uid" javaType="user" select="club.guoshizhan.dao.IUserDao.findById"&gt;</span></span><br><span class="line"><span class="addition">+   &lt;/association&gt;</span></span><br><span class="line">&lt;/resultMap&gt;</span><br></pre></td></tr></table></figure>

<p><code>第二步：</code> <strong><em>在 <code>SqlMapConfig.xml</code> 文件中加入如下代码：</em></strong></p>
<figure class="highlight diff"><figcaption><span>SqlMapConfig.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;properties resource="jdbcConfig.properties"&gt;&lt;/properties&gt;</span><br><span class="line"></span><br><span class="line"><span class="addition">+   &lt;!-- 配置延迟加载，各项参数在官网写的特别详细，建议参照官网学习 --&gt;</span></span><br><span class="line"><span class="addition">+   &lt;settings&gt;</span></span><br><span class="line"><span class="addition">+       &lt;!-- 开启 mybatis 支持延迟加载 --&gt;</span></span><br><span class="line"><span class="addition">+       &lt;setting name="lazyLoadingEnabled" value="true"/&gt;</span></span><br><span class="line"><span class="addition">+       &lt;setting name="aggressiveLazyLoading" value="false"/&gt;</span></span><br><span class="line"><span class="addition">+   &lt;/settings&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong><em>上述两步做完之后，我们去执行测试类中的 <code>testFindAll</code> 方法。（为了演示明显，我去数据库加了两条数据）</em></strong> 结果如下<strong><em>（注意 SQL 语句）</em></strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">16</span>:<span class="number">51</span>:<span class="number">03</span>,<span class="number">382</span> <span class="number">516</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Opening JDBC Connection</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">16</span>:<span class="number">51</span>:<span class="number">03</span>,<span class="number">696</span> <span class="number">830</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Setting autocommit to <span class="keyword">false</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">1f</span>bf16f]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">16</span>:<span class="number">51</span>:<span class="number">03</span>,<span class="number">708</span> <span class="number">842</span>    [           main] DEBUG hizhan.dao.IAccountDao.findAll  - ==&gt;  Preparing: SELECT * FROM account </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">16</span>:<span class="number">51</span>:<span class="number">03</span>,<span class="number">738</span> <span class="number">872</span>    [           main] DEBUG hizhan.dao.IAccountDao.findAll  - ==&gt; Parameters: </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">16</span>:<span class="number">51</span>:<span class="number">03</span>,<span class="number">808</span> <span class="number">942</span>    [           main] DEBUG hizhan.dao.IAccountDao.findAll  - &lt;==      Total: <span class="number">4</span></span><br><span class="line">======== 一对一 延迟加载 结果输出 ========</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">16</span>:<span class="number">51</span>:<span class="number">03</span>,<span class="number">809</span> <span class="number">943</span>    [           main] DEBUG oshizhan.dao.IUserDao.findById  - ==&gt;  Preparing: select * from user where id=? </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">16</span>:<span class="number">51</span>:<span class="number">03</span>,<span class="number">809</span> <span class="number">943</span>    [           main] DEBUG oshizhan.dao.IUserDao.findById  - ==&gt; Parameters: <span class="number">46</span>(Integer)</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">16</span>:<span class="number">51</span>:<span class="number">03</span>,<span class="number">814</span> <span class="number">948</span>    [           main] DEBUG oshizhan.dao.IUserDao.findById  - &lt;==      Total: <span class="number">1</span></span><br><span class="line">Account&#123;id=<span class="number">1</span>, uid=<span class="number">46</span>, money=<span class="number">1000.0</span>&#125;</span><br><span class="line">User&#123;id=<span class="number">46</span>, username=<span class="string">'老王'</span>, birthday=Wed Mar <span class="number">07</span> <span class="number">17</span>:<span class="number">37</span>:<span class="number">26</span> CST <span class="number">2018</span>, sex=<span class="string">'男'</span>, address=<span class="string">'北京'</span>&#125;</span><br><span class="line">======== 一对一 延迟加载 结果输出 ========</span><br><span class="line">Account&#123;id=<span class="number">3</span>, uid=<span class="number">46</span>, money=<span class="number">2000.0</span>&#125;</span><br><span class="line">User&#123;id=<span class="number">46</span>, username=<span class="string">'老王'</span>, birthday=Wed Mar <span class="number">07</span> <span class="number">17</span>:<span class="number">37</span>:<span class="number">26</span> CST <span class="number">2018</span>, sex=<span class="string">'男'</span>, address=<span class="string">'北京'</span>&#125;</span><br><span class="line">======== 一对一 延迟加载 结果输出 ========</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">16</span>:<span class="number">51</span>:<span class="number">03</span>,<span class="number">818</span> <span class="number">952</span>    [           main] DEBUG oshizhan.dao.IUserDao.findById  - ==&gt;  Preparing: select * from user where id=? </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">16</span>:<span class="number">51</span>:<span class="number">03</span>,<span class="number">818</span> <span class="number">952</span>    [           main] DEBUG oshizhan.dao.IUserDao.findById  - ==&gt; Parameters: <span class="number">52</span>(Integer)</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">16</span>:<span class="number">51</span>:<span class="number">03</span>,<span class="number">819</span> <span class="number">953</span>    [           main] DEBUG oshizhan.dao.IUserDao.findById  - &lt;==      Total: <span class="number">1</span></span><br><span class="line">Account&#123;id=<span class="number">4</span>, uid=<span class="number">52</span>, money=<span class="number">3000.0</span>&#125;</span><br><span class="line">User&#123;id=<span class="number">52</span>, username=<span class="string">'Tom'</span>, birthday=Mon Oct <span class="number">28</span> <span class="number">10</span>:<span class="number">26</span>:<span class="number">42</span> CST <span class="number">2019</span>, sex=<span class="string">'男'</span>, address=<span class="string">'广东佛山'</span>&#125;</span><br><span class="line">======== 一对一 延迟加载 结果输出 ========</span><br><span class="line">Account&#123;id=<span class="number">5</span>, uid=<span class="number">52</span>, money=<span class="number">4000.0</span>&#125;</span><br><span class="line">User&#123;id=<span class="number">52</span>, username=<span class="string">'Tom'</span>, birthday=Mon Oct <span class="number">28</span> <span class="number">10</span>:<span class="number">26</span>:<span class="number">42</span> CST <span class="number">2019</span>, sex=<span class="string">'男'</span>, address=<span class="string">'广东佛山'</span>&#125;</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">16</span>:<span class="number">51</span>:<span class="number">03</span>,<span class="number">819</span> <span class="number">953</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Resetting autocommit to <span class="keyword">true</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">1f</span>bf16f]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">16</span>:<span class="number">51</span>:<span class="number">03</span>,<span class="number">820</span> <span class="number">954</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Closing JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">1f</span>bf16f]</span><br></pre></td></tr></table></figure>

<p>由上述结果可知，mybatis 执行了 <strong><em>延迟加载。它是先去查询了 account 表，然后再去查询 user 表。</em></strong> 如果不好理解，那就把测试方法改为如下代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;Account&gt; accounts = accountDao.findAll();</span><br><span class="line">    <span class="comment">// 啥都不干</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><em>再次执行 <code>testFindAll</code> 方法，</em></strong> 结果如下<strong><em>（注意 SQL 语句）</em></strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">36</span>,<span class="number">796</span> <span class="number">389</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Opening JDBC Connection</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">37</span>,<span class="number">089</span> <span class="number">682</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Setting autocommit to <span class="keyword">false</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">1f</span>bf16f]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">37</span>,<span class="number">098</span> <span class="number">691</span>    [           main] DEBUG hizhan.dao.IAccountDao.findAll  - ==&gt;  Preparing: SELECT * FROM account </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">37</span>,<span class="number">133</span> <span class="number">726</span>    [           main] DEBUG hizhan.dao.IAccountDao.findAll  - ==&gt; Parameters: </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">37</span>,<span class="number">223</span> <span class="number">816</span>    [           main] DEBUG hizhan.dao.IAccountDao.findAll  - &lt;==      Total: <span class="number">4</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">37</span>,<span class="number">223</span> <span class="number">816</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Resetting autocommit to <span class="keyword">true</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">1f</span>bf16f]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">37</span>,<span class="number">223</span> <span class="number">816</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Closing JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">1f</span>bf16f]</span><br></pre></td></tr></table></figure>

<hr>
<p>由上述结果可知，<strong><em>mybatis 只查询了 account 表，而没有去查询 user 表。（因为没有使用到，所以不去查，这个就是延迟加载）</em></strong> 一对一的延迟加载实现了，那么接下来实现 <strong><em>一对多的延迟加载</em></strong> 。</p>
<hr>
<p><code>第一步：</code> <strong><em>修改 <code>IAccountDao</code> 接口，新加如下方法。</em></strong> 代码如下：</p>
<figure class="highlight diff"><figcaption><span>IAccountDao.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public interface IAccountDao &#123;</span><br><span class="line"></span><br><span class="line">    // 查询所有账户，同时还需要获取到当前账户的所属用户信息</span><br><span class="line">    List&lt;Account&gt; findAll();</span><br><span class="line"></span><br><span class="line"><span class="addition">+   // 根据用户 id 查询账户信息</span></span><br><span class="line"><span class="addition">+   List&lt;Account&gt; findById(Integer id);</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第二步：</code> <strong><em>修改 <code>IUserDao.xml</code> 文件。</em></strong> 修改如下：</p>
<figure class="highlight diff"><figcaption><span>IUserDao.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;resultMap id="userMap" type="user"&gt;</span><br><span class="line">    &lt;id property="id" column="id"&gt;&lt;/id&gt;</span><br><span class="line">    &lt;result property="username" column="username"&gt;&lt;/result&gt;</span><br><span class="line">    &lt;result property="address" column="address"&gt;&lt;/result&gt;</span><br><span class="line">    &lt;result property="sex" column="sex"&gt;&lt;/result&gt;</span><br><span class="line">    &lt;result property="birthday" column="birthday"&gt;&lt;/result&gt;</span><br><span class="line"></span><br><span class="line"><span class="deletion">-   &lt;!-- 配置 一对多 延迟加载 --&gt;</span></span><br><span class="line"><span class="addition">+   &lt;collection property="accounts" ofType="account" select="club.guoshizhan.dao.IAccountDao.findById" column="id"&gt;</span></span><br><span class="line"><span class="deletion">-   &lt;collection property="accounts" ofType="account"&gt;</span></span><br><span class="line"><span class="deletion">-           &lt;id property="id" column="aid"&gt;&lt;/id&gt;</span></span><br><span class="line"><span class="deletion">-           &lt;result property="uid" column="uid"&gt;&lt;/result&gt;</span></span><br><span class="line"><span class="deletion">-           &lt;result property="money" column="money"&gt;&lt;/result&gt;</span></span><br><span class="line">    &lt;/collection&gt;</span><br><span class="line">&lt;/resultMap&gt;</span><br><span class="line"></span><br><span class="line">&lt;select id="findAll" resultMap="userMap"&gt;</span><br><span class="line"><span class="deletion">- SELECT u.*,a.id as aid,a.money,a.uid FROM USER u LEFT OUTER JOIN account a ON a.uid=u.id</span></span><br><span class="line"><span class="addition">+ SELECT * FROM USER</span></span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<p><code>第三步：</code> <strong><em>修改 <code>IAccountDao.xml</code> 文件，加入如下语句。</em></strong> 修改如下：</p>
<figure class="highlight diff"><figcaption><span>IAccountDao.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;resultMap id="accountMap" type="account"&gt;</span><br><span class="line">    &lt;id property="id" column="id"&gt;&lt;/id&gt;</span><br><span class="line">    &lt;result property="uid" column="uid"&gt;&lt;/result&gt;</span><br><span class="line">    &lt;result property="money" column="money"&gt;&lt;/result&gt;</span><br><span class="line"><span class="addition">+   &lt;!-- 配置一对一延迟加载，使用 select 属性指定内容 --&gt;</span></span><br><span class="line"><span class="addition">+   &lt;association property="user" column="uid" javaType="user" select="club.guoshizhan.dao.IUserDao.findById"&gt;</span></span><br><span class="line"><span class="addition">+   &lt;/association&gt;</span></span><br><span class="line">&lt;/resultMap&gt;</span><br><span class="line"></span><br><span class="line"><span class="addition">+ &lt;!-- 根据用户 id 查询账户信息 --&gt;</span></span><br><span class="line"><span class="addition">+ &lt;select id="findById" resultType="account"&gt;</span></span><br><span class="line"><span class="addition">+   SELECT * FROM account where uid=#&#123;uid&#125;</span></span><br><span class="line"><span class="addition">+ &lt;/select&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>第四步：</code> <strong><em>新建 <code>UserTest</code> 测试类。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>UserTest.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.dao.IUserDao;</span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.After;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/6/23 11:03</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Mybatis 测试类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> InputStream in;</span><br><span class="line">    <span class="keyword">private</span> IUserDao userDao;</span><br><span class="line">    <span class="keyword">private</span> SqlSession session;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        in = Resources.getResourceAsStream(<span class="string">"SqlMapConfig.xml"</span>);</span><br><span class="line">        SqlSessionFactory factory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br><span class="line">        session = factory.openSession();</span><br><span class="line">        userDao = session.getMapper(IUserDao<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;User&gt; users = userDao.findAll();</span><br><span class="line">        <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">            System.out.println(<span class="string">"======== 一对多 延迟加载 结果输出 ========"</span>);</span><br><span class="line">            System.out.println(user);</span><br><span class="line">            System.out.println(user.getAccounts());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        session.close();</span><br><span class="line">        in.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><em>执行 <code>testFindAll</code> 方法，</em></strong> 结果如下<strong><em>（注意 SQL 语句）</em></strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">2020-08-27 17:14:33,760 329    [           main] DEBUG .apache.ibatis.io.ResolverUtil  - Checking to see if class club.guoshizhan.dao.IAccountDao matches criteria [is assignable to Object]</span><br><span class="line">2020-08-27 17:14:33,761 330    [           main] DEBUG .apache.ibatis.io.ResolverUtil  - Checking to see if class club.guoshizhan.dao.IUserDao matches criteria [is assignable to Object]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">17</span>:<span class="number">14</span>:<span class="number">33</span>,<span class="number">952</span> <span class="number">521</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Opening JDBC Connection</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">17</span>:<span class="number">14</span>:<span class="number">34</span>,<span class="number">224</span> <span class="number">793</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Setting autocommit to <span class="keyword">false</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">1f</span>bf16f]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">17</span>:<span class="number">14</span>:<span class="number">34</span>,<span class="number">231</span> <span class="number">800</span>    [           main] DEBUG uoshizhan.dao.IUserDao.findAll  - ==&gt;  Preparing: SELECT * FROM USER </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">17</span>:<span class="number">14</span>:<span class="number">34</span>,<span class="number">261</span> <span class="number">830</span>    [           main] DEBUG uoshizhan.dao.IUserDao.findAll  - ==&gt; Parameters: </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">17</span>:<span class="number">14</span>:<span class="number">34</span>,<span class="number">359</span> <span class="number">928</span>    [           main] DEBUG uoshizhan.dao.IUserDao.findAll  - &lt;==      Total: <span class="number">7</span></span><br><span class="line">======== 一对多 延迟加载 结果输出 ========</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">17</span>:<span class="number">14</span>:<span class="number">34</span>,<span class="number">360</span> <span class="number">929</span>    [           main] DEBUG izhan.dao.IAccountDao.findById  - ==&gt;  Preparing: SELECT * FROM account where uid=? </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">17</span>:<span class="number">14</span>:<span class="number">34</span>,<span class="number">360</span> <span class="number">929</span>    [           main] DEBUG izhan.dao.IAccountDao.findById  - ==&gt; Parameters: <span class="number">42</span>(Integer)</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">17</span>:<span class="number">14</span>:<span class="number">34</span>,<span class="number">443</span> <span class="number">1012</span>   [           main] DEBUG izhan.dao.IAccountDao.findById  - &lt;==      Total: <span class="number">0</span></span><br><span class="line">User&#123;id=<span class="number">42</span>, username=<span class="string">'小二王'</span>, birthday=Fri Mar <span class="number">02</span> <span class="number">15</span>:<span class="number">09</span>:<span class="number">37</span> CST <span class="number">2018</span>, sex=<span class="string">'女'</span>, address=<span class="string">'北京金燕龙'</span>&#125;</span><br><span class="line">[]</span><br><span class="line">======== 一对多 延迟加载 结果输出 ========</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">17</span>:<span class="number">14</span>:<span class="number">34</span>,<span class="number">446</span> <span class="number">1015</span>   [           main] DEBUG izhan.dao.IAccountDao.findById  - ==&gt;  Preparing: SELECT * FROM account where uid=? </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">17</span>:<span class="number">14</span>:<span class="number">34</span>,<span class="number">446</span> <span class="number">1015</span>   [           main] DEBUG izhan.dao.IAccountDao.findById  - ==&gt; Parameters: <span class="number">43</span>(Integer)</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">17</span>:<span class="number">14</span>:<span class="number">34</span>,<span class="number">447</span> <span class="number">1016</span>   [           main] DEBUG izhan.dao.IAccountDao.findById  - &lt;==      Total: <span class="number">0</span></span><br><span class="line">User&#123;id=<span class="number">43</span>, username=<span class="string">'大王'</span>, birthday=Tue Nov <span class="number">12</span> <span class="number">10</span>:<span class="number">19</span>:<span class="number">13</span> CST <span class="number">2019</span>, sex=<span class="string">'男'</span>, address=<span class="string">'Los Angeles'</span>&#125;</span><br><span class="line">[]</span><br><span class="line">======== 一对多 延迟加载 结果输出 ========</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">17</span>:<span class="number">14</span>:<span class="number">34</span>,<span class="number">447</span> <span class="number">1016</span>   [           main] DEBUG izhan.dao.IAccountDao.findById  - ==&gt;  Preparing: SELECT * FROM account where uid=? </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">17</span>:<span class="number">14</span>:<span class="number">34</span>,<span class="number">447</span> <span class="number">1016</span>   [           main] DEBUG izhan.dao.IAccountDao.findById  - ==&gt; Parameters: <span class="number">46</span>(Integer)</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">17</span>:<span class="number">14</span>:<span class="number">34</span>,<span class="number">450</span> <span class="number">1019</span>   [           main] DEBUG izhan.dao.IAccountDao.findById  - &lt;==      Total: <span class="number">2</span></span><br><span class="line">User&#123;id=<span class="number">46</span>, username=<span class="string">'老王'</span>, birthday=Wed Mar <span class="number">07</span> <span class="number">17</span>:<span class="number">37</span>:<span class="number">26</span> CST <span class="number">2018</span>, sex=<span class="string">'男'</span>, address=<span class="string">'北京'</span>&#125;</span><br><span class="line">[Account&#123;id=<span class="number">1</span>, uid=<span class="number">46</span>, money=<span class="number">1000.0</span>&#125;, Account&#123;id=<span class="number">3</span>, uid=<span class="number">46</span>, money=<span class="number">2000.0</span>&#125;]</span><br><span class="line">======== 一对多 延迟加载 结果输出 ========</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">17</span>:<span class="number">14</span>:<span class="number">34</span>,<span class="number">451</span> <span class="number">1020</span>   [           main] DEBUG izhan.dao.IAccountDao.findById  - ==&gt;  Preparing: SELECT * FROM account where uid=? </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">17</span>:<span class="number">14</span>:<span class="number">34</span>,<span class="number">451</span> <span class="number">1020</span>   [           main] DEBUG izhan.dao.IAccountDao.findById  - ==&gt; Parameters: <span class="number">49</span>(Integer)</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">17</span>:<span class="number">14</span>:<span class="number">34</span>,<span class="number">452</span> <span class="number">1021</span>   [           main] DEBUG izhan.dao.IAccountDao.findById  - &lt;==      Total: <span class="number">0</span></span><br><span class="line">User&#123;id=<span class="number">49</span>, username=<span class="string">'Jack'</span>, birthday=Mon Oct <span class="number">28</span> <span class="number">09</span>:<span class="number">15</span>:<span class="number">39</span> CST <span class="number">2019</span>, sex=<span class="string">'男'</span>, address=<span class="string">'上海闵行'</span>&#125;</span><br><span class="line">[]</span><br><span class="line">======== 一对多 延迟加载 结果输出 ========</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">17</span>:<span class="number">14</span>:<span class="number">34</span>,<span class="number">452</span> <span class="number">1021</span>   [           main] DEBUG izhan.dao.IAccountDao.findById  - ==&gt;  Preparing: SELECT * FROM account where uid=? </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">17</span>:<span class="number">14</span>:<span class="number">34</span>,<span class="number">452</span> <span class="number">1021</span>   [           main] DEBUG izhan.dao.IAccountDao.findById  - ==&gt; Parameters: <span class="number">51</span>(Integer)</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">17</span>:<span class="number">14</span>:<span class="number">34</span>,<span class="number">453</span> <span class="number">1022</span>   [           main] DEBUG izhan.dao.IAccountDao.findById  - &lt;==      Total: <span class="number">0</span></span><br><span class="line">User&#123;id=<span class="number">51</span>, username=<span class="string">'Lisa'</span>, birthday=Mon Oct <span class="number">28</span> <span class="number">09</span>:<span class="number">17</span>:<span class="number">31</span> CST <span class="number">2019</span>, sex=<span class="string">'女'</span>, address=<span class="string">'广东佛山'</span>&#125;</span><br><span class="line">[]</span><br><span class="line">======== 一对多 延迟加载 结果输出 ========</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">17</span>:<span class="number">14</span>:<span class="number">34</span>,<span class="number">453</span> <span class="number">1022</span>   [           main] DEBUG izhan.dao.IAccountDao.findById  - ==&gt;  Preparing: SELECT * FROM account where uid=? </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">17</span>:<span class="number">14</span>:<span class="number">34</span>,<span class="number">453</span> <span class="number">1022</span>   [           main] DEBUG izhan.dao.IAccountDao.findById  - ==&gt; Parameters: <span class="number">52</span>(Integer)</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">17</span>:<span class="number">14</span>:<span class="number">34</span>,<span class="number">455</span> <span class="number">1024</span>   [           main] DEBUG izhan.dao.IAccountDao.findById  - &lt;==      Total: <span class="number">2</span></span><br><span class="line">User&#123;id=<span class="number">52</span>, username=<span class="string">'Tom'</span>, birthday=Mon Oct <span class="number">28</span> <span class="number">10</span>:<span class="number">26</span>:<span class="number">42</span> CST <span class="number">2019</span>, sex=<span class="string">'男'</span>, address=<span class="string">'广东佛山'</span>&#125;</span><br><span class="line">[Account&#123;id=<span class="number">4</span>, uid=<span class="number">52</span>, money=<span class="number">3000.0</span>&#125;, Account&#123;id=<span class="number">5</span>, uid=<span class="number">52</span>, money=<span class="number">4000.0</span>&#125;]</span><br><span class="line">======== 一对多 延迟加载 结果输出 ========</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">17</span>:<span class="number">14</span>:<span class="number">34</span>,<span class="number">455</span> <span class="number">1024</span>   [           main] DEBUG izhan.dao.IAccountDao.findById  - ==&gt;  Preparing: SELECT * FROM account where uid=? </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">17</span>:<span class="number">14</span>:<span class="number">34</span>,<span class="number">456</span> <span class="number">1025</span>   [           main] DEBUG izhan.dao.IAccountDao.findById  - ==&gt; Parameters: <span class="number">54</span>(Integer)</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">17</span>:<span class="number">14</span>:<span class="number">34</span>,<span class="number">457</span> <span class="number">1026</span>   [           main] DEBUG izhan.dao.IAccountDao.findById  - &lt;==      Total: <span class="number">0</span></span><br><span class="line">User&#123;id=<span class="number">54</span>, username=<span class="string">'Bob'</span>, birthday=Tue Nov <span class="number">12</span> <span class="number">10</span>:<span class="number">21</span>:<span class="number">41</span> CST <span class="number">2019</span>, sex=<span class="string">'男'</span>, address=<span class="string">'广东佛山'</span>&#125;</span><br><span class="line">[]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">17</span>:<span class="number">14</span>:<span class="number">34</span>,<span class="number">458</span> <span class="number">1027</span>   [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Resetting autocommit to <span class="keyword">true</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">1f</span>bf16f]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">27</span> <span class="number">17</span>:<span class="number">14</span>:<span class="number">34</span>,<span class="number">458</span> <span class="number">1027</span>   [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Closing JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">1f</span>bf16f]</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>TIPS：</code> <strong><em>mybatis 的延迟加载</em></strong> 到此结束！！！</p>
</blockquote>
<h2 id="mybatis-的缓存"><a href="#mybatis-的缓存" class="headerlink" title="mybatis 的缓存"></a>mybatis 的缓存</h2><p><code>缓存</code> 是个很重要的东西，英文名叫 <code>Cache</code> 。<strong><em>那么缓存到底是什么呢？往下看：</em></strong></p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ 什么是缓存？</span></span><br><span class="line"><span class="addition">+ 缓存就是存在于内存中的临时数据。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ 为什么要使用缓存？</span></span><br><span class="line"><span class="addition">+ 减少和数据库的交互次数，提高执行效率。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ 什么样的数据能使用缓存，什么样的数据不能使用？</span></span><br><span class="line"><span class="addition">+ 适用于缓存的数据：1、经常查询并且不经常改变的。2、数据的正确与否对最终结果影响不大的。</span></span><br><span class="line"><span class="deletion">- 不适用于缓存的数据：1、经常改变的数据。2、数据的正确与否对最终结果影响很大的数据。例如：商品的库存，银行的汇率，股市的牌价。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span></span><br></pre></td></tr></table></figure>

<p>了解完上述问题之后，<strong><em>我们来了解一下 mybatis 中的 <code>一级缓存</code> 和 <code>二级缓存</code> 。</em></strong> 如下：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ Mybatis 中的一级缓存和二级缓存</span></span><br><span class="line"><span class="addition">+ 一级缓存：它指的是 Mybatis 中 SqlSession 对象的缓存。当我们执行查询之后，查询的结果会同时存入到 SqlSession 为我们提供一块区域中。</span></span><br><span class="line"><span class="addition">+ 该区域的结构是一个 Map 集合。当我们再次查询同样的数据，Mybatis 会先去 SqlSession 中查询是否有，有的话直接拿出来用。</span></span><br><span class="line"><span class="deletion">- 当 SqlSession 对象消失时，Mybatis 的一级缓存也就消失了。</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+ 二级缓存：它指的是 Mybatis 中 SqlSessionFactory 对象的缓存。由同一个 SqlSessionFactory 对象创建的 SqlSession 共享其缓存。</span></span><br><span class="line"><span class="comment">+++ 二级缓存的使用步骤：</span></span><br><span class="line"><span class="addition">+ 第一步：让 Mybatis 框架支持二级缓存（在 SqlMapConfig.xml 中配置）</span></span><br><span class="line"><span class="addition">+ 第二步：让当前的映射文件支持二级缓存（在 IUserDao.xml 中配置）</span></span><br><span class="line"><span class="addition">+ 第三步：让当前的操作支持二级缓存（在 select 标签中配置）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span></span><br></pre></td></tr></table></figure>

<p>现在我们测试一下 <code>一级缓存</code> 。<strong><em>具体操作：把 <code>MybatisTest</code> 类中的 <code>testFindById</code> 方法修改成下列代码：</em></strong></p>
<figure class="highlight java"><figcaption><span>MybatisTest.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 02-根据 id 查询用户</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindById</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    User user = userDao.findById(<span class="number">52</span>);</span><br><span class="line">    System.out.println(user);</span><br><span class="line"></span><br><span class="line">    User user1 = userDao.findById(<span class="number">52</span>);</span><br><span class="line">    System.out.println(user1);</span><br><span class="line"></span><br><span class="line">    System.out.println(user==user1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行 <code>testFindById</code> 方法， 结果如下（<strong><em>关注 user==user1 的结果及 SQL 语句</em></strong>）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">53</span>:<span class="number">49</span>,<span class="number">849</span> <span class="number">212</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Opening JDBC Connection</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">53</span>:<span class="number">50</span>,<span class="number">079</span> <span class="number">442</span>    [           main] DEBUG source.pooled.PooledDataSource  - Created connection <span class="number">9807749</span>.</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">53</span>:<span class="number">50</span>,<span class="number">079</span> <span class="number">442</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Setting autocommit to <span class="keyword">false</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">95</span>a785]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">53</span>:<span class="number">50</span>,<span class="number">084</span> <span class="number">447</span>    [           main] DEBUG oshizhan.dao.IUserDao.findById  - ==&gt;  Preparing: select * from user where id=? </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">53</span>:<span class="number">50</span>,<span class="number">125</span> <span class="number">488</span>    [           main] DEBUG oshizhan.dao.IUserDao.findById  - ==&gt; Parameters: <span class="number">52</span>(Integer)</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">53</span>:<span class="number">50</span>,<span class="number">211</span> <span class="number">574</span>    [           main] DEBUG oshizhan.dao.IUserDao.findById  - &lt;==      Total: <span class="number">1</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">53</span>:<span class="number">50</span>,<span class="number">212</span> <span class="number">575</span>    [           main] DEBUG o.IAccountDao.findAccountByUid  - ==&gt;  Preparing: select * from account where uid = ? </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">53</span>:<span class="number">50</span>,<span class="number">212</span> <span class="number">575</span>    [           main] DEBUG o.IAccountDao.findAccountByUid  - ==&gt; Parameters: <span class="number">52</span>(Integer)</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">53</span>:<span class="number">50</span>,<span class="number">213</span> <span class="number">576</span>    [           main] DEBUG o.IAccountDao.findAccountByUid  - &lt;==      Total: <span class="number">0</span></span><br><span class="line">User&#123;userId=<span class="number">52</span>, userName=<span class="string">'Tom'</span>, userBirthday=Mon Oct <span class="number">28</span> <span class="number">10</span>:<span class="number">26</span>:<span class="number">42</span> CST <span class="number">2019</span>, userSex=<span class="string">'男'</span>, userAddress=<span class="string">'广东佛山'</span>&#125;</span><br><span class="line">User&#123;userId=<span class="number">52</span>, userName=<span class="string">'Tom'</span>, userBirthday=Mon Oct <span class="number">28</span> <span class="number">10</span>:<span class="number">26</span>:<span class="number">42</span> CST <span class="number">2019</span>, userSex=<span class="string">'男'</span>, userAddress=<span class="string">'广东佛山'</span>&#125;</span><br><span class="line"><span class="keyword">true</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">53</span>:<span class="number">50</span>,<span class="number">221</span> <span class="number">584</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Resetting autocommit to <span class="keyword">true</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">95</span>a785]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">53</span>:<span class="number">50</span>,<span class="number">222</span> <span class="number">585</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Closing JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">95</span>a785]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">53</span>:<span class="number">50</span>,<span class="number">222</span> <span class="number">585</span>    [           main] DEBUG source.pooled.PooledDataSource  - Returned connection <span class="number">9807749</span> to pool.</span><br></pre></td></tr></table></figure>

<hr>
<p><strong><em>由上述 user==user1 的结果为 true 可知，mybatis 是使用了 <code>一级缓存</code> 的。这也说明了 mybatis 的一级缓存不需要进行配置，是默认就有的。</em></strong> 那么问题来了，<strong><em>如果我们想要关闭一级缓存，</em></strong> 那该如何去做呢？接着往下看！！！</p>
<hr>
<figure class="highlight java"><figcaption><span>MybatisTest.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 02-根据 id 查询用户</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindById</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    User user = userDao.findById(<span class="number">52</span>);</span><br><span class="line">    System.out.println(user);</span><br><span class="line">    session.close();       <span class="comment">// 关闭 SqlSession 对象，即关闭一级缓存</span></span><br><span class="line"><span class="comment">//    session.clearCache();  // clearCache 也可以实现关闭一级缓存</span></span><br><span class="line"></span><br><span class="line">    session = factory.openSession();    <span class="comment">// 再次获取 SqlSession 对象</span></span><br><span class="line">    userDao = session.getMapper(IUserDao<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    User user1 = userDao.findById(<span class="number">52</span>);</span><br><span class="line">    System.out.println(user1);</span><br><span class="line"></span><br><span class="line">    System.out.println(user==user1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再次执行 <code>testFindById</code> 方法， 结果如下（<strong><em>关注 user==user1 的结果及 SQL 语句</em></strong>）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">26</span> <span class="number">22</span>:<span class="number">20</span>:<span class="number">37</span>,<span class="number">703</span> <span class="number">216</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Opening JDBC Connection</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">26</span> <span class="number">22</span>:<span class="number">20</span>:<span class="number">38</span>,<span class="number">040</span> <span class="number">553</span>    [           main] DEBUG source.pooled.PooledDataSource  - Created connection <span class="number">5257320</span>.</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">26</span> <span class="number">22</span>:<span class="number">20</span>:<span class="number">38</span>,<span class="number">040</span> <span class="number">553</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Setting autocommit to <span class="keyword">false</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">503868</span>]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">26</span> <span class="number">22</span>:<span class="number">20</span>:<span class="number">38</span>,<span class="number">043</span> <span class="number">556</span>    [           main] DEBUG oshizhan.dao.IUserDao.findById  - ==&gt;  Preparing: select * from user where id=? </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">26</span> <span class="number">22</span>:<span class="number">20</span>:<span class="number">38</span>,<span class="number">070</span> <span class="number">583</span>    [           main] DEBUG oshizhan.dao.IUserDao.findById  - ==&gt; Parameters: <span class="number">52</span>(Integer)</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">26</span> <span class="number">22</span>:<span class="number">20</span>:<span class="number">38</span>,<span class="number">090</span> <span class="number">603</span>    [           main] DEBUG oshizhan.dao.IUserDao.findById  - &lt;==      Total: <span class="number">1</span></span><br><span class="line">User&#123;Id=<span class="number">52</span>, username=<span class="string">'Tom'</span>, birthday=Mon Oct <span class="number">28</span> <span class="number">10</span>:<span class="number">26</span>:<span class="number">42</span> CST <span class="number">2019</span>, sex=<span class="string">'男'</span>, address=<span class="string">'广东佛山'</span>&#125;</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">26</span> <span class="number">22</span>:<span class="number">20</span>:<span class="number">38</span>,<span class="number">099</span> <span class="number">612</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Resetting autocommit to <span class="keyword">true</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">503868</span>]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">26</span> <span class="number">22</span>:<span class="number">20</span>:<span class="number">38</span>,<span class="number">099</span> <span class="number">612</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Closing JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">503868</span>]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">26</span> <span class="number">22</span>:<span class="number">20</span>:<span class="number">38</span>,<span class="number">099</span> <span class="number">612</span>    [           main] DEBUG source.pooled.PooledDataSource  - Returned connection <span class="number">5257320</span> to pool.</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">26</span> <span class="number">22</span>:<span class="number">20</span>:<span class="number">38</span>,<span class="number">099</span> <span class="number">612</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Opening JDBC Connection</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">26</span> <span class="number">22</span>:<span class="number">20</span>:<span class="number">38</span>,<span class="number">099</span> <span class="number">612</span>    [           main] DEBUG source.pooled.PooledDataSource  - Checked out connection <span class="number">5257320</span> from pool.</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">26</span> <span class="number">22</span>:<span class="number">20</span>:<span class="number">38</span>,<span class="number">100</span> <span class="number">613</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Setting autocommit to <span class="keyword">false</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">503868</span>]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">26</span> <span class="number">22</span>:<span class="number">20</span>:<span class="number">38</span>,<span class="number">100</span> <span class="number">613</span>    [           main] DEBUG oshizhan.dao.IUserDao.findById  - ==&gt;  Preparing: select * from user where id=? </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">26</span> <span class="number">22</span>:<span class="number">20</span>:<span class="number">38</span>,<span class="number">100</span> <span class="number">613</span>    [           main] DEBUG oshizhan.dao.IUserDao.findById  - ==&gt; Parameters: <span class="number">52</span>(Integer)</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">26</span> <span class="number">22</span>:<span class="number">20</span>:<span class="number">38</span>,<span class="number">101</span> <span class="number">614</span>    [           main] DEBUG oshizhan.dao.IUserDao.findById  - &lt;==      Total: <span class="number">1</span></span><br><span class="line">User&#123;Id=<span class="number">52</span>, username=<span class="string">'Tom'</span>, birthday=Mon Oct <span class="number">28</span> <span class="number">10</span>:<span class="number">26</span>:<span class="number">42</span> CST <span class="number">2019</span>, sex=<span class="string">'男'</span>, address=<span class="string">'广东佛山'</span>&#125;</span><br><span class="line"><span class="keyword">false</span></span><br></pre></td></tr></table></figure>

<p>从结果可知，<strong><em>我们已经实现了一级缓存的关闭操作（从结果为 false ，且进行了两次查询操作可得知）。</em></strong> 关闭一级缓存所使用的方法是 <code>close()</code> 和 <code>clearCache()</code> 方法，任选其一即可实现操作。</p>
<hr>
<p>上述一级缓存搞定了，<strong><em>那么如果一级缓存中的数据和数据库的数据不一致了，那么如何实现数据同步呢？</em></strong> 先看如下代码，猜一猜执行的结果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindById</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 01-第一次执行查询操作</span></span><br><span class="line">    User user = userDao.findById(<span class="number">52</span>);</span><br><span class="line">    System.out.println(user);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 02-执行一次更新操作</span></span><br><span class="line">    user.setUsername(<span class="string">"Tom"</span>);    <span class="comment">// 此处更新了数据，会导致一级缓存中的数据和数据库的数据不同步</span></span><br><span class="line">    userDao.updateUser(user);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 03-再次执行查询操作</span></span><br><span class="line">    User user1 = userDao.findById(<span class="number">52</span>);</span><br><span class="line">    System.out.println(user1);</span><br><span class="line"></span><br><span class="line">    System.out.println(user==user1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上述代码执行结果如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">26</span> <span class="number">22</span>:<span class="number">38</span>:<span class="number">23</span>,<span class="number">855</span> <span class="number">220</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Opening JDBC Connection</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">26</span> <span class="number">22</span>:<span class="number">38</span>:<span class="number">24</span>,<span class="number">093</span> <span class="number">458</span>    [           main] DEBUG source.pooled.PooledDataSource  - Created connection <span class="number">24129702</span>.</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">26</span> <span class="number">22</span>:<span class="number">38</span>:<span class="number">24</span>,<span class="number">093</span> <span class="number">458</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Setting autocommit to <span class="keyword">false</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">17030</span>a6]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">26</span> <span class="number">22</span>:<span class="number">38</span>:<span class="number">24</span>,<span class="number">096</span> <span class="number">461</span>    [           main] DEBUG oshizhan.dao.IUserDao.findById  - ==&gt;  Preparing: select * from user where id=? </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">26</span> <span class="number">22</span>:<span class="number">38</span>:<span class="number">24</span>,<span class="number">126</span> <span class="number">491</span>    [           main] DEBUG oshizhan.dao.IUserDao.findById  - ==&gt; Parameters: <span class="number">52</span>(Integer)</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">26</span> <span class="number">22</span>:<span class="number">38</span>:<span class="number">24</span>,<span class="number">149</span> <span class="number">514</span>    [           main] DEBUG oshizhan.dao.IUserDao.findById  - &lt;==      Total: <span class="number">1</span></span><br><span class="line">User&#123;Id=<span class="number">52</span>, username=<span class="string">'Jack'</span>, birthday=Mon Oct <span class="number">28</span> <span class="number">10</span>:<span class="number">26</span>:<span class="number">42</span> CST <span class="number">2019</span>, sex=<span class="string">'男'</span>, address=<span class="string">'广东佛山'</span>&#125;</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">26</span> <span class="number">22</span>:<span class="number">38</span>:<span class="number">24</span>,<span class="number">155</span> <span class="number">520</span>    [           main] DEBUG hizhan.dao.IUserDao.updateUser  - ==&gt;  Preparing: update user set username=? where id=? </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">26</span> <span class="number">22</span>:<span class="number">38</span>:<span class="number">24</span>,<span class="number">156</span> <span class="number">521</span>    [           main] DEBUG hizhan.dao.IUserDao.updateUser  - ==&gt; Parameters: Tom(String), <span class="number">52</span>(Integer)</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">26</span> <span class="number">22</span>:<span class="number">38</span>:<span class="number">24</span>,<span class="number">156</span> <span class="number">521</span>    [           main] DEBUG hizhan.dao.IUserDao.updateUser  - &lt;==    Updates: <span class="number">1</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">26</span> <span class="number">22</span>:<span class="number">38</span>:<span class="number">24</span>,<span class="number">157</span> <span class="number">522</span>    [           main] DEBUG oshizhan.dao.IUserDao.findById  - ==&gt;  Preparing: select * from user where id=? </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">26</span> <span class="number">22</span>:<span class="number">38</span>:<span class="number">24</span>,<span class="number">157</span> <span class="number">522</span>    [           main] DEBUG oshizhan.dao.IUserDao.findById  - ==&gt; Parameters: <span class="number">52</span>(Integer)</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">26</span> <span class="number">22</span>:<span class="number">38</span>:<span class="number">24</span>,<span class="number">158</span> <span class="number">523</span>    [           main] DEBUG oshizhan.dao.IUserDao.findById  - &lt;==      Total: <span class="number">1</span></span><br><span class="line">User&#123;Id=<span class="number">52</span>, username=<span class="string">'Tom'</span>, birthday=Mon Oct <span class="number">28</span> <span class="number">10</span>:<span class="number">26</span>:<span class="number">42</span> CST <span class="number">2019</span>, sex=<span class="string">'男'</span>, address=<span class="string">'广东佛山'</span>&#125;</span><br><span class="line"><span class="keyword">false</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">26</span> <span class="number">22</span>:<span class="number">38</span>:<span class="number">24</span>,<span class="number">158</span> <span class="number">523</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Committing JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">17030</span>a6]</span><br></pre></td></tr></table></figure>

<hr>
<p>由结果可知：<strong><em>如果数据发生了更新，那么再次发起查询，mybatis 就不会从一级缓存中取，而是去重新查询数据库。</em></strong> 其实，<strong><em>当我们去调用 SqlSession 的 <code>修改、删除、添加、close()、commit()</code> 等方法时，就会清空一级缓存。</em></strong> 所以，更新数据后，一级缓存仍然可以和数据库实现同步。</p>
<hr>
<p>现在，我们去开启 <code>二级缓存</code>（二级缓存的介绍及相关步骤上面已经讲过了） 。<strong><em>具体步骤：<code>第一步：</code> 在主配置文件 <code>SqlMapConfig.xml</code> 中</em></strong> 加入如下代码（其实下列代码可加可不加，因为 mybatis 的默认配置就是 true，所以可不加，加了也没有关系）：</p>
<figure class="highlight diff"><figcaption><span>SqlMapConfig.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;configuration&gt;</span><br><span class="line"></span><br><span class="line"><span class="addition">+    &lt;!-- 配置开启二级缓存 --&gt;</span></span><br><span class="line"><span class="addition">+    &lt;settings&gt;</span></span><br><span class="line"><span class="addition">+        &lt;setting name="cacheEnabled" value="true"/&gt;</span></span><br><span class="line"><span class="addition">+    &lt;/settings&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong><em><code>第二步：</code> 在 <code>IUserDao.xml</code> 文件中加入如下配置。（表示开启二级缓存）</em></strong> 代码如下：</p>
<figure class="highlight diff"><figcaption><span>IUserDao.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;mapper namespace="club.guoshizhan.dao.IUserDao"&gt;</span><br><span class="line"></span><br><span class="line"><span class="addition">+   &lt;!-- 开启 user 支持二级缓存 --&gt;</span></span><br><span class="line"><span class="addition">+   &lt;cache/&gt;</span></span><br><span class="line"><span class="addition">+   &lt;!-- 在 select 标签上加上 userCache="true" 表示 select 查询语句支持二级缓存 --&gt;</span></span><br><span class="line"><span class="addition">+   &lt;select id="findById" parameterType="Integer" resultType="club.guoshizhan.domain.User" useCache="true"&gt;</span></span><br><span class="line">        select * from user where id=#&#123;id&#125;</span><br><span class="line">    &lt;/select&gt;</span><br></pre></td></tr></table></figure>

<p><strong><em><code>第三步：</code> 在测试类中加入如下测试方法，用于测试二级缓存。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>MybatisTest.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 测试二级缓存</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSecondLevelCache</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    SqlSession session = factory.openSession();</span><br><span class="line">    IUserDao userDao = session.getMapper(IUserDao<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    User user = userDao.findById(<span class="number">52</span>);</span><br><span class="line">    System.out.println(user);</span><br><span class="line">    session.close();    <span class="comment">// 关闭一级缓存</span></span><br><span class="line"></span><br><span class="line">    SqlSession session1 = factory.openSession();    <span class="comment">// 再次打开一个名为 session1 的 SqlSession 对象</span></span><br><span class="line">    IUserDao userDao1 = session1.getMapper(IUserDao<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    User user1 = userDao1.findById(<span class="number">52</span>);</span><br><span class="line">    System.out.println(user1);</span><br><span class="line">    session1.close();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><em>执行 <code>testSecondLevelCache</code> 方法，</em></strong> 结果如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">26</span> <span class="number">23</span>:<span class="number">06</span>:<span class="number">20</span>,<span class="number">961</span> <span class="number">208</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Opening JDBC Connection</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">26</span> <span class="number">23</span>:<span class="number">06</span>:<span class="number">21</span>,<span class="number">200</span> <span class="number">447</span>    [           main] DEBUG source.pooled.PooledDataSource  - Created connection <span class="number">23649725</span>.</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">26</span> <span class="number">23</span>:<span class="number">06</span>:<span class="number">21</span>,<span class="number">200</span> <span class="number">447</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Setting autocommit to <span class="keyword">false</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">168</span>ddbd]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">26</span> <span class="number">23</span>:<span class="number">06</span>:<span class="number">21</span>,<span class="number">203</span> <span class="number">450</span>    [           main] DEBUG oshizhan.dao.IUserDao.findById  - ==&gt;  Preparing: select * from user where id=? </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">26</span> <span class="number">23</span>:<span class="number">06</span>:<span class="number">21</span>,<span class="number">235</span> <span class="number">482</span>    [           main] DEBUG oshizhan.dao.IUserDao.findById  - ==&gt; Parameters: <span class="number">52</span>(Integer)</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">26</span> <span class="number">23</span>:<span class="number">06</span>:<span class="number">21</span>,<span class="number">259</span> <span class="number">506</span>    [           main] DEBUG oshizhan.dao.IUserDao.findById  - &lt;==      Total: <span class="number">1</span></span><br><span class="line">User&#123;Id=<span class="number">52</span>, username=<span class="string">'Tom'</span>, birthday=Mon Oct <span class="number">28</span> <span class="number">10</span>:<span class="number">26</span>:<span class="number">42</span> CST <span class="number">2019</span>, sex=<span class="string">'男'</span>, address=<span class="string">'广东佛山'</span>&#125;</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">26</span> <span class="number">23</span>:<span class="number">06</span>:<span class="number">21</span>,<span class="number">273</span> <span class="number">520</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Resetting autocommit to <span class="keyword">true</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">168</span>ddbd]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">26</span> <span class="number">23</span>:<span class="number">06</span>:<span class="number">21</span>,<span class="number">275</span> <span class="number">522</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Closing JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">168</span>ddbd]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">26</span> <span class="number">23</span>:<span class="number">06</span>:<span class="number">21</span>,<span class="number">276</span> <span class="number">523</span>    [           main] DEBUG source.pooled.PooledDataSource  - Returned connection <span class="number">23649725</span> to pool.</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">26</span> <span class="number">23</span>:<span class="number">06</span>:<span class="number">21</span>,<span class="number">278</span> <span class="number">525</span>    [           main] DEBUG   club.guoshizhan.dao.IUserDao  - Cache Hit Ratio [club.guoshizhan.dao.IUserDao]: <span class="number">0.5</span></span><br><span class="line">User&#123;Id=<span class="number">52</span>, username=<span class="string">'Tom'</span>, birthday=Mon Oct <span class="number">28</span> <span class="number">10</span>:<span class="number">26</span>:<span class="number">42</span> CST <span class="number">2019</span>, sex=<span class="string">'男'</span>, address=<span class="string">'广东佛山'</span>&#125;</span><br></pre></td></tr></table></figure>

<p>由结果可知，<strong><em>mybatis 只发起了一次查询，由于一级缓存已经关闭了，所以第二次则是通过 <code>二级缓存</code> 查到的数据。</em></strong></p>
<blockquote>
<p><code>TIPS：</code> <strong><em>mybatis 的缓存</em></strong> 到此结束！！！</p>
</blockquote>
<h1 id="mybatis-注解开发"><a href="#mybatis-注解开发" class="headerlink" title="mybatis 注解开发"></a>mybatis 注解开发</h1><h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><hr>
<p><strong><em>mybatis 注解开发的 <code>环境搭建</code> 过程上述已经做过了，所以此处跳过。</em></strong> 详情请参考： <a href="#mybatis-注解案例">mybatis 注解案例</a></p>
<blockquote>
<p><code>注意：</code> <strong><em>使用注解的时候，不要把接口的 xml 文件也加上，</em></strong> 否则会报错。（<strong><em>哪怕你没有使用接口的 xml 文件，它也会报错</em></strong>）<br><code>解决方法：</code> <strong><em>把接口的 xml 文件移动到不相干的目录，或者直接删除，</em></strong> 这样就不会报错了。</p>
</blockquote>
<hr>
<h2 id="单表-CRUD-操作"><a href="#单表-CRUD-操作" class="headerlink" title="单表 CRUD 操作"></a>单表 CRUD 操作</h2><p><code>CRUD</code> <strong><em>操作已经写过很多次了，基本步骤也就是那样。</em></strong> 所以，这里就不把每一个操作都一步一步的写，<strong><em>而是写一个整体的过程。</em></strong> 如果需要知道一步一步的操作，请参考： <a href="#mybatis-的单表操作">mybatis 的单表操作</a> 。<code>注意：</code> <strong><em>注解开发比 xml 配置更简单哦！！！</em></strong></p>
<hr>
<p><code>第一步：</code> <strong><em>编写 IUserDao 接口，里面定义各种单表操作的方法（注解就是在这个地方使用的）。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>IUserDao.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Delete;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Insert;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Update;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/6/22 23:53</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 用户持久层接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUserDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 01-查询所有用户</span></span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">"select * from user"</span>)</span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 02-保存用户</span></span><br><span class="line">    <span class="meta">@Insert</span>(<span class="string">"insert into user(username,birthday,sex,address) values (#&#123;username&#125;,#&#123;birthday&#125;,#&#123;sex&#125;,#&#123;address&#125;)"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">saveUser</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 03-更新用户</span></span><br><span class="line">    <span class="meta">@Update</span>(<span class="string">"update user set username=#&#123;username&#125;,birthday=#&#123;birthday&#125;,sex=#&#123;sex&#125;,address=#&#123;address&#125; where id=#&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">updateUser</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 04-删除用户</span></span><br><span class="line">    <span class="meta">@Delete</span>(<span class="string">"delete from user where id=#&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteUser</span><span class="params">(Integer id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 05-根据 id 查询用户</span></span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">"select * from user where id=#&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function">User <span class="title">findById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 06-根据用户名称模糊查询</span></span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">"select * from user where username like #&#123;username&#125;"</span>)</span><br><span class="line">    <span class="comment">/* @Select("select * from user where username like '%$&#123;value&#125;%'") */</span></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findByName</span><span class="params">(String username)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 07-查询总用户数</span></span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">"select count(id) from user"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">findTotal</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第二步：</code> <strong><em>编写 MybatisTest 测试类进行测试。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>MybatisTest.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.dao.IUserDao;</span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.After;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/6/23 11:03</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Mybatis 测试类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> InputStream in;</span><br><span class="line">    <span class="keyword">private</span> IUserDao userDao;</span><br><span class="line">    <span class="keyword">private</span> SqlSession session;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试方法执行之前执行，用于一些初始化的操作，不理解的应该去看看单元测试相关知识</span></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        in = Resources.getResourceAsStream(<span class="string">"SqlMapConfig.xml"</span>);</span><br><span class="line">        SqlSessionFactory factory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br><span class="line">        session = factory.openSession();</span><br><span class="line">        userDao = session.getMapper(IUserDao<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 01-查询所有用户</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;User&gt; users = userDao.findAll();</span><br><span class="line">        <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 02-保存用户</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSave</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setUsername(<span class="string">"Miracle"</span>);</span><br><span class="line">        user.setBirthday(<span class="keyword">new</span> Date());</span><br><span class="line">        user.setSex(<span class="string">"女"</span>);</span><br><span class="line">        user.setAddress(<span class="string">"Los Angeles"</span>);</span><br><span class="line">        userDao.saveUser(user);</span><br><span class="line">        <span class="comment">/* 记得在 destroy 方法里提交事务，否则保存不成功 */</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 03-更新用户</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setId(<span class="number">74</span>);</span><br><span class="line">        user.setUsername(<span class="string">"Miracle"</span>);</span><br><span class="line">        user.setBirthday(<span class="keyword">new</span> Date());</span><br><span class="line">        user.setSex(<span class="string">"女"</span>);</span><br><span class="line">        user.setAddress(<span class="string">"Washington"</span>);</span><br><span class="line">        userDao.updateUser(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 04-删除用户</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDelete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        userDao.deleteUser(<span class="number">74</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 05-根据 id 查询用户</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindById</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user = userDao.findById(<span class="number">52</span>);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 06-根据用户名称模糊查询</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindByName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String username = <span class="string">"%王%"</span>;</span><br><span class="line">        List&lt;User&gt; users = userDao.findByName(username);</span><br><span class="line">        <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 07-查询总用户数</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindTotal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> total = userDao.findTotal();</span><br><span class="line">        System.out.println(<span class="string">"===================== total："</span> + total + <span class="string">" ====================="</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试方法执行之后执行，用于释放资源，不理解的应该去看看单元测试相关知识</span></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        session.commit();</span><br><span class="line">        session.close();</span><br><span class="line">        in.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>TIPS：</code> 执行上述的任意一个测试方法，即可实现相应的功能。 <strong><em>但是还存在一些问题，接着往下看！！！</em></strong> </p>
</blockquote>
<hr>
<p>上述操作虽然成功，但是我们还需要来解决一个问题：<strong><em>如果 User 实体类属性和数据库字段不一致，会有什么后果呢？</em></strong> 这个问题在原先讲到过，也使用 xml 的方式解决了这个问题。<strong><em>但是现在是使用注解开发，那么如何解决这个问题呢？</em></strong> 带着这个问题，继续往下看！！！</p>
<hr>
<p><code>第一步：</code> <strong><em>修改 <code>User</code> 类，故意把它的属性设置的和数据库字段不一致。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>User.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/6/22 23:52</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: User 实体类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Integer userId;</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="keyword">private</span> Date userBirthday;</span><br><span class="line">    <span class="keyword">private</span> String userSex;</span><br><span class="line">    <span class="keyword">private</span> String userAddress;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getUserId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserId</span><span class="params">(Integer userId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userId = userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserName</span><span class="params">(String userName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userName = userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getUserBirthday</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userBirthday;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserBirthday</span><span class="params">(Date userBirthday)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userBirthday = userBirthday;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserSex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userSex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserSex</span><span class="params">(String userSex)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userSex = userSex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userAddress;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserAddress</span><span class="params">(String userAddress)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userAddress = userAddress;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"User&#123;"</span> +</span><br><span class="line">                <span class="string">"userId="</span> + userId +</span><br><span class="line">                <span class="string">", userName='"</span> + userName + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", userBirthday="</span> + userBirthday +</span><br><span class="line">                <span class="string">", userSex='"</span> + userSex + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", userAddress='"</span> + userAddress + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第二步：</code> <strong><em>为了解决实体类属性和数据库字段不一致的问题，我们需要修改 <code>IUserDao</code> 接口（解决方式见注释）。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>IUserDao.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Result;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.ResultMap;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Results;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/6/22 23:53</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 用户持久层接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUserDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 01-查询所有用户</span></span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">"select * from user"</span>)</span><br><span class="line">    <span class="comment">// 我们使用 @Results 注解来解决实体类属性和数据库字段不一致导致的封装无效问题</span></span><br><span class="line">    <span class="comment">// 此处的 id 属性是一个唯一标识，相当于 resultMap 中的 id 属性。目的是此处定义好的配置可以在其他的方法上使用</span></span><br><span class="line">    <span class="meta">@Results</span>(id = <span class="string">"userMap"</span>, value = &#123;</span><br><span class="line">            <span class="comment">// 以下的 id = true 表示 id 是主键</span></span><br><span class="line">            <span class="meta">@Result</span>(id = <span class="keyword">true</span>, property = <span class="string">"userId"</span>, column = <span class="string">"id"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(property = <span class="string">"userName"</span>, column = <span class="string">"username"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(property = <span class="string">"userAddress"</span>, column = <span class="string">"address"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(property = <span class="string">"userSex"</span>, column = <span class="string">"sex"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(property = <span class="string">"userBirthday"</span>, column = <span class="string">"birthday"</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 02-根据 id 查询用户</span></span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">"select * from user where id=#&#123;id&#125;"</span>)</span><br><span class="line">    <span class="meta">@ResultMap</span>(value = &#123;<span class="string">"userMap"</span>&#125;)</span><br><span class="line">    <span class="comment">// 此处使用了上述定义好的属性映射关系</span></span><br><span class="line">    <span class="function">User <span class="title">findById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 03-根据用户名称模糊查询</span></span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">"select * from user where username like #&#123;username&#125;"</span>)</span><br><span class="line">    <span class="meta">@ResultMap</span>(<span class="string">"userMap"</span>)</span><br><span class="line">    <span class="comment">/* @Select("select * from user where username like '%$&#123;value&#125;%'") */</span></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findByName</span><span class="params">(String username)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第三步：</code> <strong><em>编写测试类进行进行测试。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>MybatisTest.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.dao.IUserDao;</span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.After;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/6/23 11:03</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Mybatis 测试类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> InputStream in;</span><br><span class="line">    <span class="keyword">private</span> IUserDao userDao;</span><br><span class="line">    <span class="keyword">private</span> SqlSession session;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试方法执行之前执行，用于一些初始化的操作，不理解的应该去看看单元测试相关知识</span></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        in = Resources.getResourceAsStream(<span class="string">"SqlMapConfig.xml"</span>);</span><br><span class="line">        SqlSessionFactory factory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br><span class="line">        session = factory.openSession();</span><br><span class="line">        userDao = session.getMapper(IUserDao<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 01-查询所有用户</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;User&gt; users = userDao.findAll();</span><br><span class="line">        <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 02-根据 id 查询用户</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindById</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user = userDao.findById(<span class="number">52</span>);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 03-根据用户名称模糊查询</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindByName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String username = <span class="string">"%王%"</span>;</span><br><span class="line">        List&lt;User&gt; users = userDao.findByName(username);</span><br><span class="line">        <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试方法执行之后执行，用于释放资源，不理解的应该去看看单元测试相关知识</span></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        session.commit();</span><br><span class="line">        session.close();</span><br><span class="line">        in.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><em>执行上述的任何一个方法，都是没有问题的，即都可以封装成功，每一个属性都是有值的。</em></strong> 但是，如果不加 <code>@Results 注解</code> 的那段相关配置，那么执行任何方法，都是无法完成封装的。<strong><em>我们以 <code>testFindAll</code> 方法为例，执行这个方法，结果如下（只有 username 能够封装成功，其余都为 null）：</em></strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">11</span>:<span class="number">22</span>:<span class="number">37</span>,<span class="number">059</span> <span class="number">172</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Opening JDBC Connection</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">11</span>:<span class="number">22</span>:<span class="number">37</span>,<span class="number">308</span> <span class="number">421</span>    [           main] DEBUG source.pooled.PooledDataSource  - Created connection <span class="number">23465806</span>.</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">11</span>:<span class="number">22</span>:<span class="number">37</span>,<span class="number">309</span> <span class="number">422</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Setting autocommit to <span class="keyword">false</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">1660f</span>4e]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">11</span>:<span class="number">22</span>:<span class="number">37</span>,<span class="number">312</span> <span class="number">425</span>    [           main] DEBUG uoshizhan.dao.IUserDao.findAll  - ==&gt;  Preparing: select * from user </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">11</span>:<span class="number">22</span>:<span class="number">37</span>,<span class="number">340</span> <span class="number">453</span>    [           main] DEBUG uoshizhan.dao.IUserDao.findAll  - ==&gt; Parameters: </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">11</span>:<span class="number">22</span>:<span class="number">37</span>,<span class="number">357</span> <span class="number">470</span>    [           main] DEBUG uoshizhan.dao.IUserDao.findAll  - &lt;==      Total: <span class="number">7</span></span><br><span class="line">User&#123;userId=<span class="keyword">null</span>, userName=<span class="string">'小二王'</span>, userBirthday=<span class="keyword">null</span>, userSex=<span class="string">'null'</span>, userAddress=<span class="string">'null'</span>&#125;</span><br><span class="line">User&#123;userId=<span class="keyword">null</span>, userName=<span class="string">'大王'</span>, userBirthday=<span class="keyword">null</span>, userSex=<span class="string">'null'</span>, userAddress=<span class="string">'null'</span>&#125;</span><br><span class="line">User&#123;userId=<span class="keyword">null</span>, userName=<span class="string">'老王'</span>, userBirthday=<span class="keyword">null</span>, userSex=<span class="string">'null'</span>, userAddress=<span class="string">'null'</span>&#125;</span><br><span class="line">User&#123;userId=<span class="keyword">null</span>, userName=<span class="string">'Jack'</span>, userBirthday=<span class="keyword">null</span>, userSex=<span class="string">'null'</span>, userAddress=<span class="string">'null'</span>&#125;</span><br><span class="line">User&#123;userId=<span class="keyword">null</span>, userName=<span class="string">'Lisa'</span>, userBirthday=<span class="keyword">null</span>, userSex=<span class="string">'null'</span>, userAddress=<span class="string">'null'</span>&#125;</span><br><span class="line">User&#123;userId=<span class="keyword">null</span>, userName=<span class="string">'Tom'</span>, userBirthday=<span class="keyword">null</span>, userSex=<span class="string">'null'</span>, userAddress=<span class="string">'null'</span>&#125;</span><br><span class="line">User&#123;userId=<span class="keyword">null</span>, userName=<span class="string">'Bob'</span>, userBirthday=<span class="keyword">null</span>, userSex=<span class="string">'null'</span>, userAddress=<span class="string">'null'</span>&#125;</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">11</span>:<span class="number">22</span>:<span class="number">37</span>,<span class="number">358</span> <span class="number">471</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Resetting autocommit to <span class="keyword">true</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">1660f</span>4e]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">11</span>:<span class="number">22</span>:<span class="number">37</span>,<span class="number">358</span> <span class="number">471</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Closing JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">1660f</span>4e]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">11</span>:<span class="number">22</span>:<span class="number">37</span>,<span class="number">359</span> <span class="number">472</span>    [           main] DEBUG source.pooled.PooledDataSource  - Returned connection <span class="number">23465806</span> to pool.</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>TIPS：</code> <strong><em>单表 CRUD 操作</em></strong> 到此结束！！！</p>
</blockquote>
<h2 id="多表查询操作"><a href="#多表查询操作" class="headerlink" title="多表查询操作"></a>多表查询操作</h2><h3 id="一对一操作"><a href="#一对一操作" class="headerlink" title="一对一操作"></a>一对一操作</h3><p><strong><em>在 xml 配置中讲过了这部分，</em></strong> 所以这里只是简述一下。<code>第一步：</code> <strong><em>在 <code>domain</code> 包下新建 <code>Account</code> 实体类。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>Account.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/8/24 10:59</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Account 类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Account</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> Integer uid;</span><br><span class="line">    <span class="keyword">private</span> Double money;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 多对一（mybatis 中称之为一对一）的映射：一个账户只能属于一个用户</span></span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.user = user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getUid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> uid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUid</span><span class="params">(Integer uid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.uid = uid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Double <span class="title">getMoney</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> money;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMoney</span><span class="params">(Double money)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.money = money;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Account&#123;"</span> +</span><br><span class="line">                <span class="string">"id="</span> + id +</span><br><span class="line">                <span class="string">", uid="</span> + uid +</span><br><span class="line">                <span class="string">", money="</span> + money +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第二步：</code> <strong><em>在 <code>dao</code> 包下新建 <code>IAccountDao</code> 接口，注解也就在这个地方使用。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>IAccountDao.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.Account;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.One;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Result;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Results;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.mapping.FetchType;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/8/24 11:07</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Account 的 dao 接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IAccountDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有账户，并且获取每个账户所属的用户信息</span></span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">"select * from account"</span>)</span><br><span class="line">    <span class="meta">@Results</span>(id = <span class="string">"accountMap"</span>, value = &#123;</span><br><span class="line">            <span class="meta">@Result</span>(id = <span class="keyword">true</span>, property = <span class="string">"id"</span>, column = <span class="string">"id"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(property = <span class="string">"uid"</span>, column = <span class="string">"uid"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(property = <span class="string">"money"</span>, column = <span class="string">"money"</span>),</span><br><span class="line">            <span class="comment">// one 表示一对一里面的 select 属性表示对应方法的全限定类名，fetchType 表示加载时机：立即加载、延迟加载或者默认</span></span><br><span class="line">            <span class="meta">@Result</span>(property = <span class="string">"user"</span>, column = <span class="string">"uid"</span>,one = <span class="meta">@One</span>(select = <span class="string">"club.guoshizhan.dao.IUserDao.findById"</span>,fetchType = FetchType.EAGER))</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="function">List&lt;Account&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第三步：</code> <strong><em>在 <code>SqlMapConfig</code> 主配置文件中添加一行配置，让框架能够扫描到 <code>IAccountDao</code> 接口。</em></strong> 代码如下：</p>
<figure class="highlight diff"><figcaption><span>SqlMapConfig.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;mappers&gt;</span><br><span class="line">    &lt;mapper class="club.guoshizhan.dao.IUserDao"/&gt;</span><br><span class="line"><span class="addition">+    &lt;mapper class="club.guoshizhan.dao.IAccountDao"/&gt;</span></span><br><span class="line">&lt;/mappers&gt;</span><br></pre></td></tr></table></figure>

<p><code>第四步：</code> <strong><em>编写 <code>AccountTest</code> 测试类进行测试。</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>AccountTest.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.dao.IAccountDao;</span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.Account;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.After;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/6/23 11:03</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Mybatis 测试类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> InputStream in;</span><br><span class="line">    <span class="keyword">private</span> IAccountDao accountDao;</span><br><span class="line">    <span class="keyword">private</span> SqlSession session;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        in = Resources.getResourceAsStream(<span class="string">"SqlMapConfig.xml"</span>);</span><br><span class="line">        SqlSessionFactory factory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br><span class="line">        session = factory.openSession();</span><br><span class="line">        accountDao = session.getMapper(IAccountDao<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有用户</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;Account&gt; accounts = accountDao.findAll();</span><br><span class="line">        <span class="keyword">for</span> (Account account : accounts) &#123;</span><br><span class="line">            System.out.println(<span class="string">"======== 一对一表结构结果输出 ========"</span>);</span><br><span class="line">            System.out.println(account);</span><br><span class="line">            System.out.println(account.getUser());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        session.close();</span><br><span class="line">        in.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><em>执行上述 <code>testFindAll</code> 方法，</em></strong> 结果如下<strong><em>（注意 SQL 语句）</em></strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">08</span>:<span class="number">07</span>,<span class="number">647</span> <span class="number">188</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Opening JDBC Connection</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">08</span>:<span class="number">07</span>,<span class="number">905</span> <span class="number">446</span>    [           main] DEBUG source.pooled.PooledDataSource  - Created connection <span class="number">24030126</span>.</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">08</span>:<span class="number">07</span>,<span class="number">906</span> <span class="number">447</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Setting autocommit to <span class="keyword">false</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">16</span>eabae]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">08</span>:<span class="number">07</span>,<span class="number">909</span> <span class="number">450</span>    [           main] DEBUG hizhan.dao.IAccountDao.findAll  - ==&gt;  Preparing: select * from account </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">08</span>:<span class="number">07</span>,<span class="number">943</span> <span class="number">484</span>    [           main] DEBUG hizhan.dao.IAccountDao.findAll  - ==&gt; Parameters: </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">08</span>:<span class="number">07</span>,<span class="number">961</span> <span class="number">502</span>    [           main] DEBUG oshizhan.dao.IUserDao.findById  - ====&gt;  Preparing: select * from user where id=? </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">08</span>:<span class="number">07</span>,<span class="number">962</span> <span class="number">503</span>    [           main] DEBUG oshizhan.dao.IUserDao.findById  - ====&gt; Parameters: <span class="number">46</span>(Integer)</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">08</span>:<span class="number">07</span>,<span class="number">976</span> <span class="number">517</span>    [           main] DEBUG oshizhan.dao.IUserDao.findById  - &lt;====      Total: <span class="number">1</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">08</span>:<span class="number">07</span>,<span class="number">977</span> <span class="number">518</span>    [           main] DEBUG hizhan.dao.IAccountDao.findAll  - &lt;==      Total: <span class="number">2</span></span><br><span class="line">======== 一对一表结构结果输出 ========</span><br><span class="line">Account&#123;id=<span class="number">1</span>, uid=<span class="number">46</span>, money=<span class="number">1000.0</span>&#125;</span><br><span class="line">User&#123;userId=<span class="number">46</span>, userName=<span class="string">'老王'</span>, userBirthday=Wed Mar <span class="number">07</span> <span class="number">17</span>:<span class="number">37</span>:<span class="number">26</span> CST <span class="number">2018</span>, userSex=<span class="string">'男'</span>, userAddress=<span class="string">'北京'</span>&#125;</span><br><span class="line">======== 一对一表结构结果输出 ========</span><br><span class="line">Account&#123;id=<span class="number">3</span>, uid=<span class="number">46</span>, money=<span class="number">2000.0</span>&#125;</span><br><span class="line">User&#123;userId=<span class="number">46</span>, userName=<span class="string">'老王'</span>, userBirthday=Wed Mar <span class="number">07</span> <span class="number">17</span>:<span class="number">37</span>:<span class="number">26</span> CST <span class="number">2018</span>, userSex=<span class="string">'男'</span>, userAddress=<span class="string">'北京'</span>&#125;</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">08</span>:<span class="number">07</span>,<span class="number">989</span> <span class="number">530</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Resetting autocommit to <span class="keyword">true</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">16</span>eabae]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">08</span>:<span class="number">07</span>,<span class="number">989</span> <span class="number">530</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Closing JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">16</span>eabae]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">08</span>:<span class="number">07</span>,<span class="number">989</span> <span class="number">530</span>    [           main] DEBUG source.pooled.PooledDataSource  - Returned connection <span class="number">24030126</span> to pool.</span><br></pre></td></tr></table></figure>

<h3 id="一对多操作"><a href="#一对多操作" class="headerlink" title="一对多操作"></a>一对多操作</h3><p><code>第一步：</code> <strong><em>在 <code>User</code> 实体类中添加如下几行代码。</em></strong> 代码如下：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">package club.guoshizhan.domain;</span><br><span class="line"></span><br><span class="line">import java.io.Serializable;</span><br><span class="line">import java.util.Date;</span><br><span class="line"><span class="addition">+ import java.util.List;</span></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @Author: guoshizhan</span><br><span class="line"> * @Create: 2020/6/22 23:52</span><br><span class="line"> * @Description: User 实体类</span><br><span class="line"> */</span><br><span class="line">public class User implements Serializable &#123;</span><br><span class="line"></span><br><span class="line">    private Integer userId;</span><br><span class="line">    private String userName;</span><br><span class="line">    private Date userBirthday;</span><br><span class="line">    private String userSex;</span><br><span class="line">    private String userAddress;</span><br><span class="line"></span><br><span class="line"><span class="addition">+     // 一对多关系映射：一个用户对应多个账户</span></span><br><span class="line"><span class="addition">+     private List&lt;Account&gt; accounts;</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+     public List&lt;Account&gt; getAccounts() &#123;</span></span><br><span class="line"><span class="addition">+         return accounts;</span></span><br><span class="line"><span class="addition">+     &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+     public void setAccounts(List&lt;Account&gt; accounts) &#123;</span></span><br><span class="line"><span class="addition">+         this.accounts = accounts;</span></span><br><span class="line"><span class="addition">+     &#125;</span></span><br><span class="line"></span><br><span class="line">    public Integer getUserId() &#123;</span><br><span class="line">        return userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setUserId(Integer userId) &#123;</span><br><span class="line">        this.userId = userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getUserName() &#123;</span><br><span class="line">        return userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setUserName(String userName) &#123;</span><br><span class="line">        this.userName = userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Date getUserBirthday() &#123;</span><br><span class="line">        return userBirthday;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setUserBirthday(Date userBirthday) &#123;</span><br><span class="line">        this.userBirthday = userBirthday;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getUserSex() &#123;</span><br><span class="line">        return userSex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setUserSex(String userSex) &#123;</span><br><span class="line">        this.userSex = userSex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getUserAddress() &#123;</span><br><span class="line">        return userAddress;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setUserAddress(String userAddress) &#123;</span><br><span class="line">        this.userAddress = userAddress;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return "User&#123;" +</span><br><span class="line">                "userId=" + userId +</span><br><span class="line">                ", userName='" + userName + '\'' +</span><br><span class="line">                ", userBirthday=" + userBirthday +</span><br><span class="line">                ", userSex='" + userSex + '\'' +</span><br><span class="line">                ", userAddress='" + userAddress + '\'' +</span><br><span class="line">                '&#125;';</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第二步：</code> <strong><em>在 <code>IAccountDao</code> 接口中添加如下几行代码。</em></strong> 代码如下：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">package club.guoshizhan.dao;</span><br><span class="line"></span><br><span class="line">import club.guoshizhan.domain.Account;</span><br><span class="line">import org.apache.ibatis.annotations.One;</span><br><span class="line">import org.apache.ibatis.annotations.Result;</span><br><span class="line">import org.apache.ibatis.annotations.Results;</span><br><span class="line">import org.apache.ibatis.annotations.Select;</span><br><span class="line">import org.apache.ibatis.mapping.FetchType;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @Author: guoshizhan</span><br><span class="line"> * @Create: 2020/8/24 11:07</span><br><span class="line"> * @Description: Account 的 dao 接口</span><br><span class="line"> */</span><br><span class="line">public interface IAccountDao &#123;</span><br><span class="line"></span><br><span class="line">    // 查询所有账户，并且获取每个账户所属的用户信息</span><br><span class="line">    @Select("select * from account")</span><br><span class="line">    @Results(id = "accountMap", value = &#123;</span><br><span class="line">            @Result(id = true, property = "id", column = "id"),</span><br><span class="line">            @Result(property = "uid", column = "uid"),</span><br><span class="line">            @Result(property = "money", column = "money"),</span><br><span class="line">            // one 表示一对一里面的 select 属性表示对应方法的全限定类名，fetchType 表示加载时机：立即加载、延迟加载或者默认</span><br><span class="line">            @Result(property = "user", column = "uid",one = @One(select = "club.guoshizhan.dao.IUserDao.findById",fetchType = FetchType.EAGER))</span><br><span class="line">    &#125;)</span><br><span class="line">    List&lt;Account&gt; findAll();</span><br><span class="line"></span><br><span class="line"><span class="addition">+    // 根据用户 id 查询账户信息</span></span><br><span class="line"><span class="addition">+    @Select("select * from account where uid = #&#123;uid&#125;")</span></span><br><span class="line"><span class="addition">+    List&lt;Account&gt; findAccountByUid(Integer uid);</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第三步：</code> <strong><em>在 <code>IUserDao</code> 接口中添加一行代码。</em></strong> 代码如下：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">package club.guoshizhan.dao;</span><br><span class="line"></span><br><span class="line">import club.guoshizhan.domain.User;</span><br><span class="line">import org.apache.ibatis.annotations.*;</span><br><span class="line">import org.apache.ibatis.mapping.FetchType;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @Author: guoshizhan</span><br><span class="line"> * @Create: 2020/6/22 23:53</span><br><span class="line"> * @Description: 用户持久层接口</span><br><span class="line"> */</span><br><span class="line">public interface IUserDao &#123;</span><br><span class="line"></span><br><span class="line">    // 01-查询所有用户</span><br><span class="line">    @Select("select * from user")</span><br><span class="line">    // 此处的 id 属性是一个唯一标识，相当于 resultMap 中的 id 属性。目的是此处定义好的配置可以在其他的方法上使用</span><br><span class="line">    @Results(id = "userMap", value = &#123;</span><br><span class="line">            @Result(id = true, property = "userId", column = "id"),</span><br><span class="line">            @Result(property = "userName", column = "username"),</span><br><span class="line">            @Result(property = "userAddress", column = "address"),</span><br><span class="line">            @Result(property = "userSex", column = "sex"),</span><br><span class="line">            @Result(property = "userBirthday", column = "birthday"),</span><br><span class="line"><span class="addition">+            @Result(property = "accounts", column = "id", many = @Many(select = "club.guoshizhan.dao.IAccountDao.findAccountByUid", fetchType = FetchType.LAZY))</span></span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">    List&lt;User&gt; findAll();</span><br><span class="line"></span><br><span class="line">    // 02-根据 id 查询用户</span><br><span class="line">    @Select("select * from user where id=#&#123;id&#125;")</span><br><span class="line">    @ResultMap(value = &#123;"userMap"&#125;)</span><br><span class="line">    // 此处使用了上述定义好的属性映射关系</span><br><span class="line">    User findById(Integer id);</span><br><span class="line"></span><br><span class="line">    // 03-根据用户名称模糊查询</span><br><span class="line">    @Select("select * from user where username like #&#123;username&#125;")</span><br><span class="line">    @ResultMap("userMap")</span><br><span class="line">    /* @Select("select * from user where username like '%$&#123;value&#125;%'") */</span><br><span class="line">    List&lt;User&gt; findByName(String username);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第四步：</code> <strong><em>执行测试类中的 <code>testFindAll</code> 方法。</em></strong> 测试类代码及结果如下：</p>
<figure class="highlight java"><figcaption><span>MybatisTest.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.dao.IUserDao;</span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.After;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/6/23 11:03</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Mybatis 测试类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> InputStream in;</span><br><span class="line">    <span class="keyword">private</span> IUserDao userDao;</span><br><span class="line">    <span class="keyword">private</span> SqlSession session;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试方法执行之前执行，用于一些初始化的操作，不理解的应该去看看单元测试相关知识</span></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        in = Resources.getResourceAsStream(<span class="string">"SqlMapConfig.xml"</span>);</span><br><span class="line">        SqlSessionFactory factory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br><span class="line">        session = factory.openSession();</span><br><span class="line">        userDao = session.getMapper(IUserDao<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 01-查询所有用户</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;User&gt; users = userDao.findAll();</span><br><span class="line">        <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">            System.out.println(<span class="string">"======== 每个用户的信息（使用了延迟加载） ========"</span>);</span><br><span class="line">            System.out.println(user);</span><br><span class="line">            System.out.println(user.getAccounts());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 02-根据 id 查询用户</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindById</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user = userDao.findById(<span class="number">52</span>);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 03-根据用户名称模糊查询</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindByName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String username = <span class="string">"%王%"</span>;</span><br><span class="line">        List&lt;User&gt; users = userDao.findByName(username);</span><br><span class="line">        <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试方法执行之后执行，用于释放资源，不理解的应该去看看单元测试相关知识</span></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        session.commit();</span><br><span class="line">        session.close();</span><br><span class="line">        in.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><figcaption><span>The result of MybatisTest's testFindAll method</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">35</span>,<span class="number">275</span> <span class="number">240</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Opening JDBC Connection</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">35</span>,<span class="number">553</span> <span class="number">518</span>    [           main] DEBUG source.pooled.PooledDataSource  - Created connection <span class="number">12309002</span>.</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">35</span>,<span class="number">554</span> <span class="number">519</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Setting autocommit to <span class="keyword">false</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection<span class="meta">@bbd</span>20a]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">35</span>,<span class="number">556</span> <span class="number">521</span>    [           main] DEBUG uoshizhan.dao.IUserDao.findAll  - ==&gt;  Preparing: select * from user </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">35</span>,<span class="number">587</span> <span class="number">552</span>    [           main] DEBUG uoshizhan.dao.IUserDao.findAll  - ==&gt; Parameters: </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">35</span>,<span class="number">673</span> <span class="number">638</span>    [           main] DEBUG uoshizhan.dao.IUserDao.findAll  - &lt;==      Total: <span class="number">7</span></span><br><span class="line">======== 每个用户的信息（使用了延迟加载） ========</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">35</span>,<span class="number">674</span> <span class="number">639</span>    [           main] DEBUG o.IAccountDao.findAccountByUid  - ==&gt;  Preparing: select * from account where uid = ? </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">35</span>,<span class="number">674</span> <span class="number">639</span>    [           main] DEBUG o.IAccountDao.findAccountByUid  - ==&gt; Parameters: <span class="number">42</span>(Integer)</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">35</span>,<span class="number">674</span> <span class="number">639</span>    [           main] DEBUG o.IAccountDao.findAccountByUid  - &lt;==      Total: <span class="number">0</span></span><br><span class="line">User&#123;userId=<span class="number">42</span>, userName=<span class="string">'小二王'</span>, userBirthday=Fri Mar <span class="number">02</span> <span class="number">15</span>:<span class="number">09</span>:<span class="number">37</span> CST <span class="number">2018</span>, userSex=<span class="string">'女'</span>, userAddress=<span class="string">'北京金燕龙'</span>&#125;</span><br><span class="line">[]</span><br><span class="line">======== 每个用户的信息（使用了延迟加载） ========</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">35</span>,<span class="number">679</span> <span class="number">644</span>    [           main] DEBUG o.IAccountDao.findAccountByUid  - ==&gt;  Preparing: select * from account where uid = ? </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">35</span>,<span class="number">679</span> <span class="number">644</span>    [           main] DEBUG o.IAccountDao.findAccountByUid  - ==&gt; Parameters: <span class="number">43</span>(Integer)</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">35</span>,<span class="number">679</span> <span class="number">644</span>    [           main] DEBUG o.IAccountDao.findAccountByUid  - &lt;==      Total: <span class="number">0</span></span><br><span class="line">User&#123;userId=<span class="number">43</span>, userName=<span class="string">'大王'</span>, userBirthday=Tue Nov <span class="number">12</span> <span class="number">10</span>:<span class="number">19</span>:<span class="number">13</span> CST <span class="number">2019</span>, userSex=<span class="string">'男'</span>, userAddress=<span class="string">'Los Angeles'</span>&#125;</span><br><span class="line">[]</span><br><span class="line">======== 每个用户的信息（使用了延迟加载） ========</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">35</span>,<span class="number">680</span> <span class="number">645</span>    [           main] DEBUG o.IAccountDao.findAccountByUid  - ==&gt;  Preparing: select * from account where uid = ? </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">35</span>,<span class="number">680</span> <span class="number">645</span>    [           main] DEBUG o.IAccountDao.findAccountByUid  - ==&gt; Parameters: <span class="number">46</span>(Integer)</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">35</span>,<span class="number">681</span> <span class="number">646</span>    [           main] DEBUG o.IAccountDao.findAccountByUid  - &lt;==      Total: <span class="number">2</span></span><br><span class="line">User&#123;userId=<span class="number">46</span>, userName=<span class="string">'老王'</span>, userBirthday=Wed Mar <span class="number">07</span> <span class="number">17</span>:<span class="number">37</span>:<span class="number">26</span> CST <span class="number">2018</span>, userSex=<span class="string">'男'</span>, userAddress=<span class="string">'北京'</span>&#125;</span><br><span class="line">[Account&#123;id=<span class="number">1</span>, uid=<span class="number">46</span>, money=<span class="number">1000.0</span>&#125;, Account&#123;id=<span class="number">3</span>, uid=<span class="number">46</span>, money=<span class="number">2000.0</span>&#125;]</span><br><span class="line">======== 每个用户的信息（使用了延迟加载） ========</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">35</span>,<span class="number">681</span> <span class="number">646</span>    [           main] DEBUG o.IAccountDao.findAccountByUid  - ==&gt;  Preparing: select * from account where uid = ? </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">35</span>,<span class="number">682</span> <span class="number">647</span>    [           main] DEBUG o.IAccountDao.findAccountByUid  - ==&gt; Parameters: <span class="number">49</span>(Integer)</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">35</span>,<span class="number">682</span> <span class="number">647</span>    [           main] DEBUG o.IAccountDao.findAccountByUid  - &lt;==      Total: <span class="number">0</span></span><br><span class="line">User&#123;userId=<span class="number">49</span>, userName=<span class="string">'Jack'</span>, userBirthday=Mon Oct <span class="number">28</span> <span class="number">09</span>:<span class="number">15</span>:<span class="number">39</span> CST <span class="number">2019</span>, userSex=<span class="string">'男'</span>, userAddress=<span class="string">'上海闵行'</span>&#125;</span><br><span class="line">[]</span><br><span class="line">======== 每个用户的信息（使用了延迟加载） ========</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">35</span>,<span class="number">683</span> <span class="number">648</span>    [           main] DEBUG o.IAccountDao.findAccountByUid  - ==&gt;  Preparing: select * from account where uid = ? </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">35</span>,<span class="number">683</span> <span class="number">648</span>    [           main] DEBUG o.IAccountDao.findAccountByUid  - ==&gt; Parameters: <span class="number">51</span>(Integer)</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">35</span>,<span class="number">683</span> <span class="number">648</span>    [           main] DEBUG o.IAccountDao.findAccountByUid  - &lt;==      Total: <span class="number">0</span></span><br><span class="line">User&#123;userId=<span class="number">51</span>, userName=<span class="string">'Lisa'</span>, userBirthday=Mon Oct <span class="number">28</span> <span class="number">09</span>:<span class="number">17</span>:<span class="number">31</span> CST <span class="number">2019</span>, userSex=<span class="string">'女'</span>, userAddress=<span class="string">'广东佛山'</span>&#125;</span><br><span class="line">[]</span><br><span class="line">======== 每个用户的信息（使用了延迟加载） ========</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">35</span>,<span class="number">684</span> <span class="number">649</span>    [           main] DEBUG o.IAccountDao.findAccountByUid  - ==&gt;  Preparing: select * from account where uid = ? </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">35</span>,<span class="number">684</span> <span class="number">649</span>    [           main] DEBUG o.IAccountDao.findAccountByUid  - ==&gt; Parameters: <span class="number">52</span>(Integer)</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">35</span>,<span class="number">685</span> <span class="number">650</span>    [           main] DEBUG o.IAccountDao.findAccountByUid  - &lt;==      Total: <span class="number">0</span></span><br><span class="line">User&#123;userId=<span class="number">52</span>, userName=<span class="string">'Tom'</span>, userBirthday=Mon Oct <span class="number">28</span> <span class="number">10</span>:<span class="number">26</span>:<span class="number">42</span> CST <span class="number">2019</span>, userSex=<span class="string">'男'</span>, userAddress=<span class="string">'广东佛山'</span>&#125;</span><br><span class="line">[]</span><br><span class="line">======== 每个用户的信息（使用了延迟加载） ========</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">35</span>,<span class="number">686</span> <span class="number">651</span>    [           main] DEBUG o.IAccountDao.findAccountByUid  - ==&gt;  Preparing: select * from account where uid = ? </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">35</span>,<span class="number">687</span> <span class="number">652</span>    [           main] DEBUG o.IAccountDao.findAccountByUid  - ==&gt; Parameters: <span class="number">54</span>(Integer)</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">35</span>,<span class="number">688</span> <span class="number">653</span>    [           main] DEBUG o.IAccountDao.findAccountByUid  - &lt;==      Total: <span class="number">0</span></span><br><span class="line">User&#123;userId=<span class="number">54</span>, userName=<span class="string">'Bob'</span>, userBirthday=Tue Nov <span class="number">12</span> <span class="number">10</span>:<span class="number">21</span>:<span class="number">41</span> CST <span class="number">2019</span>, userSex=<span class="string">'男'</span>, userAddress=<span class="string">'广东佛山'</span>&#125;</span><br><span class="line">[]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">35</span>,<span class="number">688</span> <span class="number">653</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Resetting autocommit to <span class="keyword">true</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection<span class="meta">@bbd</span>20a]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">35</span>,<span class="number">689</span> <span class="number">654</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Closing JDBC Connection [com.mysql.jdbc.JDBC4Connection<span class="meta">@bbd</span>20a]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">35</span>,<span class="number">689</span> <span class="number">654</span>    [           main] DEBUG source.pooled.PooledDataSource  - Returned connection <span class="number">12309002</span> to pool.</span><br></pre></td></tr></table></figure>

<h2 id="缓存的配置"><a href="#缓存的配置" class="headerlink" title="缓存的配置"></a>缓存的配置</h2><p><code>一级缓存</code> 不用我们开启，也不用我们配置，<strong><em>mabatis 已经自动配置好了，不需要我们去操心。</em></strong> 举个例子，把 <code>MybatisTest</code> 类中的 <code>testFindById</code> 方法修改成下列代码：</p>
<figure class="highlight java"><figcaption><span>MybatisTest's testFindById method</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 02-根据 id 查询用户</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindById</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    User user = userDao.findById(<span class="number">52</span>);</span><br><span class="line">    System.out.println(user);</span><br><span class="line"></span><br><span class="line">    User user1 = userDao.findById(<span class="number">52</span>);</span><br><span class="line">    System.out.println(user1);</span><br><span class="line"></span><br><span class="line">    System.out.println(user==user1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><em>执行 <code>testFindById</code> 方法，</em></strong> 结果如下<strong><em>（关注 user==user1 的结果及 SQL 语句）</em></strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">53</span>:<span class="number">49</span>,<span class="number">849</span> <span class="number">212</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Opening JDBC Connection</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">53</span>:<span class="number">50</span>,<span class="number">079</span> <span class="number">442</span>    [           main] DEBUG source.pooled.PooledDataSource  - Created connection <span class="number">9807749</span>.</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">53</span>:<span class="number">50</span>,<span class="number">079</span> <span class="number">442</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Setting autocommit to <span class="keyword">false</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">95</span>a785]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">53</span>:<span class="number">50</span>,<span class="number">084</span> <span class="number">447</span>    [           main] DEBUG oshizhan.dao.IUserDao.findById  - ==&gt;  Preparing: select * from user where id=? </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">53</span>:<span class="number">50</span>,<span class="number">125</span> <span class="number">488</span>    [           main] DEBUG oshizhan.dao.IUserDao.findById  - ==&gt; Parameters: <span class="number">52</span>(Integer)</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">53</span>:<span class="number">50</span>,<span class="number">211</span> <span class="number">574</span>    [           main] DEBUG oshizhan.dao.IUserDao.findById  - &lt;==      Total: <span class="number">1</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">53</span>:<span class="number">50</span>,<span class="number">212</span> <span class="number">575</span>    [           main] DEBUG o.IAccountDao.findAccountByUid  - ==&gt;  Preparing: select * from account where uid = ? </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">53</span>:<span class="number">50</span>,<span class="number">212</span> <span class="number">575</span>    [           main] DEBUG o.IAccountDao.findAccountByUid  - ==&gt; Parameters: <span class="number">52</span>(Integer)</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">53</span>:<span class="number">50</span>,<span class="number">213</span> <span class="number">576</span>    [           main] DEBUG o.IAccountDao.findAccountByUid  - &lt;==      Total: <span class="number">0</span></span><br><span class="line">User&#123;userId=<span class="number">52</span>, userName=<span class="string">'Tom'</span>, userBirthday=Mon Oct <span class="number">28</span> <span class="number">10</span>:<span class="number">26</span>:<span class="number">42</span> CST <span class="number">2019</span>, userSex=<span class="string">'男'</span>, userAddress=<span class="string">'广东佛山'</span>&#125;</span><br><span class="line">User&#123;userId=<span class="number">52</span>, userName=<span class="string">'Tom'</span>, userBirthday=Mon Oct <span class="number">28</span> <span class="number">10</span>:<span class="number">26</span>:<span class="number">42</span> CST <span class="number">2019</span>, userSex=<span class="string">'男'</span>, userAddress=<span class="string">'广东佛山'</span>&#125;</span><br><span class="line"><span class="keyword">true</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">53</span>:<span class="number">50</span>,<span class="number">221</span> <span class="number">584</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Resetting autocommit to <span class="keyword">true</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">95</span>a785]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">53</span>:<span class="number">50</span>,<span class="number">222</span> <span class="number">585</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Closing JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">95</span>a785]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">15</span>:<span class="number">53</span>:<span class="number">50</span>,<span class="number">222</span> <span class="number">585</span>    [           main] DEBUG source.pooled.PooledDataSource  - Returned connection <span class="number">9807749</span> to pool.</span><br></pre></td></tr></table></figure>

<p>由结果可知，user 和 user1 是相等的。<strong><em>所以我们需要关注的是： <code>二级缓存</code> 如何去配置。</em></strong> 那么就来操作一下。<code>第一步：</code> <strong><em>在测试的包下新建 <code>SecondLevelCacheTest</code> 测试类，</em></strong> 代码如下：</p>
<figure class="highlight java"><figcaption><span>SecondLevelCacheTest.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.dao.IUserDao;</span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.domain.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.After;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/8/25 16:01</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 二级缓存测试类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecondLevelCacheTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> InputStream in;</span><br><span class="line">    <span class="keyword">private</span> SqlSessionFactory factory;</span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        in = Resources.getResourceAsStream(<span class="string">"SqlMapConfig.xml"</span>);</span><br><span class="line">        factory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试二级缓存</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindById</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        SqlSession session = factory.openSession();</span><br><span class="line">        IUserDao userDao = session.getMapper(IUserDao<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        User user = userDao.findById(<span class="number">52</span>);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">        session.close();    <span class="comment">// 释放一级缓存</span></span><br><span class="line"></span><br><span class="line">        SqlSession session1 = factory.openSession();    <span class="comment">// 再次打开一个名为 session1 的 SqlSession 对象</span></span><br><span class="line">        IUserDao userDao1 = session1.getMapper(IUserDao<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        User user1 = userDao1.findById(<span class="number">52</span>);</span><br><span class="line">        System.out.println(user1);</span><br><span class="line">        session1.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        in.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><em>执行 <code>testFindById</code> 方法，</em></strong> 结果如下<strong><em>（由于没有配置缓存，SQL 必定执行两次。因为这样，所以需要配置二级缓存）</em></strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">20</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">16</span>:<span class="number">10</span>:<span class="number">49</span>,<span class="number">746</span> <span class="number">249</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Opening JDBC Connection</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">16</span>:<span class="number">10</span>:<span class="number">49</span>,<span class="number">984</span> <span class="number">487</span>    [           main] DEBUG source.pooled.PooledDataSource  - Created connection <span class="number">9807749</span>.</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">16</span>:<span class="number">10</span>:<span class="number">49</span>,<span class="number">985</span> <span class="number">488</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Setting autocommit to <span class="keyword">false</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">95</span>a785]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">16</span>:<span class="number">10</span>:<span class="number">49</span>,<span class="number">987</span> <span class="number">490</span>    [           main] DEBUG oshizhan.dao.IUserDao.findById  - ==&gt;  Preparing: select * from user where id=? </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">16</span>:<span class="number">10</span>:<span class="number">50</span>,<span class="number">016</span> <span class="number">519</span>    [           main] DEBUG oshizhan.dao.IUserDao.findById  - ==&gt; Parameters: <span class="number">52</span>(Integer)</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">16</span>:<span class="number">10</span>:<span class="number">50</span>,<span class="number">091</span> <span class="number">594</span>    [           main] DEBUG oshizhan.dao.IUserDao.findById  - &lt;==      Total: <span class="number">1</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">16</span>:<span class="number">10</span>:<span class="number">50</span>,<span class="number">092</span> <span class="number">595</span>    [           main] DEBUG o.IAccountDao.findAccountByUid  - ==&gt;  Preparing: select * from account where uid = ? </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">16</span>:<span class="number">10</span>:<span class="number">50</span>,<span class="number">092</span> <span class="number">595</span>    [           main] DEBUG o.IAccountDao.findAccountByUid  - ==&gt; Parameters: <span class="number">52</span>(Integer)</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">16</span>:<span class="number">10</span>:<span class="number">50</span>,<span class="number">092</span> <span class="number">595</span>    [           main] DEBUG o.IAccountDao.findAccountByUid  - &lt;==      Total: <span class="number">0</span></span><br><span class="line">User&#123;userId=<span class="number">52</span>, userName=<span class="string">'Tom'</span>, userBirthday=Mon Oct <span class="number">28</span> <span class="number">10</span>:<span class="number">26</span>:<span class="number">42</span> CST <span class="number">2019</span>, userSex=<span class="string">'男'</span>, userAddress=<span class="string">'广东佛山'</span>&#125;</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">16</span>:<span class="number">10</span>:<span class="number">50</span>,<span class="number">095</span> <span class="number">598</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Resetting autocommit to <span class="keyword">true</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">95</span>a785]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">16</span>:<span class="number">10</span>:<span class="number">50</span>,<span class="number">095</span> <span class="number">598</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Closing JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">95</span>a785]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">16</span>:<span class="number">10</span>:<span class="number">50</span>,<span class="number">095</span> <span class="number">598</span>    [           main] DEBUG source.pooled.PooledDataSource  - Returned connection <span class="number">9807749</span> to pool.</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">16</span>:<span class="number">10</span>:<span class="number">50</span>,<span class="number">095</span> <span class="number">598</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Opening JDBC Connection</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">16</span>:<span class="number">10</span>:<span class="number">50</span>,<span class="number">095</span> <span class="number">598</span>    [           main] DEBUG source.pooled.PooledDataSource  - Checked out connection <span class="number">9807749</span> from pool.</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">16</span>:<span class="number">10</span>:<span class="number">50</span>,<span class="number">095</span> <span class="number">598</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Setting autocommit to <span class="keyword">false</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">95</span>a785]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">16</span>:<span class="number">10</span>:<span class="number">50</span>,<span class="number">096</span> <span class="number">599</span>    [           main] DEBUG oshizhan.dao.IUserDao.findById  - ==&gt;  Preparing: select * from user where id=? </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">16</span>:<span class="number">10</span>:<span class="number">50</span>,<span class="number">096</span> <span class="number">599</span>    [           main] DEBUG oshizhan.dao.IUserDao.findById  - ==&gt; Parameters: <span class="number">52</span>(Integer)</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">16</span>:<span class="number">10</span>:<span class="number">50</span>,<span class="number">097</span> <span class="number">600</span>    [           main] DEBUG oshizhan.dao.IUserDao.findById  - &lt;==      Total: <span class="number">1</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">16</span>:<span class="number">10</span>:<span class="number">50</span>,<span class="number">098</span> <span class="number">601</span>    [           main] DEBUG o.IAccountDao.findAccountByUid  - ==&gt;  Preparing: select * from account where uid = ? </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">16</span>:<span class="number">10</span>:<span class="number">50</span>,<span class="number">098</span> <span class="number">601</span>    [           main] DEBUG o.IAccountDao.findAccountByUid  - ==&gt; Parameters: <span class="number">52</span>(Integer)</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">16</span>:<span class="number">10</span>:<span class="number">50</span>,<span class="number">098</span> <span class="number">601</span>    [           main] DEBUG o.IAccountDao.findAccountByUid  - &lt;==      Total: <span class="number">0</span></span><br><span class="line">User&#123;userId=<span class="number">52</span>, userName=<span class="string">'Tom'</span>, userBirthday=Mon Oct <span class="number">28</span> <span class="number">10</span>:<span class="number">26</span>:<span class="number">42</span> CST <span class="number">2019</span>, userSex=<span class="string">'男'</span>, userAddress=<span class="string">'广东佛山'</span>&#125;</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">16</span>:<span class="number">10</span>:<span class="number">50</span>,<span class="number">099</span> <span class="number">602</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Resetting autocommit to <span class="keyword">true</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">95</span>a785]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">16</span>:<span class="number">10</span>:<span class="number">50</span>,<span class="number">099</span> <span class="number">602</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Closing JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">95</span>a785]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">16</span>:<span class="number">10</span>:<span class="number">50</span>,<span class="number">099</span> <span class="number">602</span>    [           main] DEBUG source.pooled.PooledDataSource  - Returned connection <span class="number">9807749</span> to pool.</span><br></pre></td></tr></table></figure>

<p>既然这样，<strong><em>那么我们如何去配置 <code>二级缓存</code> 呢？</em></strong> <code>第一步：</code> <strong><em>在主配置文件 <code>SqlMapConfig.xml</code> 中</em></strong> 加入如下代码（<strong><em>其实下列代码可加可不加，因为 mybatis 的默认配置就是 true，所以可不加，加了也没有关系</em></strong>）：</p>
<figure class="highlight diff"><figcaption><span>SqlMapConfig.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;configuration&gt;</span><br><span class="line"></span><br><span class="line"><span class="addition">+    &lt;!-- 配置开启二级缓存 --&gt;</span></span><br><span class="line"><span class="addition">+    &lt;settings&gt;</span></span><br><span class="line"><span class="addition">+        &lt;setting name="cacheEnabled" value="true"/&gt;</span></span><br><span class="line"><span class="addition">+    &lt;/settings&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>第二步：</code> <strong><em>在 <code>IUserDao</code> 接口中加入如下注解。（表示开启二级缓存）</em></strong> 代码如下：</p>
<figure class="highlight diff"><figcaption><span>IUserDao.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="addition">+ @CacheNamespace(blocking = true)</span></span><br><span class="line">public interface IUserDao &#123;</span><br><span class="line"> ...</span><br></pre></td></tr></table></figure>

<p>上述步骤做完后，<strong><em>我们就去执行 <code>testFindById</code> 方法，</em></strong> 测试结果如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">16</span>:<span class="number">20</span>:<span class="number">36</span>,<span class="number">351</span> <span class="number">231</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Opening JDBC Connection</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">16</span>:<span class="number">20</span>:<span class="number">36</span>,<span class="number">644</span> <span class="number">524</span>    [           main] DEBUG source.pooled.PooledDataSource  - Created connection <span class="number">26174884</span>.</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">16</span>:<span class="number">20</span>:<span class="number">36</span>,<span class="number">644</span> <span class="number">524</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Setting autocommit to <span class="keyword">false</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">18f</span>65a4]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">16</span>:<span class="number">20</span>:<span class="number">36</span>,<span class="number">647</span> <span class="number">527</span>    [           main] DEBUG oshizhan.dao.IUserDao.findById  - ==&gt;  Preparing: select * from user where id=? </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">16</span>:<span class="number">20</span>:<span class="number">36</span>,<span class="number">677</span> <span class="number">557</span>    [           main] DEBUG oshizhan.dao.IUserDao.findById  - ==&gt; Parameters: <span class="number">52</span>(Integer)</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">16</span>:<span class="number">20</span>:<span class="number">36</span>,<span class="number">773</span> <span class="number">653</span>    [           main] DEBUG oshizhan.dao.IUserDao.findById  - &lt;==      Total: <span class="number">1</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">16</span>:<span class="number">20</span>:<span class="number">36</span>,<span class="number">775</span> <span class="number">655</span>    [           main] DEBUG o.IAccountDao.findAccountByUid  - ==&gt;  Preparing: select * from account where uid = ? </span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">16</span>:<span class="number">20</span>:<span class="number">36</span>,<span class="number">775</span> <span class="number">655</span>    [           main] DEBUG o.IAccountDao.findAccountByUid  - ==&gt; Parameters: <span class="number">52</span>(Integer)</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">16</span>:<span class="number">20</span>:<span class="number">36</span>,<span class="number">775</span> <span class="number">655</span>    [           main] DEBUG o.IAccountDao.findAccountByUid  - &lt;==      Total: <span class="number">0</span></span><br><span class="line">User&#123;userId=<span class="number">52</span>, userName=<span class="string">'Tom'</span>, userBirthday=Mon Oct <span class="number">28</span> <span class="number">10</span>:<span class="number">26</span>:<span class="number">42</span> CST <span class="number">2019</span>, userSex=<span class="string">'男'</span>, userAddress=<span class="string">'广东佛山'</span>&#125;</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">16</span>:<span class="number">20</span>:<span class="number">36</span>,<span class="number">792</span> <span class="number">672</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Resetting autocommit to <span class="keyword">true</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">18f</span>65a4]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">16</span>:<span class="number">20</span>:<span class="number">36</span>,<span class="number">792</span> <span class="number">672</span>    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Closing JDBC Connection [com.mysql.jdbc.JDBC4Connection@<span class="number">18f</span>65a4]</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">16</span>:<span class="number">20</span>:<span class="number">36</span>,<span class="number">792</span> <span class="number">672</span>    [           main] DEBUG source.pooled.PooledDataSource  - Returned connection <span class="number">26174884</span> to pool.</span><br><span class="line"><span class="number">2020</span>-<span class="number">08</span>-<span class="number">25</span> <span class="number">16</span>:<span class="number">20</span>:<span class="number">36</span>,<span class="number">794</span> <span class="number">674</span>    [           main] DEBUG   club.guoshizhan.dao.IUserDao  - Cache Hit Ratio [club.guoshizhan.dao.IUserDao]: <span class="number">0.5</span></span><br><span class="line">User&#123;userId=<span class="number">52</span>, userName=<span class="string">'Tom'</span>, userBirthday=Mon Oct <span class="number">28</span> <span class="number">10</span>:<span class="number">26</span>:<span class="number">42</span> CST <span class="number">2019</span>, userSex=<span class="string">'男'</span>, userAddress=<span class="string">'广东佛山'</span>&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>我们从结果发现：</code> <strong><em>它只执行了一次 SQL 语句，并没有发起第二次查询，这说明 <code>二级缓存</code> 开启了，也就是第二次的查询操作使用了我们配置的二级缓存。</em></strong> 到此为止，mybatis 教程就结束了。如有错误，请评论区指出！！！</p>
</blockquote>

        </div>
        
        <div class="level is-size-7 is-uppercase">
            <div class="level-start">
                <div class="level-item  guo-tags">
                    <i class="fas fa-tags has-text-grey"></i>&nbsp;&nbsp;
                    <a class="has-link-grey -link" href="/tags/mybatis/" rel="tag">mybatis</a>
                </div>
            </div>
        </div>
        
        
        
        <!-- 文章版权信息代码开始 -->

        
            <ul class="post-copyright">
            <li><b>本文标题：</b><b>Mybatis 入门教程</b></li>
            <li><b>本文作者：</b><b>Java Developer</b></li>
            <li><b>本文链接：</b><b><a href="https://guoshizhan.github.io/Mybatis.html">https://guoshizhan.github.io/Mybatis.html</a></b></li>
            <li><b>版权声明：</b><b>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！</b>
            </li>
            </ul>
            <br/>
            <span class="is-size-6 has-text-grey has-mr-7">📚&nbsp;本站推荐文章</span>
<br>

    &nbsp;<!--1--> 👉 <a href="/blog-setup.html" class="is-size-6" target="_blank">从 0 开始搭建 Hexo 博客</a><br>

    &nbsp;<!--2--> 👉 <a href="/computerNetwork.html" class="is-size-6" target="_blank">计算机网络入门教程</a><br>

    &nbsp;<!--3--> 👉 <a href="/Structure.html" class="is-size-6" target="_blank">数据结构入门</a><br>

    &nbsp;<!--4--> 👉 <a href="/Algorithm.html" class="is-size-6" target="_blank">算法入门</a><br>

    &nbsp;<!--5--> 👉 <a href="/IDEA.html" class="is-size-6" target="_blank">IDEA 入门教程</a><br>

            <br>
        

        <!-- 文章版权信息代码结束-->
        

        
        <div class="social-share"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css">
<script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script>
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3>
        <div class="buttons is-centered">
            
                
<a class="button is-info donate">
    <span class="icon is-small">
        <i class="fab fa-alipay"></i>
    </span>
    <span>支付宝</span>
    <div class="qrcode"><img src="/images/wechat.png" alt="支付宝"></div>
</a>

                
                
<a class="button is-success donate">
    <span class="icon is-small">
        <i class="fab fa-weixin"></i>
    </span>
    <span>微信</span>
    <div class="qrcode"><img src="/images/wechat.png" alt="微信"></div>
</a>

                
        </div>
    </div>
</div>



<div class="card card-transparent">
    <div class="level post-navigation is-flex-wrap is-mobile">
        
        <div class="level-start">
            <a class="level level-item has-link-grey  article-nav-prev" href="/interview.html">
                <i class="level-item fas fa-chevron-left"></i>
                <span class="level-item">Java 面试集锦</span>
            </a>
        </div>
        
        
        <div class="level-end">
            <a class="level level-item has-link-grey  article-nav-next" href="/vue.html">
                <span class="level-item">Vue 的入门教程</span>
                <i class="level-item fas fa-chevron-right"></i>
            </a>
        </div>
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="title is-5 has-text-weight-normal">可在评论区留言哦</h3>
        
<div id="comment-container"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.4.1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1.4.1/dist/gitalk.min.js"></script>
<script>
    var gitalk = new Gitalk({
        clientID: 'cff2590c3ebe89a56cf0',
        clientSecret: 'b6eea23c7fd06b8a540fea56bfa7546a3dfcf214',
        id: '7210d0130d0325a7ad7b9e7a3e7a5768',
        repo: 'gitalk-comments',
        owner: 'guoshizhan',
        admin: "guoshizhan",
        createIssueManually: false,
        distractionFreeMode: true
    })
    gitalk.render('comment-container')
</script>

    </div>
</div>
</div>
                




<div class="column is-4-tablet is-3-desktop is-3-widescreen  has-order-1 column-left is-sticky">
    
        <!--         这里的第一行和最后一行的功能是动态隐藏 profile ，菜单页显示，文章页不显示。-->

<div class="card widget">
    <div class="card-content guo-profile">
        <nav class="level">
            <div class="level-item has-text-centered guo-nav" style="flex-shrink: 1">
                <div class="guo-header">
                    <div class="guo-img">
                        
                        <figure class="image is-128x128 has-mb-6">
                            <img class="is-rounded  avatar-image" src="/images/avatar.gif" alt="何年の再遇见">
                        </figure>
                    </div>
                    
                    <div class="guo-text">
                        
                            <p class="is-size-4 is-block">
                                何年の再遇见
                            </p>
                            
                            
                            <p class="is-size-6 is-block">
                                愿你走出半生，归来仍是少年
                            </p>
                            
                            
                            <p class="is-size-6 is-flex is-flex-center">
                                <i class="fas fa-map-marker-alt has-mr-7"></i>
                                <span>井冈山大学</span>
                            </p>
                        
                    </div>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile guo-nav">
            <div class="level-item has-text-centered is-marginless wz">
                <div>
                    <p class="heading">
                        文章
                    </p>
                    <a href="/archives">
                        <p class="title has-text-weight-normal">
                            34
                        </p>
                    </a>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless fl">
                <div>
                    <p class="heading">
                        分类
                    </p>
                    <a href="/categories">
                        <p class="title has-text-weight-normal">
                            9
                        </p>
                    </a>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless bq">
                <div>
                    <p class="heading">
                        标签
                    </p>
                    <a href="/tags">
                        <p class="title has-text-weight-normal">
                            44
                        </p>
                    </a>
                </div>
            </div>
        </nav>
        <!--
        
            <div >
                <a class="level-item button guo-github" href="https://github.com/guoshizhan" target="_blank" rel="noopener">我的 GitHub 地址</a>
            </div>
        
        -->
        
        
        <div style="max-height:100px;">
            <p id="hitokoto">一言句子获取中...</p>
            <script src="https://v1.hitokoto.cn/?encode=js&select=%23hitokoto" defer></script>
        </div>
    </div>
</div>
<!--         这里的最后一行和第一行的功能是动态隐藏 profile ，菜单页显示，文章页不显示。-->
    
        

    <div class="card widget toc-scroll" id="toc">
        <div class="card-content">
            <div class="menu">
                <h3 class="menu-label">
                    目录
                </h3>
                <ul class="menu-list"><li>
        <a class="is-flex" href="#mybatis-的入门">
        <span class="has-mr-6">1</span>
        <span>mybatis 的入门</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#mybatis-的概述">
        <span class="has-mr-6">1.1</span>
        <span>mybatis 的概述</span>
        </a></li><li>
        <a class="is-flex" href="#mybatis-的环境搭建">
        <span class="has-mr-6">1.2</span>
        <span>mybatis 的环境搭建</span>
        </a></li><li>
        <a class="is-flex" href="#mybatis-的入门案例">
        <span class="has-mr-6">1.3</span>
        <span>mybatis 的入门案例</span>
        </a></li><li>
        <a class="is-flex" href="#mybatis-注解案例">
        <span class="has-mr-6">1.4</span>
        <span>mybatis 注解案例</span>
        </a></li><li>
        <a class="is-flex" href="#自定义-mybatis-框架">
        <span class="has-mr-6">1.5</span>
        <span>自定义 mybatis 框架</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#mybatis-的基本使用">
        <span class="has-mr-6">2</span>
        <span>mybatis 的基本使用</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#mybatis-的单表操作">
        <span class="has-mr-6">2.1</span>
        <span>mybatis 的单表操作</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#mybatis-保存操作">
        <span class="has-mr-6">2.1.1</span>
        <span>mybatis 保存操作</span>
        </a></li><li>
        <a class="is-flex" href="#mybatis-修改操作">
        <span class="has-mr-6">2.1.2</span>
        <span>mybatis 修改操作</span>
        </a></li><li>
        <a class="is-flex" href="#mybatis-删除操作">
        <span class="has-mr-6">2.1.3</span>
        <span>mybatis 删除操作</span>
        </a></li><li>
        <a class="is-flex" href="#mybatis-查询操作">
        <span class="has-mr-6">2.1.4</span>
        <span>mybatis 查询操作</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#mybatis-的参数和返回值">
        <span class="has-mr-6">2.2</span>
        <span>mybatis 的参数和返回值</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#mybatis-的参数">
        <span class="has-mr-6">2.2.1</span>
        <span>mybatis 的参数</span>
        </a></li><li>
        <a class="is-flex" href="#mybatis-的返回值">
        <span class="has-mr-6">2.2.2</span>
        <span>mybatis 的返回值</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#mybatis-自定义-dao-实现类">
        <span class="has-mr-6">2.3</span>
        <span>mybatis 自定义 dao 实现类</span>
        </a></li><li>
        <a class="is-flex" href="#mybatis-的基本配置">
        <span class="has-mr-6">2.4</span>
        <span>mybatis 的基本配置</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#properties-标签">
        <span class="has-mr-6">2.4.1</span>
        <span>properties 标签</span>
        </a></li><li>
        <a class="is-flex" href="#typeAliases-标签">
        <span class="has-mr-6">2.4.2</span>
        <span>typeAliases 标签</span>
        </a></li></ul></li></ul></li><li>
        <a class="is-flex" href="#mybatis-连接池">
        <span class="has-mr-6">3</span>
        <span>mybatis 连接池</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#连接池概念和优点">
        <span class="has-mr-6">3.1</span>
        <span>连接池概念和优点</span>
        </a></li><li>
        <a class="is-flex" href="#mybatis-连接池的三种配置">
        <span class="has-mr-6">3.2</span>
        <span>mybatis 连接池的三种配置</span>
        </a></li><li>
        <a class="is-flex" href="#mybatis-中的事务">
        <span class="has-mr-6">3.3</span>
        <span>mybatis 中的事务</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#mybatis-的动态-SQL">
        <span class="has-mr-6">4</span>
        <span>mybatis 的动态 SQL</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#if-标签">
        <span class="has-mr-6">4.1</span>
        <span>if 标签</span>
        </a></li><li>
        <a class="is-flex" href="#where-标签">
        <span class="has-mr-6">4.2</span>
        <span>where 标签</span>
        </a></li><li>
        <a class="is-flex" href="#foreach-标签">
        <span class="has-mr-6">4.3</span>
        <span>foreach 标签</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#mybatis-的多表操作">
        <span class="has-mr-6">5</span>
        <span>mybatis 的多表操作</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#前期准备">
        <span class="has-mr-6">5.1</span>
        <span>前期准备</span>
        </a></li><li>
        <a class="is-flex" href="#一对一">
        <span class="has-mr-6">5.2</span>
        <span>一对一</span>
        </a></li><li>
        <a class="is-flex" href="#一对多">
        <span class="has-mr-6">5.3</span>
        <span>一对多</span>
        </a></li><li>
        <a class="is-flex" href="#多对多">
        <span class="has-mr-6">5.4</span>
        <span>多对多</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#JNDI-知识">
        <span class="has-mr-6">6</span>
        <span>JNDI 知识</span>
        </a></li><li>
        <a class="is-flex" href="#延迟加载和缓存">
        <span class="has-mr-6">7</span>
        <span>延迟加载和缓存</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#mybatis-的延迟加载">
        <span class="has-mr-6">7.1</span>
        <span>mybatis 的延迟加载</span>
        </a></li><li>
        <a class="is-flex" href="#mybatis-的缓存">
        <span class="has-mr-6">7.2</span>
        <span>mybatis 的缓存</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#mybatis-注解开发">
        <span class="has-mr-6">8</span>
        <span>mybatis 注解开发</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#环境搭建">
        <span class="has-mr-6">8.1</span>
        <span>环境搭建</span>
        </a></li><li>
        <a class="is-flex" href="#单表-CRUD-操作">
        <span class="has-mr-6">8.2</span>
        <span>单表 CRUD 操作</span>
        </a></li><li>
        <a class="is-flex" href="#多表查询操作">
        <span class="has-mr-6">8.3</span>
        <span>多表查询操作</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#一对一操作">
        <span class="has-mr-6">8.3.1</span>
        <span>一对一操作</span>
        </a></li><li>
        <a class="is-flex" href="#一对多操作">
        <span class="has-mr-6">8.3.2</span>
        <span>一对多操作</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#缓存的配置">
        <span class="has-mr-6">8.4</span>
        <span>缓存的配置</span>
        </a></li></ul></li></ul>
            </div>
        </div>
    </div>

    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                分类
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/C-python-Linux/">
            <span class="level-start">
                <span class="level-item">C-python-Linux</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Java%E5%AD%A6%E4%B9%A0/">
            <span class="level-start">
                <span class="level-item">Java学习</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">15</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86/">
            <span class="level-start">
                <span class="level-item">前端知识</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/%E5%A4%A7%E5%AD%A6-%E7%94%9F%E6%B4%BB-%E5%85%B6%E4%BB%96/">
            <span class="level-start">
                <span class="level-item">大学-生活-其他</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/%E6%95%99%E7%A8%8B%E5%B7%A5%E5%85%B7/">
            <span class="level-start">
                <span class="level-item">教程工具</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">6</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">
            <span class="level-start">
                <span class="level-item">数据库</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95/">
            <span class="level-start">
                <span class="level-item">数据结构和算法</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/%E8%8B%B1%E8%AF%AD%E5%AD%A6%E4%B9%A0/">
            <span class="level-start">
                <span class="level-item">英语学习</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">
            <span class="level-start">
                <span class="level-item">计算机网络</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
    
        <div class="column-right-shadow  is-sticky">
        
            <div class="card widget">
	<div class="card-content">
		<h3 class="menu-label">我的歌单</h3>
		<div class="aplayer" data-id="1997628239" data-server="netease" data-type="playlist" data-mode="single"></div>
	</div>
</div>

        
            <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            标签云
        </h3>
        <a href="/tags/AJAX/" style="font-size: 10px;">AJAX</a> <a href="/tags/CMD%E5%91%BD%E4%BB%A4/" style="font-size: 10px;">CMD命令</a> <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/English/" style="font-size: 10px;">English</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/IDEA%E6%95%99%E7%A8%8B/" style="font-size: 10px;">IDEA教程</a> <a href="/tags/IO-%E6%B5%81/" style="font-size: 10px;">IO 流</a> <a href="/tags/JSON/" style="font-size: 10px;">JSON</a> <a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/Java%E5%9F%BA%E7%A1%80/" style="font-size: 16.67px;">Java基础</a> <a href="/tags/Java%E9%9B%86%E5%90%88/" style="font-size: 10px;">Java集合</a> <a href="/tags/Jenkins/" style="font-size: 10px;">Jenkins</a> <a href="/tags/Layui-%E5%8D%9A%E5%AE%A2/" style="font-size: 10px;">Layui 博客</a> <a href="/tags/LeetCode/" style="font-size: 10px;">LeetCode</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/MySQL/" style="font-size: 10px;">MySQL</a> <a href="/tags/Oracle%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 10px;">Oracle数据库</a> <a href="/tags/PL-SQL/" style="font-size: 10px;">PL/SQL</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/SSM/" style="font-size: 10px;">SSM</a> <a href="/tags/Spring/" style="font-size: 10px;">Spring</a> <a href="/tags/Spring-Boot/" style="font-size: 13.33px;">Spring Boot</a> <a href="/tags/Spring-MVC/" style="font-size: 10px;">Spring MVC</a> <a href="/tags/Vue/" style="font-size: 10px;">Vue</a> <a href="/tags/hello-world/" style="font-size: 10px;">hello world</a> <a href="/tags/html/" style="font-size: 10px;">html</a> <a href="/tags/icarus%E4%B8%BB%E9%A2%98/" style="font-size: 10px;">icarus主题</a> <a href="/tags/mybatis/" style="font-size: 10px;">mybatis</a> <a href="/tags/svn/" style="font-size: 10px;">svn</a> <a href="/tags/windows%E6%95%99%E7%A8%8B/" style="font-size: 10px;">windows教程</a> <a href="/tags/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/" style="font-size: 10px;">函数式编程</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 10px;">前端</a> <a href="/tags/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/" style="font-size: 10px;">博客搭建</a> <a href="/tags/%E5%8F%8D%E5%B0%84%E6%B3%A8%E8%A7%A3/" style="font-size: 10px;">反射注解</a> <a href="/tags/%E5%B8%B8%E7%94%A8-API/" style="font-size: 10px;">常用 API</a> <a href="/tags/%E5%B8%B8%E7%94%A8%E7%AE%97%E6%B3%95/" style="font-size: 10px;">常用算法</a> <a href="/tags/%E6%95%85%E4%BA%8B/" style="font-size: 10px;">故事</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 10px;">数据库</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 10px;">数据结构</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 10px;">算法</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" style="font-size: 10px;">网络编程</a> <a href="/tags/%E8%8B%B1%E8%AF%AD/" style="font-size: 10px;">英语</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" style="font-size: 10px;">计算机网络</a> <a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 10px;">面试</a>
    </div>
</div>
        
            <div class="card widget">
  <div class="card-content">
    <div class="menu">
      <h3 class="menu-label">
        订阅更新
      </h3>
      <div>
        <form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow"
          onsubmit="window.open('https://feedburner.google.com/fb/a/mailverify?uri=guoshizhanFeedsId', 'popupwindow', 'scrollbars=yes,width=550,height=520');return true">
          <input type="hidden" value="guoshizhanFeedsId" name="uri" />
          <input type="hidden" name="loc" value="en_US" />
          <div class="field">
            <div class="control has-icons-left">
              <input class="input" name="email" type="email" placeholder="请输入邮箱地址" />
              <span class="icon is-small is-left">
                <i class="fas fa-envelope"></i>
              </span>
            </div>
            <p class="help">立即订阅跳转人机认证后，点击完成按钮！</p>
          </div>
          <div class="field is-grouped is-grouped-right">
            <div class="control">
              <input class="button is-link is-rounded" type="submit" value="订阅">
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

        
        </div>
    
</div>

                
            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/GSZ's-Blog.png" alt="Mybatis 入门教程" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2021 Java Developer&nbsp;
                Powered &#10084; ShiZhan·Guo
                </p>
            </div>    
            <script>
                (function(){
                    var bp = document.createElement('script');
                    var curProtocol = window.location.protocol.split(':')[0];
                    if (curProtocol === 'https') {
                        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
                    }
                    else {
                        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
                    }
                    var s = document.getElementsByTagName("script")[0];
                    s.parentNode.insertBefore(bp, s);
                })();
            </script>

            <div align="center" id="access-number">
                <br>
                <script type="text/javascript" src="/js/statistics.js"></script>
                <span id="statistic-times"></span>
                <br>
                <div align="center">
                    <span class="busuanzi_container_site_pv">总访问量 
                        <b><span id="busuanzi_value_site_pv"></span></b> 次
                    </span>
                    <span class="busuanzi_container_site_uv">您是第  
                        <b><span id="busuanzi_value_site_uv"></b>
                        </span> 位小伙伴
                    </span>
                    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
                </div>
            </div>
            
            
            <!--<div id="earth">
                <span>
                <script type="text/javascript" src="//rf.revolvermaps.com/0/0/2.js?i=0xetp0d4rdh&m=7&s=130&c=00fff6&t=1" async="async"></script>
                </span>
            </div>-->


            <!--这个一个空的 div ，目的是让卜算子统计居中-->
            <div id="empty"></div>


            <script>
                (function(){
                    var bp = document.createElement('script');
                    bp.src = '//push.zhanzhang.baidu.com/push.js';
                    var s = document.getElementsByTagName("script")[0];
                    s.parentNode.insertBefore(bp, s);
                })();
            </script>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("zh-CN");</script>


<script>
var IcarusThemeSettings = {
    site: {
        url: 'https://guoshizhan.github.io',
        external_link: {"enable":true,"exclude":[]}
    },
    article: {
        highlight: {
            clipboard: true,
            fold: 'unfolded'
        }
    }
};
</script>


<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>





<script src="/js/animation.js"></script>



<script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
<script src="/js/gallery.js" defer></script>



<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>


<a id="back-to-top" title="回到顶端" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>














<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="想要查找什么..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '页面',
                CATEGORIES: '分类',
                TAGS: '标签',
                UNTITLED: '(无标题)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
    
    <!--配置看板娘-->
    <script type="text/javascript" async="" src="/live2d/autoload.js"></script>

    <!--音乐js文件-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.css">
    <script src="/js/APlayer.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/meting@1.2/dist/Meting.min.js"></script>
</body>
</html>